import{j as e,r as i,a as se,R as G}from"./index-dxUAcY-k.js";import{a as k}from"./api-client-CDvRtWmo.js";import{g as _}from"./work-item-utils-RZsWa1qH.js";import{S as F,a as ae,C as M,b as T}from"./card-CWJTJVZ6.js";import{u as ne,E as ie}from"./error-state-BDd6dVQJ.js";import{E as le}from"./empty-state-CXagTbA4.js";import{c as P,a as b,B as m}from"./button-BqoICpPk.js";import{I as H}from"./input-Te8OuQDQ.js";import{B as S}from"./badge-CfeH18ck.js";import{S as q}from"./scroll-area-DwP-oL9g.js";import{S as B}from"./separator-DJqU-5tf.js";import{R as oe,C as re,g as ce,X as de,T as me,f as xe,P as ue,O as he,D as pe,a as fe,b as je,c as ge,d as Ne,e as ve}from"./dialog-BASUQdY5.js";import{T as ye}from"./textarea-C1kQ-UYx.js";import{S as be,a as Ce,b as we,c as Se,d as A}from"./select-Dd62rKlS.js";import{U as ke}from"./user-plus-CA0ezSsL.js";import{S as ze}from"./search-DzLi3Dj6.js";import{L as De}from"./list-CrMmrEq-.js";import{M as L}from"./mail-i0xYxvgr.js";import{L as Ee}from"./link-2-B2zmmBfz.js";import"./bell-CucetOzx.js";import"./users-B5K-FOO3.js";import"./index-6gjEHE0t.js";import"./index-CsDA_5tK.js";import"./index-BdQq_4o_.js";import"./index-VD3BCwW8.js";import"./index-BOjStPRS.js";import"./chevron-down-DvGeT3kk.js";const _e=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Fe=P("arrow-up-down",_e);const Me=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Te=P("grid-3x3",Me);const Ae=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],O=P("phone",Ae);function Le({...s}){return e.jsx(oe,{"data-slot":"sheet",...s})}function Oe({...s}){return e.jsx(ue,{"data-slot":"sheet-portal",...s})}function Pe({className:s,...n}){return e.jsx(he,{"data-slot":"sheet-overlay",className:b("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...n})}function Re({className:s,children:n,side:a="right",showCloseButton:o=!0,...r}){return e.jsxs(Oe,{children:[e.jsx(Pe,{}),e.jsxs(re,{"data-slot":"sheet-content",className:b("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",a==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",a==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",a==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",a==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",s),...r,children:[n,o&&e.jsxs(ce,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[e.jsx(de,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Ve({className:s,...n}){return e.jsx("div",{"data-slot":"sheet-header",className:b("flex flex-col gap-1.5 p-4",s),...n})}function Ie({className:s,...n}){return e.jsx(me,{"data-slot":"sheet-title",className:b("text-foreground font-semibold",s),...n})}function Ue({className:s,...n}){return e.jsx(xe,{"data-slot":"sheet-description",className:b("text-muted-foreground text-sm",s),...n})}const z={all:["contacts"],lists:()=>[...z.all,"list"],list:s=>[...z.lists(),s],detail:s=>[...z.all,"detail",s]};function $e(s){const n=s?`?search=${encodeURIComponent(s)}`:"";return ne({queryKey:z.list(s),queryFn:({signal:a})=>k.get(`/api/contacts${n}`,{signal:a})})}function h(s,n){return s.endpoints.find(o=>o.type===n)?.value??null}function qe(s,n){const a=[...s];switch(n){case"name":return a.sort((o,r)=>o.display_name.localeCompare(r.display_name));case"recent":return a.sort((o,r)=>new Date(r.created_at).getTime()-new Date(o.created_at).getTime());case"endpoints":return a.sort((o,r)=>r.endpoints.length-o.endpoints.length);default:return a}}function gt(){const[s,n]=i.useState(""),[a,o]=i.useState(""),[r,p]=i.useState("name"),[u,f]=i.useState("grid"),[l,j]=i.useState(null),[D,d]=i.useState(!1),[K,g]=i.useState(!1),[N,v]=i.useState(null),[J,C]=i.useState(!1),R=se();G.useEffect(()=>{const t=setTimeout(()=>{o(s)},300);return()=>clearTimeout(t)},[s]);const{data:w,isLoading:Q,isError:X,error:V,refetch:x}=$e(a||void 0),E=i.useMemo(()=>w?.contacts?qe(w.contacts,r):[],[w?.contacts,r]),I=i.useCallback(t=>{j(t),d(!0)},[]),W=i.useCallback(t=>{R(`/people/${t.id}`)},[R]),Y=i.useCallback(async t=>{C(!0);try{await k.post("/api/contacts",t),g(!1),v(null),x()}catch(c){console.error("Failed to create contact:",c)}finally{C(!1)}},[x]),Z=i.useCallback(async t=>{if(N){C(!0);try{await k.patch(`/api/contacts/${N.id}`,t),g(!1),v(null),d(!1),j(null),x()}catch(c){console.error("Failed to update contact:",c)}finally{C(!1)}}},[N,x]),ee=i.useCallback(async t=>{try{await k.delete(`/api/contacts/${t.id}`),d(!1),j(null),x()}catch(c){console.error("Failed to delete contact:",c)}},[x]),te=i.useCallback(t=>{v(t),d(!1),g(!0)},[]),U=i.useCallback(()=>{v(null),g(!0)},[]);if(Q)return e.jsxs("div",{"data-testid":"page-contacts",className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(F,{width:200,height:32}),e.jsx(F,{width:120,height:36})]}),e.jsx(F,{width:"100%",height:40,className:"mb-4"}),e.jsx(ae,{count:6,variant:"card"})]});if(X)return e.jsx("div",{"data-testid":"page-contacts",className:"p-6",children:e.jsx(ie,{type:"generic",title:"Failed to load contacts",description:V instanceof Error?V.message:"Unknown error",onRetry:()=>x()})});const $=w?.total??0;return e.jsxs("div",{"data-testid":"page-contacts",className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"People"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[$," contact",$!==1?"s":""]})]}),e.jsxs(m,{onClick:U,"data-testid":"add-contact-button",children:[e.jsx(ke,{className:"mr-2 size-4"}),"Add Contact"]})]}),e.jsxs("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(H,{type:"text",placeholder:"Search contacts...",value:s,onChange:t=>n(t.target.value),className:"pl-9","data-testid":"contact-search-input"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(be,{value:r,onValueChange:t=>p(t),children:[e.jsxs(Ce,{className:"w-[150px]","data-testid":"sort-select",children:[e.jsx(Fe,{className:"mr-2 size-4"}),e.jsx(we,{placeholder:"Sort by"})]}),e.jsxs(Se,{children:[e.jsx(A,{value:"name",children:"Name"}),e.jsx(A,{value:"recent",children:"Most Recent"}),e.jsx(A,{value:"endpoints",children:"Endpoints"})]})]}),e.jsxs("div",{className:"flex rounded-md border",children:[e.jsx(m,{variant:u==="grid"?"default":"ghost",size:"icon",className:"rounded-r-none size-9",onClick:()=>f("grid"),title:"Grid view","data-testid":"view-grid",children:e.jsx(Te,{className:"size-4"})}),e.jsx(m,{variant:u==="list"?"default":"ghost",size:"icon",className:"rounded-l-none size-9",onClick:()=>f("list"),title:"List view","data-testid":"view-list",children:e.jsx(De,{className:"size-4"})})]})]})]}),E.length===0?e.jsx(M,{children:e.jsx(T,{className:"p-8",children:e.jsx(le,{variant:"contacts",title:s?"No contacts found":"No contacts yet",description:s?"Try a different search term.":"Add your first contact to get started.",onAction:s?void 0:U,actionLabel:"Add Contact"})})}):e.jsx(q,{className:"flex-1",children:u==="grid"?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3","data-testid":"contacts-grid",children:E.map(t=>{const c=h(t,"email"),y=h(t,"phone");return e.jsx(M,{"data-testid":"contact-card",className:"cursor-pointer transition-colors hover:bg-muted/50",onClick:()=>I(t),children:e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex size-12 shrink-0 items-center justify-center rounded-full bg-primary/10 text-sm font-medium text-primary",children:_(t.display_name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-medium text-foreground truncate",children:t.display_name}),c&&e.jsxs("p",{className:"flex items-center gap-1 text-sm text-muted-foreground truncate mt-0.5",children:[e.jsx(L,{className:"size-3 shrink-0"}),c]}),y&&e.jsxs("p",{className:"flex items-center gap-1 text-sm text-muted-foreground truncate mt-0.5",children:[e.jsx(O,{className:"size-3 shrink-0"}),y]})]})]}),t.endpoints.length>0&&e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsxs(S,{variant:"secondary",className:"text-xs gap-1",children:[e.jsx(Ee,{className:"size-3"}),t.endpoints.length," endpoint",t.endpoints.length!==1?"s":""]})})]})},t.id)})}):e.jsx(M,{"data-testid":"contacts-list",children:e.jsx(T,{className:"p-0",children:e.jsx("div",{className:"divide-y",children:E.map(t=>{const c=h(t,"email"),y=h(t,"phone");return e.jsxs("button",{"data-testid":"contact-row",onClick:()=>I(t),className:"w-full p-4 text-left hover:bg-muted/50 transition-colors flex items-center gap-3",children:[e.jsx("div",{className:"flex size-10 shrink-0 items-center justify-center rounded-full bg-primary/10 text-sm font-medium text-primary",children:_(t.display_name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground mt-0.5",children:[c&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(L,{className:"size-3 shrink-0"}),c]}),y&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(O,{className:"size-3 shrink-0"}),y]})]})]}),e.jsxs(S,{variant:"secondary",className:"shrink-0",children:[t.endpoints.length," endpoint",t.endpoints.length!==1?"s":""]})]},t.id)})})})})}),e.jsx(Le,{open:D,onOpenChange:d,children:e.jsxs(Re,{className:"w-96 sm:max-w-md","data-testid":"contact-detail-sheet",children:[e.jsxs(Ve,{children:[e.jsx(Ie,{className:"sr-only",children:"Contact Details"}),e.jsx(Ue,{className:"sr-only",children:"View contact information and endpoints"})]}),l&&e.jsx(q,{className:"h-full",children:e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex size-16 items-center justify-center rounded-full bg-primary/10 text-xl font-medium text-primary",children:_(l.display_name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold",children:l.display_name}),h(l,"email")&&e.jsx("p",{className:"text-sm text-muted-foreground",children:h(l,"email")})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>W(l),"data-testid":"view-full-detail",children:"View Full Profile"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>te(l),children:"Edit"}),e.jsx(m,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>ee(l),children:"Delete"})]}),e.jsx(B,{}),l.notes&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-md",children:l.notes})]}),e.jsx(B,{})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Endpoints"}),e.jsx(S,{variant:"secondary",className:"text-xs",children:l.endpoints.length})]}),l.endpoints.length>0?e.jsx("div",{className:"space-y-2",children:l.endpoints.map((t,c)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 rounded-md bg-muted/30",children:[t.type==="email"&&e.jsx(L,{className:"size-4 text-muted-foreground"}),t.type==="phone"&&e.jsx(O,{className:"size-4 text-muted-foreground"}),t.type!=="email"&&t.type!=="phone"&&e.jsx(S,{variant:"outline",className:"text-xs",children:t.type}),e.jsx("span",{className:"text-foreground",children:t.value})]},c))}):e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No endpoints"})]})]})})]})}),e.jsx(Be,{open:K,onOpenChange:t=>{g(t),t||v(null)},contact:N,isSubmitting:J,onSubmit:t=>{N?Z(t):Y(t)}})]})}function Be({open:s,onOpenChange:n,contact:a,isSubmitting:o,onSubmit:r}){const[p,u]=i.useState(""),[f,l]=i.useState("");G.useEffect(()=>{s&&(u(a?.display_name??""),l(a?.notes??""))},[s,a]);const j=d=>{d.preventDefault(),r({displayName:p.trim(),notes:f.trim()||void 0})},D=p.trim().length>0;return e.jsx(pe,{open:s,onOpenChange:n,children:e.jsxs(fe,{className:"sm:max-w-md","data-testid":"contact-form-dialog",children:[e.jsxs(je,{children:[e.jsx(ge,{children:a?"Edit Contact":"Add Contact"}),e.jsx(Ne,{children:a?"Update the contact details below.":"Fill in the details to add a new contact."})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"contact-name",className:"text-sm font-medium",children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(H,{id:"contact-name",value:p,onChange:d=>u(d.target.value),placeholder:"John Doe",required:!0,"data-testid":"contact-name-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"contact-notes",className:"text-sm font-medium",children:"Notes"}),e.jsx(ye,{id:"contact-notes",value:f,onChange:d=>l(d.target.value),placeholder:"Additional notes about this contact...",rows:3,"data-testid":"contact-notes-input"})]}),e.jsxs(ve,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:!D||o,"data-testid":"contact-form-submit",children:a?"Save Changes":"Add Contact"})]})]})]})})}export{gt as ContactsPage};
//# sourceMappingURL=ContactsPage-jPtJ84Jc.js.map
