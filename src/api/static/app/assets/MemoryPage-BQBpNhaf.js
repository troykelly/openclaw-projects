import{r,j as e,R as Q}from"./index-BBE7598u.js";import{a as k}from"./api-client-CDvRtWmo.js";import{S as v,a as X,C as E,b as F}from"./card-GDq2Qr4b.js";import{E as Y}from"./error-state-Di8EWGk4.js";import{E as Z}from"./empty-state-C5Q80ShL.js";import{c as ee,B as f}from"./button-BzBQrMtc.js";import{I as L}from"./input-aGA4pO87.js";import{T as te}from"./textarea-6y2OzEZR.js";import{B as se}from"./badge-BvguM0n5.js";import{S as ae}from"./scroll-area-Ey16bYQ0.js";import{D as I,a as A,b as B,c as P,d as V,e as _}from"./dialog-BK5-jUdo.js";import{S as R,a as U,b as $,c as q,d as c,e as re}from"./select-C2f-d75W.js";import{D as ie,a as ne,b as le,c as z,P as ce,T as oe,L as de}from"./dropdown-menu-Ca4D_ZSx.js";import{a as me,E as xe}from"./use-memories-D7foX-gF.js";import{P as ue}from"./plus-XVGJUlYG.js";import{S as pe}from"./search-B_gaXVZH.js";import{L as he}from"./link-2-ClbRrKI-.js";import{C as fe}from"./calendar-Dxx78nc7.js";import{C as je}from"./chevron-down-DvtQhMss.js";import{B as ge}from"./brain-BBl2fM32.js";import{C as ye}from"./circle-check-big-SdKbMGGK.js";import{F as Ne}from"./users-BUvyJwTy.js";import"./bell-8BD9YrS2.js";import"./mail-iwQmDfp1.js";import"./folder-open-C_dc-wnO.js";import"./index-D6aJl7-K.js";import"./index-cEbYu3YY.js";import"./index-BdQq_4o_.js";import"./index-DE5iJkJZ.js";import"./index-ijKsfUNh.js";import"./index-DHRohVgr.js";import"./useQuery-CUPm5fpM.js";const ve=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],be=ee("lightbulb",ve);function Ce(s){switch(s){case"preference":return e.jsx(be,{className:"size-4"});case"fact":return e.jsx(Ne,{className:"size-4"});case"decision":return e.jsx(ye,{className:"size-4"});case"context":return e.jsx(de,{className:"size-4"});default:return e.jsx(ge,{className:"size-4"})}}function we(s){switch(s){case"preference":return"Preference";case"fact":return"Fact";case"decision":return"Decision";case"context":return"Context";default:return"Memory"}}function Se(s){switch(s){case"preference":return"bg-blue-500/10 text-blue-700 dark:text-blue-300 border-blue-500/20";case"fact":return"bg-green-500/10 text-green-700 dark:text-green-300 border-green-500/20";case"decision":return"bg-purple-500/10 text-purple-700 dark:text-purple-300 border-purple-500/20";case"context":return"bg-orange-500/10 text-orange-700 dark:text-orange-300 border-orange-500/20";default:return""}}function ke(s){return new Date(s).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function nt(){const[s,j]=r.useState(""),[a,b]=r.useState("all"),[p,m]=r.useState(null),[g,n]=r.useState(!1),[o,d]=r.useState(null),[x,h]=r.useState(null),[C,l]=r.useState(!1),{data:y,isLoading:O,isError:H,error:D,refetch:u}=me(),w=r.useMemo(()=>{if(!y?.memories)return[];let t=y.memories;if(a!=="all"&&(t=t.filter(i=>i.type===a)),s.trim()){const i=s.toLowerCase();t=t.filter(N=>N.title.toLowerCase().includes(i)||N.content.toLowerCase().includes(i))}return t},[y?.memories,a,s]),S=r.useCallback(t=>{m(i=>i===t?null:t)},[]),W=r.useCallback(async t=>{l(!0);try{await k.post("/api/memory",t),n(!1),d(null),u()}catch(i){console.error("Failed to create memory:",i)}finally{l(!1)}},[u]),G=r.useCallback(async t=>{if(o){l(!0);try{await k.patch(`/api/memories/${o.id}`,t),n(!1),d(null),u()}catch(i){console.error("Failed to update memory:",i)}finally{l(!1)}}},[o,u]),J=r.useCallback(async t=>{try{await k.delete(`/api/memories/${t.id}`),h(null),p===t.id&&m(null),u()}catch(i){console.error("Failed to delete memory:",i)}},[p,u]),K=r.useCallback(t=>{d(t),n(!0)},[]),M=r.useCallback(()=>{d(null),n(!0)},[]);if(O)return e.jsxs("div",{"data-testid":"page-memory",className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(v,{width:200,height:32}),e.jsx(v,{width:140,height:36})]}),e.jsxs("div",{className:"mb-4 flex gap-3",children:[e.jsx(v,{width:"100%",height:40,className:"max-w-md"}),e.jsx(v,{width:150,height:40})]}),e.jsx(X,{count:6,variant:"card"})]});if(H)return e.jsx("div",{"data-testid":"page-memory",className:"p-6",children:e.jsx(Y,{type:"generic",title:"Failed to load memories",description:D instanceof Error?D.message:"Unknown error",onRetry:()=>u()})});const T=y?.total??0;return e.jsxs("div",{"data-testid":"page-memory",className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Memory"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[T," memor",T!==1?"ies":"y",a!=="all"&&` (${w.length} shown)`]})]}),e.jsxs(f,{onClick:M,"data-testid":"add-memory-button",children:[e.jsx(ue,{className:"mr-2 size-4"}),"Add Memory"]})]}),e.jsxs("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(pe,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(L,{type:"text",placeholder:"Search memories...",value:s,onChange:t=>j(t.target.value),className:"pl-9","data-testid":"memory-search-input"})]}),e.jsxs(R,{value:a,onValueChange:b,children:[e.jsx(U,{className:"w-[160px]","data-testid":"type-filter",children:e.jsx($,{placeholder:"All types"})}),e.jsxs(q,{children:[e.jsx(c,{value:"all",children:"All types"}),e.jsx(c,{value:"preference",children:"Preferences"}),e.jsx(c,{value:"fact",children:"Facts"}),e.jsx(c,{value:"decision",children:"Decisions"}),e.jsx(c,{value:"context",children:"Context"})]})]})]}),w.length===0?e.jsx(E,{children:e.jsx(F,{className:"p-8",children:e.jsx(Z,{variant:"documents",title:s||a!=="all"?"No memories found":"No memories yet",description:s||a!=="all"?"Try adjusting your search or filter criteria.":"Store knowledge, preferences, decisions, and context for AI agents.",onAction:!s&&a==="all"?M:void 0,actionLabel:"Create Memory"})})}):e.jsx(ae,{className:"flex-1",children:e.jsx("div",{className:"space-y-3","data-testid":"memory-list",children:w.map(t=>{const i=p===t.id,N=t.content.length>200?t.content.slice(0,200)+"...":t.content;return e.jsx(E,{"data-testid":"memory-card",className:"group transition-colors hover:bg-accent/30",children:e.jsxs(F,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0 cursor-pointer",onClick:()=>S(t.id),children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:t.type&&e.jsxs(se,{variant:"outline",className:`text-xs gap-1 ${Se(t.type)}`,"data-testid":"memory-type-badge",children:[Ce(t.type),we(t.type)]})}),e.jsx("h3",{className:"font-medium text-foreground leading-tight",children:t.title})]}),e.jsxs(ie,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"icon",className:"size-7 opacity-0 group-hover:opacity-100 shrink-0","data-testid":"memory-actions",children:e.jsx(xe,{className:"size-4"})})}),e.jsxs(le,{align:"end",children:[e.jsxs(z,{onClick:()=>K(t),children:[e.jsx(ce,{className:"mr-2 size-4"}),"Edit"]}),e.jsxs(z,{className:"text-destructive focus:text-destructive",onClick:()=>h(t),children:[e.jsx(oe,{className:"mr-2 size-4"}),"Delete"]})]})]})]}),e.jsx("div",{className:"mt-2 cursor-pointer",onClick:()=>S(t.id),children:i?e.jsx("div",{className:"text-sm text-foreground whitespace-pre-wrap","data-testid":"memory-full-content",children:t.content}):e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:N})}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center justify-between gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.work_item_id&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"size-3"}),"Linked"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"size-3"}),ke(t.updated_at)]})]}),e.jsx("button",{className:"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground transition-colors",onClick:()=>S(t.id),"data-testid":"memory-expand-toggle",children:i?e.jsxs(e.Fragment,{children:["Collapse ",e.jsx(re,{className:"size-3"})]}):e.jsxs(e.Fragment,{children:["Expand ",e.jsx(je,{className:"size-3"})]})})]})]})},t.id)})})}),e.jsx(De,{open:g,onOpenChange:t=>{n(t),t||d(null)},memory:o,isSubmitting:C,onSubmit:t=>{o?G(t):W(t)}}),e.jsx(I,{open:!!x,onOpenChange:t=>{t||h(null)},children:e.jsxs(A,{className:"sm:max-w-sm","data-testid":"delete-confirm-dialog",children:[e.jsxs(B,{children:[e.jsx(P,{children:"Delete Memory"}),e.jsxs(V,{children:['Are you sure you want to delete "',x?.title,'"? This action cannot be undone.']})]}),e.jsxs(_,{children:[e.jsx(f,{variant:"outline",onClick:()=>h(null),children:"Cancel"}),e.jsx(f,{variant:"destructive",onClick:()=>x&&J(x),"data-testid":"confirm-delete-button",children:"Delete"})]})]})})]})}function De({open:s,onOpenChange:j,memory:a,isSubmitting:b,onSubmit:p}){const[m,g]=r.useState(""),[n,o]=r.useState(""),[d,x]=r.useState("fact");Q.useEffect(()=>{s&&(g(a?.title??""),o(a?.content??""),x(a?.type??"fact"))},[s,a]);const h=l=>{l.preventDefault(),p(a?{title:m.trim(),content:n.trim()}:{title:m.trim(),content:n.trim(),type:d})},C=m.trim().length>0&&n.trim().length>0;return e.jsx(I,{open:s,onOpenChange:j,children:e.jsxs(A,{className:"sm:max-w-2xl","data-testid":"memory-form-dialog",children:[e.jsxs(B,{children:[e.jsx(P,{children:a?"Edit Memory":"Create Memory"}),e.jsx(V,{children:a?"Update the memory details below.":"Store knowledge, preferences, decisions, or context."})]}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"memory-title",className:"text-sm font-medium",children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(L,{id:"memory-title",value:m,onChange:l=>g(l.target.value),placeholder:"Memory title",required:!0,"data-testid":"memory-title-input"})]}),!a&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"memory-type",className:"text-sm font-medium",children:"Type"}),e.jsxs(R,{value:d,onValueChange:x,children:[e.jsx(U,{"data-testid":"memory-type-select",children:e.jsx($,{placeholder:"Select type"})}),e.jsxs(q,{children:[e.jsx(c,{value:"preference",children:"Preference"}),e.jsx(c,{value:"fact",children:"Fact"}),e.jsx(c,{value:"decision",children:"Decision"}),e.jsx(c,{value:"context",children:"Context"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"memory-content",className:"text-sm font-medium",children:["Content ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{id:"memory-content",value:n,onChange:l=>o(l.target.value),placeholder:"Write memory content here... (Markdown supported)",className:"min-h-[200px] font-mono text-sm",required:!0,"data-testid":"memory-content-input"})]}),e.jsxs(_,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(f,{type:"submit",disabled:!C||b,"data-testid":"memory-form-submit",children:a?"Save Changes":"Create Memory"})]})]})]})})}export{nt as MemoryPage};
//# sourceMappingURL=MemoryPage-BQBpNhaf.js.map
