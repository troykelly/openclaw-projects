import{j as e,r}from"./index-DoQKFsVP.js";import{c as y,B as u,a as $}from"./button-BTQRjsho.js";import{B as g}from"./badge-DsiyHYV4.js";import{I as me}from"./input-CKNIOnpa.js";import{U as X,P as oe,V,M as xe,T as he,a as ue,b,c as z,d as B,C as Q}from"./calendar-event-card-CN0YX43d.js";import{D as pe,a as je,b as fe,d as ge,e as Ne,c as J}from"./dropdown-menu-BLWdwj2m.js";import{S as N}from"./scroll-area-XA4Aq3a2.js";import{S as p}from"./separator-LHAeuEtu.js";import{S as G,a as K,b as W,c as Y,d as Z,A as ve}from"./sheet-SipWvLGg.js";import{U as ee}from"./user-CDLllFi1.js";import{M as se}from"./mail-DC9xiueU.js";import{C as M,U as ye,F as ke}from"./users-CJNt4qKT.js";import{C as we}from"./clock-CzeeMNDe.js";import{X as E}from"./index-CznuPdXa.js";import{C as Ce,a as be}from"./chevron-down-CTcxn7D3.js";import{S,a as ze}from"./skeleton-6qwQjcya.js";import{E as T}from"./empty-state-CaNdnNB4.js";import{S as Se}from"./search-BHgE2aeV.js";import{L as Te}from"./link-2-Btskszyn.js";import"./index-Qf36hgnl.js";import"./index-K96IL8No.js";import"./bell-CNA8j3so.js";const Ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Me=y("circle-question-mark",Ee);const Le=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],De=y("message-square",Le);const Ae=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Fe=y("sliders-horizontal",Ae);const Oe=[["path",{d:"M15 7h2a5 5 0 0 1 0 10h-2m-6 0H7A5 5 0 0 1 7 7h2",key:"1re2ne"}]],Ue=y("unlink-2",Oe);function _e({email:s,open:c,onOpenChange:d,onUnlink:t}){return s?e.jsx(G,{open:c,onOpenChange:d,children:e.jsxs(K,{className:"w-[500px] sm:max-w-lg",children:[e.jsxs(W,{children:[e.jsx(Y,{className:"sr-only",children:"Email Details"}),e.jsx(Z,{className:"sr-only",children:"View email subject, sender, and body"})]}),e.jsx(N,{className:"h-full",children:e.jsxs("div",{className:"space-y-4 pb-6",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-xl font-semibold",children:s.subject})}),t&&e.jsx("div",{className:"flex gap-2",children:e.jsxs(u,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>t(s),children:[e.jsx(X,{className:"mr-1 size-3"}),"Unlink"]})}),e.jsx(p,{}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ee,{className:"mt-0.5 size-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.from.name||s.from.email}),s.from.name&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.from.email})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(se,{className:"mt-0.5 size-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"To:"}),e.jsx("p",{children:s.to.map(i=>i.name||i.email).join(", ")})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(M,{className:"size-4"}),e.jsxs("span",{children:[s.date.toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"})," ","at"," ",s.date.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})]})]}),s.hasAttachments&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(oe,{className:"size-4"}),e.jsx("span",{children:"Has attachments"})]})]}),e.jsx(p,{}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:s.body?e.jsx("div",{className:"whitespace-pre-wrap",children:s.body}):e.jsx("p",{className:"text-muted-foreground",children:s.snippet})})]})})]})}):null}function He(s){switch(s){case"accepted":return e.jsx(Ce,{className:"size-3 text-green-600"});case"declined":return e.jsx(E,{className:"size-3 text-red-600"});case"tentative":return e.jsx(Me,{className:"size-3 text-yellow-600"});default:return null}}function qe({event:s,open:c,onOpenChange:d,onUnlink:t,onJoinMeeting:i}){if(!s)return null;const m=s.endTime<new Date;return e.jsx(G,{open:c,onOpenChange:d,children:e.jsxs(K,{className:"w-[500px] sm:max-w-lg",children:[e.jsxs(W,{children:[e.jsx(Y,{className:"sr-only",children:"Event Details"}),e.jsx(Z,{className:"sr-only",children:"View event time, attendees, and details"})]}),e.jsx(N,{className:"h-full",children:e.jsxs("div",{className:"space-y-4 pb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:s.title}),m&&e.jsx(g,{variant:"secondary",className:"mt-1",children:"Past event"})]}),e.jsxs("div",{className:"flex gap-2",children:[s.meetingLink&&i&&!m&&e.jsxs(u,{size:"sm",onClick:()=>i(s),children:[e.jsx(V,{className:"mr-1 size-3"}),"Join meeting"]}),t&&e.jsxs(u,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>t(s),children:[e.jsx(X,{className:"mr-1 size-3"}),"Unlink"]})]}),e.jsx(p,{}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"size-4 text-muted-foreground"}),e.jsx("span",{children:s.startTime.toLocaleDateString([],{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"size-4 text-muted-foreground"}),e.jsx("span",{children:s.isAllDay?"All day":`${R(s.startTime)} - ${R(s.endTime)}`})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"size-4 text-muted-foreground"}),e.jsx("span",{children:s.location})]}),s.meetingLink&&e.jsxs("div",{className:"flex items-center gap-2 text-primary",children:[e.jsx(V,{className:"size-4"}),e.jsx("a",{href:s.meetingLink,target:"_blank",rel:"noopener noreferrer",className:"hover:underline",onClick:l=>l.stopPropagation(),children:"Join video call"})]}),s.organizer&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"size-4 text-muted-foreground"}),e.jsxs("span",{children:["Organized by ",s.organizer.name||s.organizer.email]})]})]}),s.attendees.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(p,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ye,{className:"size-4"}),"Attendees (",s.attendees.length,")"]}),e.jsx("div",{className:"space-y-2",children:s.attendees.map(l=>e.jsxs("div",{className:"flex items-center justify-between rounded-md bg-muted/50 px-3 py-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:l.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:l.email})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[He(l.status),e.jsx("span",{className:"text-xs capitalize text-muted-foreground",children:l.status})]})]},l.email))})]})]}),s.description&&e.jsxs(e.Fragment,{children:[e.jsx(p,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium",children:[e.jsx(ke,{className:"size-4"}),"Description"]}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap",children:s.description})})]})]})]})})]})})}function R(s){return s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function Ie(s,c,d){const t=[...s.map(i=>({kind:"email",id:i.id,date:i.date,email:i})),...c.map(i=>({kind:"calendar",id:i.id,date:i.startTime,event:i}))];return t.sort((i,m)=>d==="newest"?m.date.getTime()-i.date.getTime():i.date.getTime()-m.date.getTime()),t}function Pe(s,c,d){if(!d.trim())return{filteredEmails:s,filteredEvents:c};const t=d.toLowerCase(),i=s.filter(l=>l.subject.toLowerCase().includes(t)||l.from.name.toLowerCase().includes(t)||l.from.email.toLowerCase().includes(t)||l.snippet.toLowerCase().includes(t)),m=c.filter(l=>l.title.toLowerCase().includes(t)||(l.description?.toLowerCase().includes(t)??!1)||(l.location?.toLowerCase().includes(t)??!1)||l.attendees.some(n=>n.name.toLowerCase().includes(t)||n.email.toLowerCase().includes(t)));return{filteredEmails:i,filteredEvents:m}}function ms({emails:s,calendarEvents:c,isLoading:d=!1}={}){const t=s??[],i=c??[],[m,l]=r.useState("all"),[n,k]=r.useState(""),[o,L]=r.useState("newest"),[D,A]=r.useState("all"),[F,ae]=r.useState(!1),[te,ie]=r.useState(null),[le,O]=r.useState(!1),[ne,re]=r.useState(null),[ce,U]=r.useState(!1),{filteredEmails:x,filteredEvents:h}=r.useMemo(()=>Pe(t,i,n),[t,i,n]),_=r.useMemo(()=>{const a=[...x];return a.sort((j,f)=>o==="newest"?f.date.getTime()-j.date.getTime():j.date.getTime()-f.date.getTime()),a},[x,o]),H=r.useMemo(()=>{const a=[...h];return a.sort((j,f)=>o==="newest"?f.startTime.getTime()-j.startTime.getTime():j.startTime.getTime()-f.startTime.getTime()),a},[h,o]),q=r.useMemo(()=>Ie(x,h,o),[x,h,o]),I=r.useCallback(a=>{ie(a),O(!0)},[]),P=r.useCallback(a=>{re(a),U(!0)},[]),de=r.useCallback(()=>{k("")},[]),v=t.length+i.length,w=x.length+h.length,C=n.trim().length>0||D!=="all";return d?e.jsxs("div",{"data-testid":"page-communications",className:"flex h-full flex-col p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(S,{width:240,height:32}),e.jsx(S,{width:120,height:36})]}),e.jsx(S,{width:"100%",height:40,className:"mb-4"}),e.jsx(ze,{count:5,variant:"card"})]}):e.jsxs("div",{"data-testid":"page-communications",className:"flex h-full flex-col p-6",children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Communications"}),e.jsxs("p",{className:"mt-1 text-sm text-muted-foreground",children:[v," item",v!==1?"s":"",C&&w!==v&&e.jsxs("span",{children:[" (",w," shown)"]})]})]})}),e.jsxs("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 sm:max-w-md",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(me,{"data-testid":"communications-search",type:"text",placeholder:"Search communications...",value:n,onChange:a=>k(a.target.value),className:"pl-9 pr-8"}),n&&e.jsx("button",{type:"button",onClick:de,className:"absolute right-2 top-1/2 -translate-y-1/2 rounded-sm p-0.5 text-muted-foreground hover:text-foreground","aria-label":"Clear search",children:e.jsx(E,{className:"size-4"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm","data-testid":"sort-button",children:[e.jsx(ve,{className:"mr-1 size-3.5"}),o==="newest"?"Newest":"Oldest",e.jsx(be,{className:"ml-1 size-3"})]})}),e.jsxs(fe,{align:"end",children:[e.jsx(ge,{children:"Sort by date"}),e.jsx(Ne,{}),e.jsx(J,{onClick:()=>L("newest"),className:$(o==="newest"&&"font-medium"),children:"Newest first"}),e.jsx(J,{onClick:()=>L("oldest"),className:$(o==="oldest"&&"font-medium"),children:"Oldest first"})]})]}),e.jsxs(u,{variant:F?"secondary":"outline",size:"sm",onClick:()=>ae(a=>!a),"data-testid":"filter-toggle",children:[e.jsx(Fe,{className:"mr-1 size-3.5"}),"Filters",C&&e.jsx(g,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:"!"})]})]})]}),F&&e.jsxs("div",{"data-testid":"filter-bar",className:"mb-4 flex flex-wrap items-center gap-2 rounded-lg border bg-muted/30 p-3",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Link status:"}),e.jsx("div",{className:"flex gap-1",children:["all","linked","unlinked"].map(a=>e.jsxs(u,{variant:D===a?"default":"outline",size:"sm",className:"h-7 text-xs",onClick:()=>A(a),children:[a==="all"&&"All",a==="linked"&&e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"mr-1 size-3"}),"Linked"]}),a==="unlinked"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"mr-1 size-3"}),"Unlinked"]})]},a))}),C&&e.jsxs(e.Fragment,{children:[e.jsx(p,{orientation:"vertical",className:"h-6"}),e.jsxs(u,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:()=>{k(""),A("all")},children:[e.jsx(E,{className:"mr-1 size-3"}),"Clear all"]})]})]}),e.jsxs(he,{value:m,onValueChange:a=>l(a),className:"flex min-h-0 flex-1 flex-col",children:[e.jsxs(ue,{className:"w-fit",children:[e.jsxs(b,{value:"all",className:"gap-1.5","data-testid":"tab-all",children:[e.jsx(De,{className:"size-3.5"}),"All",v>0&&e.jsx(g,{variant:"secondary",className:"ml-1 text-[10px] px-1.5",children:w})]}),e.jsxs(b,{value:"emails",className:"gap-1.5","data-testid":"tab-emails",children:[e.jsx(se,{className:"size-3.5"}),"Emails",x.length>0&&e.jsx(g,{variant:"secondary",className:"ml-1 text-[10px] px-1.5",children:x.length})]}),e.jsxs(b,{value:"calendar",className:"gap-1.5","data-testid":"tab-calendar",children:[e.jsx(M,{className:"size-3.5"}),"Calendar Events",h.length>0&&e.jsx(g,{variant:"secondary",className:"ml-1 text-[10px] px-1.5",children:h.length})]})]}),e.jsx(z,{value:"all",className:"mt-4 flex-1",children:q.length>0?e.jsx(N,{className:"h-[calc(100vh-380px)]",children:e.jsx("div",{className:"space-y-2 pr-4","data-testid":"communications-list-all",children:q.map(a=>a.kind==="email"&&a.email?e.jsx(B,{email:a.email,onClick:I},`email-${a.id}`):a.event?e.jsx(Q,{event:a.event,onClick:P},`event-${a.id}`):null)})}):e.jsx(T,{variant:n?"search":"inbox",title:n?"No communications found":"No communications yet",description:n?"Try adjusting your search terms or filters.":"Emails and calendar events linked to your work items will appear here."})}),e.jsx(z,{value:"emails",className:"mt-4 flex-1",children:_.length>0?e.jsx(N,{className:"h-[calc(100vh-380px)]",children:e.jsx("div",{className:"space-y-2 pr-4","data-testid":"communications-list-emails",children:_.map(a=>e.jsx(B,{email:a,onClick:I},a.id))})}):e.jsx(T,{variant:n?"search":"email",title:n?"No emails found":"No emails yet",description:n?"Try adjusting your search terms.":"Emails linked to your work items will appear here."})}),e.jsx(z,{value:"calendar",className:"mt-4 flex-1",children:H.length>0?e.jsx(N,{className:"h-[calc(100vh-380px)]",children:e.jsx("div",{className:"space-y-2 pr-4","data-testid":"communications-list-calendar",children:H.map(a=>e.jsx(Q,{event:a,onClick:P},a.id))})}):e.jsx(T,{variant:n?"search":"calendar",title:n?"No events found":"No calendar events yet",description:n?"Try adjusting your search terms.":"Calendar events linked to your work items will appear here."})})]}),e.jsx(_e,{email:te,open:le,onOpenChange:O}),e.jsx(qe,{event:ne,open:ce,onOpenChange:U})]})}export{ms as CommunicationsPage};
//# sourceMappingURL=CommunicationsPage-NvWzyDyQ.js.map
