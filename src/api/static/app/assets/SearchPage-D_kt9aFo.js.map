{"version":3,"file":"SearchPage-D_kt9aFo.js","sources":["../../../../ui/hooks/queries/use-search.ts","../../../../ui/pages/SearchPage.tsx"],"sourcesContent":["/**\n * TanStack Query hook for search data fetching.\n *\n * Provides a cached, deduplicated query for the global search API.\n * The query is disabled when the search string is empty.\n */\nimport { useQuery } from '@tanstack/react-query';\nimport { apiClient } from '@/ui/lib/api-client.ts';\nimport type { SearchResponse } from '@/ui/lib/api-types.ts';\n\n/** Query key factory for search. */\nexport const searchKeys = {\n  all: ['search'] as const,\n  query: (q: string, types?: string[]) => [...searchKeys.all, q, types] as const,\n};\n\n/**\n * Fetch search results from the API.\n *\n * @param query - The search query string\n * @param types - Optional array of result types to filter by (e.g. ['work_item', 'contact'])\n * @returns TanStack Query result with `SearchResponse`\n */\nexport function useSearch(query: string, types?: string[]) {\n  const params = new URLSearchParams();\n  if (query) params.set('q', query);\n  if (types?.length) params.set('types', types.join(','));\n\n  return useQuery({\n    queryKey: searchKeys.query(query, types),\n    queryFn: ({ signal }) =>\n      apiClient.get<SearchResponse>(`/api/search?${params.toString()}`, { signal }),\n    enabled: query.length > 0,\n  });\n}\n","/**\n * Search results page.\n *\n * Reads the `?q=` query parameter from the URL to perform a global search.\n * Results are grouped by type (work items, contacts, memories) and each\n * result links to its detail page.\n *\n * Uses the `useSearch` TanStack Query hook for data fetching and supports\n * loading, error, and empty states.\n */\nimport React, { useMemo } from 'react';\nimport { useSearchParams, Link } from 'react-router';\nimport { Search as SearchIcon, FileText, Users, Brain } from 'lucide-react';\nimport { useSearch } from '@/ui/hooks/queries/use-search';\nimport { Input } from '@/ui/components/ui/input';\nimport { Badge } from '@/ui/components/ui/badge';\nimport { Card, CardContent } from '@/ui/components/ui/card';\nimport { SkeletonList, EmptyState, ErrorState } from '@/ui/components/feedback';\nimport type { SearchResultItem } from '@/ui/lib/api-types';\n\n/**\n * Derive the in-app route for a search result item.\n * The API returns URLs prefixed with `/app/` which must be stripped for\n * React Router navigation.\n */\nfunction resultHref(item: SearchResultItem): string {\n  const raw = item.url;\n  // Strip /app prefix if present for React Router paths\n  if (raw.startsWith('/app/')) {\n    return raw.replace('/app', '');\n  }\n  return raw;\n}\n\n/** Icon for result type group headings. */\nfunction typeIcon(type: string): React.ReactNode {\n  switch (type) {\n    case 'work_item':\n      return <FileText className=\"size-5\" />;\n    case 'contact':\n      return <Users className=\"size-5\" />;\n    case 'memory':\n      return <Brain className=\"size-5\" />;\n    default:\n      return <FileText className=\"size-5\" />;\n  }\n}\n\n/** Human-readable heading for result type groups. */\nfunction typeHeading(type: string): string {\n  switch (type) {\n    case 'work_item':\n      return 'Work Items';\n    case 'contact':\n      return 'Contacts';\n    case 'memory':\n      return 'Memories';\n    default:\n      return 'Results';\n  }\n}\n\n/** Badge variant for result types. */\nfunction typeBadgeLabel(type: string): string {\n  switch (type) {\n    case 'work_item':\n      return 'Work Item';\n    case 'contact':\n      return 'Contact';\n    case 'memory':\n      return 'Memory';\n    default:\n      return type;\n  }\n}\n\nexport function SearchPage(): React.JSX.Element {\n  const [searchParams, setSearchParams] = useSearchParams();\n  const query = searchParams.get('q') ?? '';\n\n  const { data, isLoading, error } = useSearch(query);\n\n  /** Group results by type. */\n  const grouped = useMemo(() => {\n    if (!data?.results) return { work_items: [], contacts: [], memories: [] };\n    const work_items: SearchResultItem[] = [];\n    const contacts: SearchResultItem[] = [];\n    const memories: SearchResultItem[] = [];\n    for (const r of data.results) {\n      if (r.type === 'work_item') work_items.push(r);\n      else if (r.type === 'contact') contacts.push(r);\n      else memories.push(r);\n    }\n    return { work_items, contacts, memories };\n  }, [data]);\n\n  const handleQueryChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const newQuery = e.target.value;\n    if (newQuery) {\n      setSearchParams({ q: newQuery });\n    } else {\n      setSearchParams({});\n    }\n  };\n\n  const hasQuery = query.length > 0;\n  const hasResults =\n    grouped.work_items.length > 0 ||\n    grouped.contacts.length > 0 ||\n    grouped.memories.length > 0;\n\n  return (\n    <div data-testid=\"page-search\" className=\"p-6 h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-semibold text-foreground\">Search</h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          Find work items, contacts, and memories\n        </p>\n      </div>\n\n      {/* Search input */}\n      <div className=\"relative mb-6 max-w-2xl\">\n        <SearchIcon className=\"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground\" />\n        <Input\n          type=\"text\"\n          placeholder=\"Search...\"\n          value={query}\n          onChange={handleQueryChange}\n          className=\"pl-9\"\n          data-testid=\"search-input\"\n          autoFocus\n        />\n      </div>\n\n      {/* States */}\n      {!hasQuery && (\n        <div data-testid=\"search-prompt\" className=\"flex-1 flex items-center justify-center\">\n          <EmptyState\n            variant=\"search\"\n            title=\"Start searching\"\n            description=\"Enter a query above to search across work items, contacts, and memories.\"\n          />\n        </div>\n      )}\n\n      {hasQuery && isLoading && (\n        <div data-testid=\"search-loading\" className=\"flex-1\">\n          <SkeletonList count={6} variant=\"row\" />\n        </div>\n      )}\n\n      {hasQuery && error && (\n        <ErrorState\n          type=\"generic\"\n          title=\"Search failed\"\n          description={error instanceof Error ? error.message : 'An unexpected error occurred.'}\n        />\n      )}\n\n      {hasQuery && !isLoading && !error && !hasResults && (\n        <EmptyState\n          variant=\"search\"\n          title=\"No results found\"\n          description={`No results for \"${query}\". Try a different search term.`}\n        />\n      )}\n\n      {hasQuery && !isLoading && !error && hasResults && (\n        <div className=\"flex-1 space-y-6\" data-testid=\"search-results\">\n          {/* Work Items group */}\n          {grouped.work_items.length > 0 && (\n            <ResultGroup\n              testId=\"group-work_items\"\n              type=\"work_item\"\n              items={grouped.work_items}\n            />\n          )}\n\n          {/* Contacts group */}\n          {grouped.contacts.length > 0 && (\n            <ResultGroup\n              testId=\"group-contacts\"\n              type=\"contact\"\n              items={grouped.contacts}\n            />\n          )}\n\n          {/* Memories group */}\n          {grouped.memories.length > 0 && (\n            <ResultGroup\n              testId=\"group-memories\"\n              type=\"memory\"\n              items={grouped.memories}\n            />\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ---------------------------------------------------------------------------\n// ResultGroup - renders a group of results under a heading\n// ---------------------------------------------------------------------------\n\ninterface ResultGroupProps {\n  testId: string;\n  type: string;\n  items: SearchResultItem[];\n}\n\nfunction ResultGroup({ testId, type, items }: ResultGroupProps) {\n  return (\n    <div data-testid={testId}>\n      <div className=\"flex items-center gap-2 mb-3\">\n        <span className=\"text-muted-foreground\">{typeIcon(type)}</span>\n        <h2 className=\"text-lg font-semibold text-foreground\">{typeHeading(type)}</h2>\n        <Badge variant=\"secondary\" className=\"text-xs\">\n          {items.length}\n        </Badge>\n      </div>\n      <div className=\"space-y-2\">\n        {items.map((item) => (\n          <Card\n            key={item.id}\n            className=\"transition-colors hover:bg-accent/30\"\n          >\n            <CardContent className=\"p-3\">\n              <Link\n                to={resultHref(item)}\n                data-testid={`result-link-${item.id}`}\n                className=\"block\"\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <div className=\"min-w-0 flex-1\">\n                    <h3 className=\"font-medium text-foreground truncate\">\n                      {item.title}\n                    </h3>\n                    {item.description && (\n                      <p className=\"text-sm text-muted-foreground mt-0.5 line-clamp-2\">\n                        {item.description}\n                      </p>\n                    )}\n                  </div>\n                  <Badge variant=\"outline\" className=\"text-xs shrink-0\">\n                    {typeBadgeLabel(item.type)}\n                  </Badge>\n                </div>\n              </Link>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":["searchKeys","q","types","useSearch","query","params","useQuery","signal","apiClient","resultHref","item","raw","typeIcon","type","jsx","FileText","Users","Brain","typeHeading","typeBadgeLabel","SearchPage","searchParams","setSearchParams","useSearchParams","data","isLoading","error","grouped","useMemo","work_items","contacts","memories","r","handleQueryChange","e","newQuery","hasQuery","hasResults","jsxs","SearchIcon","Input","EmptyState","SkeletonList","ErrorState","ResultGroup","testId","items","Badge","Card","CardContent","Link"],"mappings":"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"}