import{b as me,r as g,j as e,c as js,L as se}from"./index-dxUAcY-k.js";import{b as fs}from"./use-work-items-BlOmoQYr.js";import{m as G,E as xe,u as gs}from"./use-memories-3zN7xhbg.js";import{u as Ns,C as ze,E as vs}from"./error-state-BDd6dVQJ.js";import{a as F}from"./api-client-CDvRtWmo.js";import{u as ys,A as De}from"./use-activity-Dxm__axy.js";import{u as $e,T as ue,a as he,b as U,c as R,d as bs,G as ks}from"./tabs-ChKoIxxZ.js";import{r as Cs,b as ws,c as zs}from"./work-item-utils-RZsWa1qH.js";import{S as V,c as Se,C as $,b as A,a as Ds,d as le,e as oe}from"./card-CWJTJVZ6.js";import{c as E,B as m,a as S,u as Ae}from"./button-BqoICpPk.js";import{B as T}from"./badge-CfeH18ck.js";import{S as Ss}from"./scroll-area-DwP-oL9g.js";import{I as O}from"./input-Te8OuQDQ.js";import{C as Ue}from"./chevron-right-gRUN2IWL.js";import{C as ne,S as _s,a as Ts,b as Ms,c as Is,d as Es,u as Ps}from"./select-Dd62rKlS.js";import{X as pe,D as Ls,a as $s,b as As,c as Us,d as Rs,e as Bs}from"./dialog-BASUQdY5.js";import{P as re,T as je,L as fe,D as ge,a as Ne,b as ve,c as te}from"./dropdown-menu-EghxLg4O.js";import{F as Z,C as Y,U as Re}from"./users-B5K-FOO3.js";import{T as ye,G as qs,u as Ws,D as Ks,U as Vs}from"./use-work-item-delete-Bb0OqnoF.js";import{F as be}from"./folder-CTsiFJB2.js";import{U as Fs}from"./user-BwVCIEz4.js";import{C as X}from"./clock-C-2K3YI1.js";import{T as Be}from"./textarea-C1kQ-UYx.js";import{E as qe}from"./eye-CWETns7v.js";import{P as ke,c as _e,a as Os}from"./index-6gjEHE0t.js";import{a as Hs}from"./index-VD3BCwW8.js";import{u as Qs}from"./index-BOjStPRS.js";import{P as Gs}from"./index-CsDA_5tK.js";import{P as J}from"./plus-xSznKAtD.js";import{L as W}from"./link-2-B2zmmBfz.js";import{L as Ys}from"./list-CrMmrEq-.js";import{M as ae}from"./mail-i0xYxvgr.js";import{N as Xs}from"./network-D9z3TJKB.js";import{B as Js}from"./brain-DEFHMO13.js";import"./index-CGYBnVZB.js";import"./index-BdQq_4o_.js";import"./chevron-down-DvGeT3kk.js";const Zs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],et=E("arrow-left",Zs);const st=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],tt=E("arrow-right",st);const at=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],it=E("bold",at);const nt=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],rt=E("code",nt);const ct=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],lt=E("italic",ct);const ot=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],dt=E("list-ordered",ot);const mt=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],xt=E("map-pin",mt);const ut=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],ht=E("paperclip",ut);const pt=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],jt=E("pen-line",pt);const ft=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],gt=E("pen",ft);const Nt=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],vt=E("square-check-big",Nt);const yt=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],We=E("unlink",yt);const bt=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],kt=E("video",bt),ie={all:["communications"],forWorkItem:s=>[...ie.all,"work-item",s]};function Ct(s){return Ns({queryKey:ie.forWorkItem(s),queryFn:({signal:t})=>F.get(`/api/work-items/${s}/communications`,{signal:t}),enabled:!!s})}function wt(){const s=me();return $e({mutationFn:({workItemId:t,body:i})=>F.post(`/api/work-items/${t}/memories`,i),onSuccess:(t,{workItemId:i})=>{s.invalidateQueries({queryKey:G.forWorkItem(i)}),s.invalidateQueries({queryKey:G.lists()})}})}function zt(){const s=me();return $e({mutationFn:({id:t,body:i})=>F.patch(`/api/memories/${t}`,i),onSuccess:(t,{workItemId:i})=>{s.invalidateQueries({queryKey:G.lists()}),i&&s.invalidateQueries({queryKey:G.forWorkItem(i)})}})}function Dt(s){switch(s){case"project":return e.jsx(be,{className:"size-5"});case"initiative":return e.jsx(ye,{className:"size-5"});case"epic":return e.jsx(fe,{className:"size-5"});case"issue":return e.jsx(Z,{className:"size-5"})}}function St(s){return s.charAt(0).toUpperCase()+s.slice(1)}function _t(s){switch(s){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function Tt(s){return s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}function Mt({title:s,kind:t,status:i,parentTitle:l,onTitleChange:o,onParentClick:a,onDelete:c,className:r}){const[p,j]=g.useState(!1),[d,u]=g.useState(s),f=()=>{u(s),j(!0)},v=()=>{d.trim()&&d!==s&&o?.(d.trim()),j(!1)},z=()=>{u(s),j(!1)},k=y=>{y.key==="Enter"?v():y.key==="Escape"&&z()};return e.jsxs("div",{className:S("space-y-2",r),children:[l&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("button",{className:"hover:text-foreground hover:underline",onClick:a,children:l}),e.jsx(Ue,{className:"size-4"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 text-muted-foreground",children:Dt(t)}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-2",children:[p?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{value:d,onChange:y=>u(y.target.value),onKeyDown:k,autoFocus:!0,className:"text-xl font-semibold"}),e.jsxs(m,{variant:"ghost",size:"icon",onClick:v,children:[e.jsx(ne,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Save"})]}),e.jsxs(m,{variant:"ghost",size:"icon",onClick:z,children:[e.jsx(pe,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Cancel"})]})]}):e.jsxs("div",{className:"group flex items-start gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold",children:s}),o&&e.jsxs(m,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 group-hover:opacity-100",onClick:f,children:[e.jsx(re,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Edit title"})]}),c&&e.jsxs(m,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 text-destructive hover:text-destructive group-hover:opacity-100",onClick:c,children:[e.jsx(je,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(T,{variant:"outline",children:St(t)}),e.jsx(T,{variant:_t(i),children:Tt(i)})]})]})]})]})}function Te(s){return s?s.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"Not set"}function Me(s){if(!s)return"Not set";if(s<60)return`${s}m`;const t=Math.floor(s/60),i=s%60;return i>0?`${t}h ${i}m`:`${t}h`}function q({icon:s,label:t,value:i,editable:l,onEdit:o,editType:a="text",options:c}){const[r,p]=g.useState(!1),[j,d]=g.useState(i),u=()=>{o?.(j),p(!1)},f=()=>{d(i),p(!1)};return e.jsxs("div",{className:"flex items-start gap-3 rounded-md p-2 hover:bg-muted/50",children:[e.jsx("span",{className:"mt-0.5 text-muted-foreground",children:s}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:t}),r?e.jsxs("div",{className:"mt-1 flex items-center gap-1",children:[a==="select"&&c?e.jsxs(_s,{value:j,onValueChange:d,children:[e.jsx(Ts,{className:"h-8 text-sm",children:e.jsx(Ms,{})}),e.jsx(Is,{children:c.map(v=>e.jsx(Es,{value:v.value,children:v.label},v.value))})]}):a==="date"?e.jsx(O,{type:"date",value:j,onChange:v=>d(v.target.value),className:"h-8 text-sm"}):e.jsx(O,{type:a==="number"?"number":"text",value:j,onChange:v=>d(v.target.value),className:"h-8 text-sm"}),e.jsx(m,{variant:"ghost",size:"icon",className:"size-6",onClick:u,children:e.jsx(ne,{className:"size-3"})}),e.jsx(m,{variant:"ghost",size:"icon",className:"size-6",onClick:f,children:e.jsx(pe,{className:"size-3"})})]}):e.jsxs("div",{className:"group flex items-center gap-1",children:[e.jsx("p",{className:"text-sm",children:i}),l&&o&&e.jsx(m,{variant:"ghost",size:"icon",className:"size-5 opacity-0 group-hover:opacity-100",onClick:()=>p(!0),children:e.jsx(re,{className:"size-3"})})]})]})]})}const Ie=[{value:"not_started",label:"Not Started"},{value:"in_progress",label:"In Progress"},{value:"blocked",label:"Blocked"},{value:"done",label:"Done"},{value:"cancelled",label:"Cancelled"}],Ee=[{value:"urgent",label:"Urgent"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}];function It({status:s,priority:t,assignee:i,dueDate:l,startDate:o,estimateMinutes:a,actualMinutes:c,onStatusChange:r,onPriorityChange:p,onAssigneeChange:j,onDueDateChange:d,onStartDateChange:u,onEstimateChange:f,onActualChange:v,className:z}){const k=N=>Ee.find(C=>C.value===N)?.label??N,y=N=>Ie.find(C=>C.value===N)?.label??N;return e.jsxs("div",{className:S("grid gap-1 sm:grid-cols-2",z),children:[e.jsx(q,{icon:e.jsx(ze,{className:"size-4"}),label:"Status",value:y(s),editable:!!r,onEdit:N=>r?.(N),editType:"select",options:Ie}),e.jsx(q,{icon:e.jsx(ze,{className:"size-4"}),label:"Priority",value:k(t),editable:!!p,onEdit:N=>p?.(N),editType:"select",options:Ee}),e.jsx(q,{icon:e.jsx(Fs,{className:"size-4"}),label:"Assignee",value:i||"Unassigned",editable:!!j,onEdit:j}),e.jsx(q,{icon:e.jsx(Y,{className:"size-4"}),label:"Due Date",value:Te(l),editable:!!d,onEdit:d,editType:"date"}),e.jsx(q,{icon:e.jsx(Y,{className:"size-4"}),label:"Start Date",value:Te(o),editable:!!u,onEdit:u,editType:"date"}),e.jsx(q,{icon:e.jsx(X,{className:"size-4"}),label:"Estimate",value:Me(a),editable:!!f,onEdit:f,editType:"number"}),e.jsx(q,{icon:e.jsx(X,{className:"size-4"}),label:"Actual",value:Me(c),editable:!!v,onEdit:v,editType:"number"})]})}function Et({description:s,onDescriptionChange:t,className:i}){const[l,o]=g.useState(!1),[a,c]=g.useState(s||""),[r,p]=g.useState(!1),j=()=>{c(s||""),o(!0),p(!1)},d=()=>{t?.(a),o(!1)},u=()=>{c(s||""),o(!1),p(!1)},f=v=>v?v.split(`
`).map((k,y)=>{if(k.startsWith("### "))return e.jsx("h4",{className:"mt-4 mb-2 text-sm font-semibold",children:k.slice(4)},y);if(k.startsWith("## "))return e.jsx("h3",{className:"mt-4 mb-2 font-semibold",children:k.slice(3)},y);if(k.startsWith("# "))return e.jsx("h2",{className:"mt-4 mb-2 text-lg font-semibold",children:k.slice(2)},y);if(k.startsWith("- ")||k.startsWith("* "))return e.jsx("li",{className:"ml-4",children:k.slice(2)},y);if(!k.trim())return e.jsx("br",{},y);const N=C=>{const _=[];let b=C,P=0;for(;b.length>0;){const x=b.match(/^`([^`]+)`/);if(x){_.push(e.jsx("code",{className:"rounded bg-muted px-1 text-sm",children:x[1]},P++)),b=b.slice(x[0].length);continue}const w=b.match(/^\*\*([^*]+)\*\*/);if(w){_.push(e.jsx("strong",{children:w[1]},P++)),b=b.slice(w[0].length);continue}const D=b.match(/^\*([^*]+)\*/);if(D){_.push(e.jsx("em",{children:D[1]},P++)),b=b.slice(D[0].length);continue}const M=b.search(/[`*]/);if(M===-1){_.push(b);break}else M===0?(_.push(b[0]),b=b.slice(1)):(_.push(b.slice(0,M)),b=b.slice(M))}return _};return e.jsx("p",{className:"my-1",children:N(k)},y)}):null;return e.jsxs("div",{className:S("space-y-3",i),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Description"}),!l&&t&&e.jsxs(m,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:j,children:[e.jsx(re,{className:"size-3"}),"Edit"]}),l&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:S("h-7 gap-1",!r&&"bg-muted"),onClick:()=>p(!1),children:[e.jsx(gt,{className:"size-3"}),"Edit"]}),e.jsxs(m,{variant:"ghost",size:"sm",className:S("h-7 gap-1",r&&"bg-muted"),onClick:()=>p(!0),children:[e.jsx(qe,{className:"size-3"}),"Preview"]})]})]}),l?e.jsxs("div",{className:"space-y-3",children:[r?e.jsx("div",{className:"min-h-32 rounded-md border bg-muted/30 p-3 text-sm",children:a?f(a):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})}):e.jsx(Be,{value:a,onChange:v=>c(v.target.value),placeholder:"Add a description... (Markdown supported)",className:"min-h-32 font-mono text-sm"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:u,children:[e.jsx(pe,{className:"mr-1 size-3"}),"Cancel"]}),e.jsxs(m,{size:"sm",onClick:d,children:[e.jsx(ne,{className:"mr-1 size-3"}),"Save"]})]})]}):s?e.jsx("div",{className:"prose prose-sm max-w-none rounded-md bg-muted/30 p-3",children:f(s)}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No description"})]})}var ce="Checkbox",[Pt]=Os(ce),[Lt,Ce]=Pt(ce);function $t(s){const{__scopeCheckbox:t,checked:i,children:l,defaultChecked:o,disabled:a,form:c,name:r,onCheckedChange:p,required:j,value:d="on",internal_do_not_use_render:u}=s,[f,v]=Hs({prop:i,defaultProp:o??!1,onChange:p,caller:ce}),[z,k]=g.useState(null),[y,N]=g.useState(null),C=g.useRef(!1),_=z?!!c||!!z.closest("form"):!0,b={checked:f,disabled:a,setChecked:v,control:z,setControl:k,name:r,form:c,value:d,hasConsumerStoppedPropagationRef:C,required:j,defaultChecked:B(o)?!1:o,isFormControl:_,bubbleInput:y,setBubbleInput:N};return e.jsx(Lt,{scope:t,...b,children:At(u)?u(b):l})}var Ke="CheckboxTrigger",Ve=g.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:i,...l},o)=>{const{control:a,value:c,disabled:r,checked:p,required:j,setControl:d,setChecked:u,hasConsumerStoppedPropagationRef:f,isFormControl:v,bubbleInput:z}=Ce(Ke,s),k=Ae(o,d),y=g.useRef(p);return g.useEffect(()=>{const N=a?.form;if(N){const C=()=>u(y.current);return N.addEventListener("reset",C),()=>N.removeEventListener("reset",C)}},[a,u]),e.jsx(ke.button,{type:"button",role:"checkbox","aria-checked":B(p)?"mixed":p,"aria-required":j,"data-state":Ye(p),"data-disabled":r?"":void 0,disabled:r,value:c,...l,ref:k,onKeyDown:_e(t,N=>{N.key==="Enter"&&N.preventDefault()}),onClick:_e(i,N=>{u(C=>B(C)?!0:!C),z&&v&&(f.current=N.isPropagationStopped(),f.current||N.stopPropagation())})})});Ve.displayName=Ke;var Fe=g.forwardRef((s,t)=>{const{__scopeCheckbox:i,name:l,checked:o,defaultChecked:a,required:c,disabled:r,value:p,onCheckedChange:j,form:d,...u}=s;return e.jsx($t,{__scopeCheckbox:i,checked:o,defaultChecked:a,disabled:r,required:c,onCheckedChange:j,name:l,form:d,value:p,internal_do_not_use_render:({isFormControl:f})=>e.jsxs(e.Fragment,{children:[e.jsx(Ve,{...u,ref:t,__scopeCheckbox:i}),f&&e.jsx(Ge,{__scopeCheckbox:i})]})})});Fe.displayName=ce;var Oe="CheckboxIndicator",He=g.forwardRef((s,t)=>{const{__scopeCheckbox:i,forceMount:l,...o}=s,a=Ce(Oe,i);return e.jsx(Gs,{present:l||B(a.checked)||a.checked===!0,children:e.jsx(ke.span,{"data-state":Ye(a.checked),"data-disabled":a.disabled?"":void 0,...o,ref:t,style:{pointerEvents:"none",...s.style}})})});He.displayName=Oe;var Qe="CheckboxBubbleInput",Ge=g.forwardRef(({__scopeCheckbox:s,...t},i)=>{const{control:l,hasConsumerStoppedPropagationRef:o,checked:a,defaultChecked:c,required:r,disabled:p,name:j,value:d,form:u,bubbleInput:f,setBubbleInput:v}=Ce(Qe,s),z=Ae(i,v),k=Ps(a),y=Qs(l);g.useEffect(()=>{const C=f;if(!C)return;const _=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(_,"checked").set,x=!o.current;if(k!==a&&P){const w=new Event("click",{bubbles:x});C.indeterminate=B(a),P.call(C,B(a)?!1:a),C.dispatchEvent(w)}},[f,k,a,o]);const N=g.useRef(B(a)?!1:a);return e.jsx(ke.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??N.current,required:r,disabled:p,name:j,value:d,form:u,...t,tabIndex:-1,ref:z,style:{...t.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Ge.displayName=Qe;function At(s){return typeof s=="function"}function B(s){return s==="indeterminate"}function Ye(s){return B(s)?"indeterminate":s?"checked":"unchecked"}function Ut({className:s,...t}){return e.jsx(Fe,{"data-slot":"checkbox",className:S("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(He,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:e.jsx(ne,{className:"size-3.5"})})})}function Rt({todos:s,onAdd:t,onToggle:i,onDelete:l,className:o}){const[a,c]=g.useState(""),r=()=>{a.trim()&&t&&(t(a.trim()),c(""))},p=d=>{d.key==="Enter"&&r()},j=s.filter(d=>d.completed).length;return e.jsxs("div",{className:S("space-y-3",o),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Checklist"}),s.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[j,"/",s.length," completed"]})]}),s.length>0&&e.jsx("div",{className:"h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${j/s.length*100}%`}})}),e.jsx("div",{className:"space-y-1",children:s.map(d=>e.jsxs("div",{"data-testid":"todo-item",className:S("group flex items-center gap-2 rounded-md px-2 py-1.5","hover:bg-muted/50"),children:[e.jsx(qs,{className:"size-4 cursor-grab text-muted-foreground opacity-0 group-hover:opacity-100"}),e.jsx(Ut,{checked:d.completed,onCheckedChange:u=>i?.(d.id,u===!0),"aria-label":`Mark "${d.text}" as ${d.completed?"incomplete":"complete"}`}),e.jsx("span",{className:S("flex-1 text-sm",d.completed&&"text-muted-foreground line-through"),children:d.text}),l&&e.jsxs(m,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:()=>l(d.id),children:[e.jsx(je,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]},d.id))}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"size-4 text-muted-foreground"}),e.jsx(O,{value:a,onChange:d=>c(d.target.value),onKeyDown:p,placeholder:"Add a task...",className:"h-8 flex-1"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:r,disabled:!a.trim(),children:"Add"})]}),s.length===0&&!t&&e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No tasks yet"})]})}function Bt(s){switch(s){case"project":return e.jsx(be,{className:"size-4"});case"initiative":return e.jsx(ye,{className:"size-4"});case"epic":return e.jsx(fe,{className:"size-4"});case"issue":return e.jsx(Z,{className:"size-4"})}}function qt(s){switch(s){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function Wt(s){return s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}function Kt({dependencies:s,onDependencyClick:t,onAddDependency:i,className:l}){const o=s.filter(r=>r.direction==="blocked_by"),a=s.filter(r=>r.direction==="blocks"),c=r=>e.jsxs("button",{"data-testid":"dependency-item",className:S("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",t&&"cursor-pointer"),onClick:()=>t?.(r),children:[e.jsx("span",{className:"text-muted-foreground",children:Bt(r.kind)}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm",children:r.title}),e.jsx(T,{variant:qt(r.status),className:"shrink-0 text-xs",children:Wt(r.status)})]},r.id);return e.jsxs("div",{className:S("space-y-4",l),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(et,{className:"size-4"}),"Blocked by (",o.length,")"]}),i&&e.jsxs(m,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>i("blocked_by"),children:[e.jsx(J,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add blocker"})]})]}),o.length>0?e.jsx("div",{className:"space-y-1",children:o.map(c)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No blockers"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(tt,{className:"size-4"}),"Blocks (",a.length,")"]}),i&&e.jsxs(m,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>i("blocks"),children:[e.jsx(J,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add dependent"})]})]}),a.length>0?e.jsx("div",{className:"space-y-1",children:a.map(c)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No dependents"})]})]})}function Vt(s){switch(s){case"project":return e.jsx(be,{className:"size-3"});case"initiative":return e.jsx(ye,{className:"size-3"});case"epic":return e.jsx(fe,{className:"size-3"});case"issue":return e.jsx(Z,{className:"size-3"});default:return null}}function Ft({memory:s,onClick:t,onEdit:i,onDelete:l,className:o}){const a=s.content.slice(0,150)+(s.content.length>150?"...":"");return e.jsxs("div",{"data-testid":"memory-card",className:S("group relative rounded-lg border bg-card p-4 transition-colors hover:bg-accent/50",t&&"cursor-pointer",o),onClick:()=>t?.(s),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-medium leading-tight",children:s.title}),(i||l)&&e.jsxs(ge,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:c=>c.stopPropagation(),children:e.jsx(xe,{className:"size-4"})})}),e.jsxs(ve,{align:"end",children:[i&&e.jsxs(te,{onClick:c=>{c.stopPropagation(),i(s)},children:[e.jsx(re,{className:"mr-2 size-4"}),"Edit"]}),l&&e.jsxs(te,{className:"text-destructive focus:text-destructive",onClick:c=>{c.stopPropagation(),l(s)},children:[e.jsx(je,{className:"mr-2 size-4"}),"Delete"]})]})]})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground line-clamp-2",children:a}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:s.linkedItemKind&&s.linkedItemTitle&&e.jsxs("span",{className:"flex items-center gap-1",children:[Vt(s.linkedItemKind),e.jsx("span",{className:"truncate max-w-[120px]",children:s.linkedItemTitle})]})}),e.jsx("span",{children:s.updatedAt.toLocaleDateString()})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.tags.map(c=>e.jsx(T,{variant:"secondary",className:"text-xs",children:c},c))})]})}function Ot({memories:s,onMemoryClick:t,onAddMemory:i,onLinkMemory:l,onEditMemory:o,onDeleteMemory:a,className:c}){return e.jsxs("div",{className:S("space-y-4",c),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Memories"}),e.jsx(T,{variant:"secondary",className:"text-xs",children:s.length})]}),e.jsxs("div",{className:"flex gap-1",children:[l&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:l,children:[e.jsx(W,{className:"mr-1 size-3"}),"Link"]}),i&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:i,children:[e.jsx(J,{className:"mr-1 size-3"}),"Add"]})]})]}),s.length>0?e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:s.map(r=>e.jsx(Ft,{memory:r,onClick:t,onEdit:o,onDelete:a},r.id))}):e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx(Z,{className:"mx-auto size-8 text-muted-foreground/50"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"No memories attached"}),(i||l)&&e.jsxs("div",{className:"mt-3 flex justify-center gap-2",children:[i&&e.jsxs(m,{variant:"outline",size:"sm",onClick:i,children:[e.jsx(J,{className:"mr-1 size-3"}),"Create new"]}),l&&e.jsxs(m,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(W,{className:"mr-1 size-3"}),"Link existing"]})]})]})]})}function Ht({memory:s,open:t,onOpenChange:i,onSubmit:l,className:o}){const[a,c]=g.useState(s?.title??""),[r,p]=g.useState(s?.content??""),[j,d]=g.useState(""),[u,f]=g.useState(s?.tags??[]),[v,z]=g.useState("edit"),k=g.useRef(null),y=g.useCallback((x,w="")=>{const D=k.current;if(!D)return;const M=D.selectionStart,ee=D.selectionEnd,h=r.slice(M,ee),H=r.slice(0,M)+x+(h||"text")+w+r.slice(ee);p(H),setTimeout(()=>{D.focus();const K=M+x.length,Q=K+(h||"text").length;D.setSelectionRange(K,Q)},0)},[r]),N=()=>{const x=j.trim();x&&!u.includes(x)&&(f([...u,x]),d(""))},C=x=>{f(u.filter(w=>w!==x))},_=x=>{x.preventDefault(),l({title:a.trim(),content:r.trim(),tags:u.length>0?u:void 0})},b=a.trim()&&r.trim(),P=x=>x.split(`
`).map((w,D)=>w.startsWith("### ")?e.jsx("h3",{className:"text-lg font-semibold mt-4 mb-2",children:w.slice(4)},D):w.startsWith("## ")?e.jsx("h2",{className:"text-xl font-semibold mt-4 mb-2",children:w.slice(3)},D):w.startsWith("# ")?e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",children:w.slice(2)},D):w.startsWith("- ")||w.startsWith("* ")?e.jsx("li",{className:"ml-4",children:w.slice(2)},D):/^\d+\. /.test(w)?e.jsx("li",{className:"ml-4 list-decimal",children:w.replace(/^\d+\. /,"")},D):w.trim()?e.jsx("p",{className:"my-1",children:w},D):e.jsx("br",{},D));return e.jsx(Ls,{open:t,onOpenChange:i,children:e.jsxs($s,{className:S("sm:max-w-2xl",o),children:[e.jsxs(As,{children:[e.jsx(Us,{children:s?"Edit Memory":"Create Memory"}),e.jsx(Rs,{className:"sr-only",children:s?"Edit memory details":"Create a new memory entry"})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"memory-title",className:"text-sm font-medium",children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(O,{id:"memory-title",value:a,onChange:x=>c(x.target.value),placeholder:"Memory title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-medium",children:["Content ",e.jsx("span",{className:"text-destructive",children:"*"})]})}),e.jsxs(ue,{value:v,onValueChange:x=>z(x),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("**","**"),title:"Bold",children:e.jsx(it,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("*","*"),title:"Italic",children:e.jsx(lt,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("- "),title:"Bullet list",children:e.jsx(Ys,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("1. "),title:"Numbered list",children:e.jsx(dt,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("[","](url)"),title:"Link",children:e.jsx(W,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("`","`"),title:"Code",children:e.jsx(rt,{className:"size-4"})})]}),e.jsxs(he,{children:[e.jsxs(U,{value:"edit",className:"gap-1",children:[e.jsx(jt,{className:"size-3"}),"Edit"]}),e.jsxs(U,{value:"preview",className:"gap-1",children:[e.jsx(qe,{className:"size-3"}),"Preview"]})]})]}),e.jsx(R,{value:"edit",className:"mt-2",children:e.jsx(Be,{ref:k,value:r,onChange:x=>p(x.target.value),placeholder:"Write your memory content here... (Markdown supported)",className:"min-h-[200px] font-mono text-sm",required:!0})}),e.jsx(R,{value:"preview",className:"mt-2",children:e.jsx("div",{className:"min-h-[200px] rounded-md border bg-muted/30 p-4 text-sm",children:r?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:P(r)}):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"memory-tags",className:"text-sm font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{id:"memory-tags",value:j,onChange:x=>d(x.target.value),placeholder:"Add a tag",onKeyDown:x=>{x.key==="Enter"&&(x.preventDefault(),N())}}),e.jsx(m,{type:"button",variant:"outline",onClick:N,children:"Add"})]}),u.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:u.map(x=>e.jsxs(T,{variant:"secondary",className:"cursor-pointer",onClick:()=>C(x),children:[x," Ã—"]},x))})]}),e.jsxs(Bs,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:!b,children:s?"Save Changes":"Create Memory"})]})]})]})})}function Qt({email:s,onClick:t,onUnlink:i,className:l}){return e.jsxs("div",{"data-testid":"email-card",className:S("group flex items-start gap-3 rounded-lg border bg-card p-3 transition-colors hover:bg-accent/50",t&&"cursor-pointer",!s.isRead&&"border-l-2 border-l-primary",l),onClick:()=>t?.(s),children:[e.jsx("div",{className:"mt-0.5 flex size-8 shrink-0 items-center justify-center rounded-full bg-primary/10",children:e.jsx(ae,{className:"size-4 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:S("truncate text-sm",!s.isRead&&"font-semibold"),children:s.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.from.name||s.from.email})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[s.hasAttachments&&e.jsx(ht,{className:"size-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Gt(s.date)}),i&&e.jsxs(ge,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:o=>o.stopPropagation(),children:e.jsx(xe,{className:"size-4"})})}),e.jsx(ve,{align:"end",children:e.jsxs(te,{className:"text-destructive focus:text-destructive",onClick:o=>{o.stopPropagation(),i(s)},children:[e.jsx(We,{className:"mr-2 size-4"}),"Unlink"]})})]})]})]}),e.jsx("p",{className:"mt-1 line-clamp-2 text-xs text-muted-foreground",children:s.snippet})]})]})}function Gt(s){const i=new Date().getTime()-s.getTime(),l=Math.floor(i/(1e3*60*60*24));return l===0?s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):l===1?"Yesterday":l<7?s.toLocaleDateString([],{weekday:"short"}):s.toLocaleDateString([],{month:"short",day:"numeric"})}function Yt({event:s,onClick:t,onUnlink:i,className:l}){const o=s.endTime<new Date,a=Xt(s.startTime,new Date);return e.jsxs("div",{"data-testid":"calendar-event-card",className:S("group flex items-start gap-3 rounded-lg border bg-card p-3 transition-colors hover:bg-accent/50",t&&"cursor-pointer",o&&"opacity-60",l),onClick:()=>t?.(s),children:[e.jsxs("div",{className:S("flex size-12 shrink-0 flex-col items-center justify-center rounded-lg",a?"bg-primary text-primary-foreground":"bg-muted"),children:[e.jsx("span",{className:"text-[10px] font-medium uppercase",children:s.startTime.toLocaleDateString([],{weekday:"short"})}),e.jsx("span",{className:"text-lg font-bold",children:s.startTime.getDate()})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-medium leading-tight",children:s.title}),i&&e.jsxs(ge,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:c=>c.stopPropagation(),children:e.jsx(xe,{className:"size-4"})})}),e.jsx(ve,{align:"end",children:e.jsxs(te,{className:"text-destructive focus:text-destructive",onClick:c=>{c.stopPropagation(),i(s)},children:[e.jsx(We,{className:"mr-2 size-4"}),"Unlink"]})})]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(X,{className:"size-3"}),e.jsx("span",{children:s.isAllDay?"All day":`${Pe(s.startTime)} - ${Pe(s.endTime)}`})]}),s.location&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(xt,{className:"size-3"}),e.jsx("span",{className:"truncate",children:s.location})]}),s.meetingLink&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-primary",children:[e.jsx(kt,{className:"size-3"}),e.jsx("span",{children:"Video meeting"})]}),s.attendees.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(Re,{className:"size-3 text-muted-foreground"}),e.jsxs("div",{className:"flex items-center gap-1",children:[s.attendees.slice(0,3).map((c,r)=>e.jsx(T,{variant:c.status==="accepted"?"default":c.status==="declined"?"destructive":"secondary",className:"text-[10px] px-1.5 py-0",children:c.name.split(" ")[0]},c.email)),s.attendees.length>3&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.attendees.length-3]})]})]})]})]})}function Pe(s){return s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function Xt(s,t){return s.getFullYear()===t.getFullYear()&&s.getMonth()===t.getMonth()&&s.getDate()===t.getDate()}function Jt({emails:s,calendarEvents:t,onEmailClick:i,onEventClick:l,onUnlinkEmail:o,onUnlinkEvent:a,onLinkEmail:c,onLinkEvent:r,className:p}){const[j,d]=g.useState("emails"),u=s.length+t.length;return e.jsxs("div",{className:S("space-y-4",p),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Communications"}),e.jsx(T,{variant:"secondary",className:"text-xs",children:u})]})}),e.jsxs(ue,{value:j,onValueChange:f=>d(f),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(he,{children:[e.jsxs(U,{value:"emails",className:"gap-1",children:[e.jsx(ae,{className:"size-3"}),"Emails",s.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:s.length})]}),e.jsxs(U,{value:"calendar",className:"gap-1",children:[e.jsx(Y,{className:"size-3"}),"Calendar",t.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:t.length})]})]}),j==="emails"&&c&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:c,children:[e.jsx(W,{className:"mr-1 size-3"}),"Link Email"]}),j==="calendar"&&r&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(W,{className:"mr-1 size-3"}),"Link Event"]})]}),e.jsx(R,{value:"emails",className:"mt-4",children:s.length>0?e.jsx("div",{className:"space-y-2",children:s.map(f=>e.jsx(Qt,{email:f,onClick:i,onUnlink:o},f.id))}):e.jsx(Le,{icon:e.jsx(ae,{className:"size-8"}),message:"No linked emails",action:c&&e.jsxs(m,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(W,{className:"mr-1 size-3"}),"Link an email"]})})}),e.jsx(R,{value:"calendar",className:"mt-4",children:t.length>0?e.jsx("div",{className:"space-y-2",children:t.map(f=>e.jsx(Yt,{event:f,onClick:l,onUnlink:a},f.id))}):e.jsx(Le,{icon:e.jsx(Y,{className:"size-8"}),message:"No linked calendar events",action:r&&e.jsxs(m,{variant:"outline",size:"sm",onClick:r,children:[e.jsx(W,{className:"mr-1 size-3"}),"Link an event"]})})})]})]})}function Le({icon:s,message:t,action:i}){return e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx("div",{className:"mx-auto text-muted-foreground/50",children:s}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t}),i&&e.jsx("div",{className:"mt-3",children:i})]})}function de(s){const i=new Date().getTime()-s.getTime(),l=Math.floor(i/6e4),o=Math.floor(l/60),a=Math.floor(o/24);return l<1?"just now":l<60?`${l}m ago`:o<24?`${o}h ago`:a<7?`${a}d ago`:s.toLocaleDateString(void 0,{month:"short",day:"numeric"})}function $a(){const{id:s}=js(),t=s??"",i=me(),o=Cs()?.participants??[],{data:a,isLoading:c,error:r}=fs(t),{data:p,isLoading:j}=gs(t),{data:d,isLoading:u}=Ct(t),{data:f,isLoading:v}=ys(50),z=bs(),k=wt(),y=zt(),[N,C]=g.useState(!1),[_,b]=g.useState(null),[P,x]=g.useState(!1),{deleteItem:w,isDeleting:D,undoState:M,dismissUndo:ee}=Ws({onDeleted:()=>{window.location.href="/app/work-items"}}),h=a?(()=>{const n=[];return a.dependencies?.blocks&&n.push(...a.dependencies.blocks.map(I=>({id:I.id,title:I.title,kind:"issue",status:"not_started",direction:"blocks"}))),a.dependencies?.blocked_by&&n.push(...a.dependencies.blocked_by.map(I=>({id:I.id,title:I.title,kind:"issue",status:"not_started",direction:"blocked_by"}))),{id:a.id,title:a.title,kind:a.kind||"issue",status:a.status||"not_started",priority:ws(a.priority),description:a.description||void 0,parentId:a.parent_id||void 0,parentTitle:a.parent?.title,estimateMinutes:a.estimate_minutes||void 0,actualMinutes:a.actual_minutes||void 0,dueDate:a.not_after?new Date(a.not_after):void 0,startDate:a.not_before?new Date(a.not_before):void 0,createdAt:new Date(a.created_at),updatedAt:new Date(a.updated_at),todos:[],attachments:[],dependencies:n}})():null,H=(p?.memories??[]).map(n=>({id:n.id,title:n.title,content:n.content,linkedItemId:t,linkedItemTitle:h?.title||void 0,linkedItemKind:h?.kind||"issue",createdAt:new Date(n.created_at),updatedAt:new Date(n.updated_at)})),K=(d?.emails??[]).map(n=>({id:n.id,subject:"Email",from:{name:"Unknown",email:""},to:[],date:n.received_at?new Date(n.received_at):new Date,snippet:n.body?.substring(0,100)||"",body:n.body||void 0})),Q=(d?.calendar_events??[]).map(n=>({id:n.id,title:"Calendar Event",startTime:n.received_at?new Date(n.received_at):new Date,endTime:n.received_at?new Date(n.received_at):new Date,attendees:[]})),we=(f?.items??[]).filter(n=>n.work_item_id===t),L=g.useCallback(n=>{z.mutate({id:t,body:n})},[t,z]),Xe=n=>L({title:n}),Je=n=>L({description:n}),Ze=n=>L({status:n}),es=n=>L({priority:zs(n)}),ss=n=>L({notAfter:n||null}),ts=n=>L({notBefore:n||null}),as=n=>{const I=parseInt(n,10);L({estimateMinutes:isNaN(I)?null:I})},is=n=>{const I=parseInt(n,10);L({actualMinutes:isNaN(I)?null:I})},ns=()=>{h?.parentId&&(window.location.href=`/app/work-items/${h.parentId}`)},rs=n=>{window.location.href=`/app/work-items/${n.id}`},cs=()=>{b(null),C(!0)},ls=n=>{b(n),C(!0)},os=n=>{k.mutate({workItemId:t,body:{title:n.title,content:n.content,type:"note"}},{onSuccess:()=>C(!1)})},ds=n=>{_&&y.mutate({id:_.id,body:{title:n.title,content:n.content},workItemId:t},{onSuccess:()=>{C(!1),b(null)}})},ms=async n=>{if(confirm(`Delete memory "${n.title}"?`))try{await F.delete(`/api/memories/${n.id}`),i.invalidateQueries({queryKey:G.forWorkItem(t)})}catch{}},xs=async n=>{if(confirm("Unlink this email from the work item?"))try{await F.delete(`/api/work-items/${t}/communications/${n.id}`),i.invalidateQueries({queryKey:ie.forWorkItem(t)})}catch{}},us=async n=>{if(confirm("Unlink this event from the work item?"))try{await F.delete(`/api/work-items/${t}/communications/${n.id}`),i.invalidateQueries({queryKey:ie.forWorkItem(t)})}catch{}},hs=()=>x(!0),ps=async()=>{h&&(await w({id:h.id,title:h.title}),x(!1))};return c?e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center gap-4",children:[e.jsx(V,{width:80,height:32}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{width:100,height:32}),e.jsx(V,{width:120,height:32})]})]}),e.jsx("div",{className:"flex-1 p-6",children:e.jsxs("div",{className:"mx-auto max-w-5xl space-y-6",children:[e.jsx(Se,{}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Se,{})}),e.jsx("div",{children:e.jsx(V,{width:"100%",height:200})})]})]})})]}):r||!h?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(vs,{title:"Work Item Not Found",message:r instanceof Error?r.message:"The requested work item could not be loaded.",action:e.jsx(m,{variant:"outline",asChild:!0,children:e.jsx(se,{to:"/work-items",children:"Back to Work Items"})})})}):e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border bg-background flex items-center gap-4 shrink-0",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(se,{to:"/work-items",children:[e.jsx(Ue,{className:"mr-1 size-4 rotate-180"}),"Back"]})}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(m,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(se,{to:`/work-items/${t}/timeline`,children:[e.jsx(Y,{className:"mr-2 size-4"}),"Timeline"]})}),e.jsx(m,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(se,{to:`/work-items/${t}/graph`,children:[e.jsx(Xs,{className:"mr-2 size-4"}),"Dependencies"]})})]})]}),e.jsx(Ss,{className:"flex-1",children:e.jsxs("div",{className:"mx-auto max-w-5xl p-6 space-y-6",children:[e.jsx(Mt,{title:h.title,kind:h.kind,status:h.status,parentTitle:h.parentTitle,onTitleChange:Xe,onParentClick:ns,onDelete:hs}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"size-3"}),"Created ",de(h.createdAt)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"size-3"}),"Updated ",de(h.updatedAt)]}),z.isPending&&e.jsx(T,{variant:"outline",className:"text-xs animate-pulse",children:"Saving..."})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx($,{children:e.jsx(A,{className:"pt-4",children:e.jsx(It,{status:h.status,priority:h.priority,assignee:h.assignee,dueDate:h.dueDate,startDate:h.startDate,estimateMinutes:h.estimateMinutes,actualMinutes:h.actualMinutes,onStatusChange:Ze,onPriorityChange:es,onDueDateChange:ss,onStartDateChange:ts,onEstimateChange:as,onActualChange:is})})}),e.jsxs(ue,{defaultValue:"description",children:[e.jsxs(he,{variant:"line",className:"w-full justify-start",children:[e.jsxs(U,{value:"description",className:"gap-1.5",children:[e.jsx(Z,{className:"size-3.5"}),"Description"]}),e.jsxs(U,{value:"checklist",className:"gap-1.5",children:[e.jsx(vt,{className:"size-3.5"}),"Checklist",h.todos.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-xs px-1.5 py-0",children:h.todos.length})]}),e.jsxs(U,{value:"dependencies",className:"gap-1.5",children:[e.jsx(ks,{className:"size-3.5"}),"Dependencies",h.dependencies.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-xs px-1.5 py-0",children:h.dependencies.length})]}),e.jsxs(U,{value:"activity",className:"gap-1.5",children:[e.jsx(De,{className:"size-3.5"}),"Activity"]})]}),e.jsx(R,{value:"description","data-testid":"tab-content-description",children:e.jsx($,{children:e.jsx(A,{className:"pt-4",children:e.jsx(Et,{description:h.description,onDescriptionChange:Je})})})}),e.jsx(R,{value:"checklist","data-testid":"tab-content-checklist",children:e.jsx($,{children:e.jsx(A,{className:"pt-4",children:e.jsx(Rt,{todos:h.todos})})})}),e.jsx(R,{value:"dependencies","data-testid":"tab-content-dependencies",children:e.jsx($,{children:e.jsx(A,{className:"pt-4",children:e.jsx(Kt,{dependencies:h.dependencies,onDependencyClick:rs})})})}),e.jsx(R,{value:"activity","data-testid":"tab-content-activity",children:e.jsx($,{children:e.jsx(A,{className:"pt-4",children:v?e.jsx(Ds,{count:3,variant:"row"}):we.length===0?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(De,{className:"size-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No activity recorded yet"})]}):e.jsx("div",{className:"space-y-3",children:we.map(n=>e.jsxs("div",{className:"flex items-start gap-3 py-2 border-b border-border last:border-0",children:[e.jsx("div",{className:`size-7 rounded-full flex items-center justify-center shrink-0 ${n.actor_email?.includes("agent")?"bg-violet-500/10 text-violet-500 dark:bg-violet-500/20":"bg-primary/10 text-primary dark:bg-primary/20"}`,children:e.jsx("span",{className:"text-xs font-medium",children:(n.actor_email??"S").charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-foreground",children:n.actor_email||"System"})," ",e.jsx("span",{className:"text-muted-foreground",children:n.description})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:de(new Date(n.created_at))})]})]},n.id))})})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs($,{children:[e.jsx(le,{className:"pb-3",children:e.jsxs(oe,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Js,{className:"size-4 text-muted-foreground"}),"Memories",H.length>0&&e.jsx(T,{variant:"secondary",className:"text-xs px-1.5 py-0",children:H.length})]})}),e.jsx(A,{children:j?e.jsx(V,{width:"100%",height:80}):e.jsx(Ot,{memories:H,onAddMemory:cs,onEditMemory:ls,onDeleteMemory:ms})})]}),e.jsxs($,{children:[e.jsx(le,{className:"pb-3",children:e.jsxs(oe,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ae,{className:"size-4 text-muted-foreground"}),"Communications",K.length+Q.length>0&&e.jsx(T,{variant:"secondary",className:"text-xs px-1.5 py-0",children:K.length+Q.length})]})}),e.jsx(A,{children:u?e.jsx(V,{width:"100%",height:80}):e.jsx(Jt,{emails:K,calendarEvents:Q,onUnlinkEmail:xs,onUnlinkEvent:us})})]}),e.jsxs($,{children:[e.jsx(le,{className:"pb-3",children:e.jsxs(oe,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Re,{className:"size-4 text-muted-foreground"}),"Participants"]})}),e.jsx(A,{children:o.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"No participants assigned"}):e.jsx("ul",{className:"space-y-2",children:o.map((n,I)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-7 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:(n.participant??"U")[0].toUpperCase()})}),e.jsx("span",{className:"text-sm",children:n.participant??"Unknown"}),n.role&&e.jsx(T,{variant:"outline",className:"text-xs",children:n.role})]},I))})})]})]})]})]})}),e.jsx(Ht,{memory:_||void 0,open:N,onOpenChange:C,onSubmit:_?ds:os}),e.jsx(Ks,{open:P,onOpenChange:x,item:h?{id:h.id,title:h.title,kind:h.kind,childCount:0}:void 0,onConfirm:ps,isDeleting:D}),M&&e.jsx(Vs,{visible:!!M,itemTitle:M.itemTitle,onUndo:M.onUndo,onDismiss:ee})]})}export{$a as WorkItemDetailPage};
//# sourceMappingURL=WorkItemDetailPage-CfvrFQHJ.js.map
