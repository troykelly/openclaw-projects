import{S as hs,s as xs,h as ke,g as ps,n as Pe,b as Z,r as h,c as js,d as fs,j as e,e as gs,L as te}from"./index-nMqE_Vs3.js";import{w as W,P as ne,T as ue,L as he,a as xe,G as vs,d as Ns,c as ys,D as bs,U as ks}from"./use-work-item-delete-VCj3ySs_.js";import{u as $e,C as Ce,E as Cs}from"./error-state-DTZcQKZm.js";import{a as R}from"./api-client-CDvRtWmo.js";import{u as ws}from"./use-activity-BDmOn32i.js";import{r as zs,b as Ss,c as Ms}from"./work-item-utils-RZsWa1qH.js";import{S as Q,b as we,a as Ds}from"./skeleton-sgkYYJWR.js";import{c as T,B as m,a as _,u as Le}from"./button-TOpELVfJ.js";import{B as D}from"./badge-Dax4PfuM.js";import{C as q,a as U,b as le,c as oe}from"./card-Cz9VqdbX.js";import{E as _s,T as pe,a as je,b as A,c as K,d as Es,C as Is}from"./calendar-event-card-BVrLzqqr.js";import{P as Ts,S as Ps}from"./scroll-area-Bmw3Bpqm.js";import{I as H}from"./input-CAt6W29_.js";import{C as qe}from"./chevron-right-D_m52UsW.js";import{C as re}from"./chevron-down-DlP_B1Km.js";import{X as fe}from"./index-DfJ39bw3.js";import{F as ee,C as Y,U as $s}from"./users-BjVxdKN7.js";import{F as ge,P as J}from"./plus-DsTTZnY9.js";import{S as Ls,a as qs,b as Us,c as As,d as Ks,u as Rs}from"./select-0CRdn6aO.js";import{U as Os}from"./user-DgkJ5-Kl.js";import{C as ae}from"./clock-DUPEOUyY.js";import{T as Ue}from"./textarea-d6TV6RgY.js";import{E as Ae}from"./eye-C3arIwdG.js";import{P as ve,c as ze,a as Ws}from"./index-C41Rbgjy.js";import{a as Bs,d as Vs}from"./index-CXEZYiM0.js";import{D as Fs,a as Qs,b as Hs,c as Se}from"./dropdown-menu-CjV_7CoQ.js";import{L as V}from"./link-2-BzopnU_L.js";import{D as Gs,a as Xs,b as Ys,c as Js,d as Zs,e as et}from"./dialog-cy3yLWXM.js";import{L as st}from"./list-8z22WOZA.js";import{M as me}from"./mail-Bsr1blDG.js";import{N as tt}from"./network-B8nS0BsK.js";var at=class extends hs{#s;#a=void 0;#e;#t;constructor(s,t){super(),this.#s=s,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const t=this.options;this.options=this.#s.defaultMutationOptions(s),xs(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&ke(t.mutationKey)!==ke(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(s){this.#i(),this.#n(s)}getCurrentResult(){return this.#a}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#n()}mutate(s,t){return this.#t=t,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(s)}#i(){const s=this.#e?.state??ps();this.#a={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#n(s){Pe.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#a.variables,a=this.#a.context,r={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};if(s?.type==="success"){try{this.#t.onSuccess?.(s.data,t,a,r)}catch(c){Promise.reject(c)}try{this.#t.onSettled?.(s.data,null,t,a,r)}catch(c){Promise.reject(c)}}else if(s?.type==="error"){try{this.#t.onError?.(s.error,t,a,r)}catch(c){Promise.reject(c)}try{this.#t.onSettled?.(void 0,s.error,t,a,r)}catch(c){Promise.reject(c)}}}this.listeners.forEach(t=>{t(this.#a)})})}};function Ne(s,t){const a=Z(),[r]=h.useState(()=>new at(a,s));h.useEffect(()=>{r.setOptions(s)},[r,s]);const c=h.useSyncExternalStore(h.useCallback(o=>r.subscribe(Pe.batchCalls(o)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),i=h.useCallback((o,l)=>{r.mutate(o,l).catch(js)},[r]);if(c.error&&fs(r.options.throwOnError,[c.error]))throw c.error;return{...c,mutate:i,mutateAsync:c.mutate}}const it=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Me=T("activity",it);const nt=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],rt=T("arrow-left",nt);const ct=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],lt=T("arrow-right",ct);const ot=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],dt=T("bold",ot);const mt=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],ut=T("brain",mt);const ht=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],xt=T("code",ht);const pt=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],jt=T("git-branch",pt);const ft=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],gt=T("italic",ft);const vt=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],Nt=T("list-ordered",vt);const yt=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],bt=T("pen-line",yt);const kt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Ct=T("pen",kt);const wt=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],zt=T("square-check-big",wt),$={all:["memories"],lists:()=>[...$.all,"list"],list:()=>[...$.lists()],forWorkItem:s=>[...$.all,"work-item",s]};function St(s){return $e({queryKey:$.forWorkItem(s),queryFn:({signal:t})=>R.get(`/api/work-items/${s}/memories`,{signal:t}),enabled:!!s})}const ie={all:["communications"],forWorkItem:s=>[...ie.all,"work-item",s]};function Mt(s){return $e({queryKey:ie.forWorkItem(s),queryFn:({signal:t})=>R.get(`/api/work-items/${s}/communications`,{signal:t}),enabled:!!s})}function Dt(){const s=Z();return Ne({mutationFn:({id:t,body:a})=>R.put(`/api/work-items/${t}`,a),onMutate:async({id:t,body:a})=>{await s.cancelQueries({queryKey:W.detail(t)});const r=s.getQueryData(W.detail(t));if(r){const c={...r,...a.title!==void 0?{title:a.title}:{},...a.status!==void 0?{status:a.status}:{},...a.priority!==void 0?{priority:a.priority}:{},...a.description!==void 0?{description:a.description}:{}};s.setQueryData(W.detail(t),c)}return{previousDetail:r}},onError:(t,{id:a},r)=>{r?.previousDetail&&s.setQueryData(W.detail(a),r.previousDetail)},onSettled:(t,a,{id:r})=>{s.invalidateQueries({queryKey:W.detail(r)}),s.invalidateQueries({queryKey:W.lists()}),s.invalidateQueries({queryKey:W.tree()})}})}function _t(){const s=Z();return Ne({mutationFn:({workItemId:t,body:a})=>R.post(`/api/work-items/${t}/memories`,a),onSuccess:(t,{workItemId:a})=>{s.invalidateQueries({queryKey:$.forWorkItem(a)}),s.invalidateQueries({queryKey:$.lists()})}})}function Et(){const s=Z();return Ne({mutationFn:({id:t,body:a})=>R.patch(`/api/memories/${t}`,a),onSuccess:(t,{workItemId:a})=>{s.invalidateQueries({queryKey:$.lists()}),a&&s.invalidateQueries({queryKey:$.forWorkItem(a)})}})}function It(s){switch(s){case"project":return e.jsx(ge,{className:"size-5"});case"initiative":return e.jsx(xe,{className:"size-5"});case"epic":return e.jsx(he,{className:"size-5"});case"issue":return e.jsx(ee,{className:"size-5"})}}function Tt(s){return s.charAt(0).toUpperCase()+s.slice(1)}function Pt(s){switch(s){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function $t(s){return s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}function Lt({title:s,kind:t,status:a,parentTitle:r,onTitleChange:c,onParentClick:i,onDelete:o,className:l}){const[j,f]=h.useState(!1),[d,x]=h.useState(s),g=()=>{x(s),f(!0)},N=()=>{d.trim()&&d!==s&&c?.(d.trim()),f(!1)},z=()=>{x(s),f(!1)},k=y=>{y.key==="Enter"?N():y.key==="Escape"&&z()};return e.jsxs("div",{className:_("space-y-2",l),children:[r&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("button",{className:"hover:text-foreground hover:underline",onClick:i,children:r}),e.jsx(qe,{className:"size-4"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 text-muted-foreground",children:It(t)}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-2",children:[j?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{value:d,onChange:y=>x(y.target.value),onKeyDown:k,autoFocus:!0,className:"text-xl font-semibold"}),e.jsxs(m,{variant:"ghost",size:"icon",onClick:N,children:[e.jsx(re,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Save"})]}),e.jsxs(m,{variant:"ghost",size:"icon",onClick:z,children:[e.jsx(fe,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Cancel"})]})]}):e.jsxs("div",{className:"group flex items-start gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold",children:s}),c&&e.jsxs(m,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 group-hover:opacity-100",onClick:g,children:[e.jsx(ne,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Edit title"})]}),o&&e.jsxs(m,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 text-destructive hover:text-destructive group-hover:opacity-100",onClick:o,children:[e.jsx(ue,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(D,{variant:"outline",children:Tt(t)}),e.jsx(D,{variant:Pt(a),children:$t(a)})]})]})]})]})}function De(s){return s?s.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"Not set"}function _e(s){if(!s)return"Not set";if(s<60)return`${s}m`;const t=Math.floor(s/60),a=s%60;return a>0?`${t}h ${a}m`:`${t}h`}function B({icon:s,label:t,value:a,editable:r,onEdit:c,editType:i="text",options:o}){const[l,j]=h.useState(!1),[f,d]=h.useState(a),x=()=>{c?.(f),j(!1)},g=()=>{d(a),j(!1)};return e.jsxs("div",{className:"flex items-start gap-3 rounded-md p-2 hover:bg-muted/50",children:[e.jsx("span",{className:"mt-0.5 text-muted-foreground",children:s}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:t}),l?e.jsxs("div",{className:"mt-1 flex items-center gap-1",children:[i==="select"&&o?e.jsxs(Ls,{value:f,onValueChange:d,children:[e.jsx(qs,{className:"h-8 text-sm",children:e.jsx(Us,{})}),e.jsx(As,{children:o.map(N=>e.jsx(Ks,{value:N.value,children:N.label},N.value))})]}):i==="date"?e.jsx(H,{type:"date",value:f,onChange:N=>d(N.target.value),className:"h-8 text-sm"}):e.jsx(H,{type:i==="number"?"number":"text",value:f,onChange:N=>d(N.target.value),className:"h-8 text-sm"}),e.jsx(m,{variant:"ghost",size:"icon",className:"size-6",onClick:x,children:e.jsx(re,{className:"size-3"})}),e.jsx(m,{variant:"ghost",size:"icon",className:"size-6",onClick:g,children:e.jsx(fe,{className:"size-3"})})]}):e.jsxs("div",{className:"group flex items-center gap-1",children:[e.jsx("p",{className:"text-sm",children:a}),r&&c&&e.jsx(m,{variant:"ghost",size:"icon",className:"size-5 opacity-0 group-hover:opacity-100",onClick:()=>j(!0),children:e.jsx(ne,{className:"size-3"})})]})]})]})}const Ee=[{value:"not_started",label:"Not Started"},{value:"in_progress",label:"In Progress"},{value:"blocked",label:"Blocked"},{value:"done",label:"Done"},{value:"cancelled",label:"Cancelled"}],Ie=[{value:"urgent",label:"Urgent"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}];function qt({status:s,priority:t,assignee:a,dueDate:r,startDate:c,estimateMinutes:i,actualMinutes:o,onStatusChange:l,onPriorityChange:j,onAssigneeChange:f,onDueDateChange:d,onStartDateChange:x,onEstimateChange:g,onActualChange:N,className:z}){const k=v=>Ie.find(C=>C.value===v)?.label??v,y=v=>Ee.find(C=>C.value===v)?.label??v;return e.jsxs("div",{className:_("grid gap-1 sm:grid-cols-2",z),children:[e.jsx(B,{icon:e.jsx(Ce,{className:"size-4"}),label:"Status",value:y(s),editable:!!l,onEdit:v=>l?.(v),editType:"select",options:Ee}),e.jsx(B,{icon:e.jsx(Ce,{className:"size-4"}),label:"Priority",value:k(t),editable:!!j,onEdit:v=>j?.(v),editType:"select",options:Ie}),e.jsx(B,{icon:e.jsx(Os,{className:"size-4"}),label:"Assignee",value:a||"Unassigned",editable:!!f,onEdit:f}),e.jsx(B,{icon:e.jsx(Y,{className:"size-4"}),label:"Due Date",value:De(r),editable:!!d,onEdit:d,editType:"date"}),e.jsx(B,{icon:e.jsx(Y,{className:"size-4"}),label:"Start Date",value:De(c),editable:!!x,onEdit:x,editType:"date"}),e.jsx(B,{icon:e.jsx(ae,{className:"size-4"}),label:"Estimate",value:_e(i),editable:!!g,onEdit:g,editType:"number"}),e.jsx(B,{icon:e.jsx(ae,{className:"size-4"}),label:"Actual",value:_e(o),editable:!!N,onEdit:N,editType:"number"})]})}function Ut({description:s,onDescriptionChange:t,className:a}){const[r,c]=h.useState(!1),[i,o]=h.useState(s||""),[l,j]=h.useState(!1),f=()=>{o(s||""),c(!0),j(!1)},d=()=>{t?.(i),c(!1)},x=()=>{o(s||""),c(!1),j(!1)},g=N=>N?N.split(`
`).map((k,y)=>{if(k.startsWith("### "))return e.jsx("h4",{className:"mt-4 mb-2 text-sm font-semibold",children:k.slice(4)},y);if(k.startsWith("## "))return e.jsx("h3",{className:"mt-4 mb-2 font-semibold",children:k.slice(3)},y);if(k.startsWith("# "))return e.jsx("h2",{className:"mt-4 mb-2 text-lg font-semibold",children:k.slice(2)},y);if(k.startsWith("- ")||k.startsWith("* "))return e.jsx("li",{className:"ml-4",children:k.slice(2)},y);if(!k.trim())return e.jsx("br",{},y);const v=C=>{const M=[];let b=C,P=0;for(;b.length>0;){const u=b.match(/^`([^`]+)`/);if(u){M.push(e.jsx("code",{className:"rounded bg-muted px-1 text-sm",children:u[1]},P++)),b=b.slice(u[0].length);continue}const w=b.match(/^\*\*([^*]+)\*\*/);if(w){M.push(e.jsx("strong",{children:w[1]},P++)),b=b.slice(w[0].length);continue}const S=b.match(/^\*([^*]+)\*/);if(S){M.push(e.jsx("em",{children:S[1]},P++)),b=b.slice(S[0].length);continue}const E=b.search(/[`*]/);if(E===-1){M.push(b);break}else E===0?(M.push(b[0]),b=b.slice(1)):(M.push(b.slice(0,E)),b=b.slice(E))}return M};return e.jsx("p",{className:"my-1",children:v(k)},y)}):null;return e.jsxs("div",{className:_("space-y-3",a),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Description"}),!r&&t&&e.jsxs(m,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:f,children:[e.jsx(ne,{className:"size-3"}),"Edit"]}),r&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(m,{variant:"ghost",size:"sm",className:_("h-7 gap-1",!l&&"bg-muted"),onClick:()=>j(!1),children:[e.jsx(Ct,{className:"size-3"}),"Edit"]}),e.jsxs(m,{variant:"ghost",size:"sm",className:_("h-7 gap-1",l&&"bg-muted"),onClick:()=>j(!0),children:[e.jsx(Ae,{className:"size-3"}),"Preview"]})]})]}),r?e.jsxs("div",{className:"space-y-3",children:[l?e.jsx("div",{className:"min-h-32 rounded-md border bg-muted/30 p-3 text-sm",children:i?g(i):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})}):e.jsx(Ue,{value:i,onChange:N=>o(N.target.value),placeholder:"Add a description... (Markdown supported)",className:"min-h-32 font-mono text-sm"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:x,children:[e.jsx(fe,{className:"mr-1 size-3"}),"Cancel"]}),e.jsxs(m,{size:"sm",onClick:d,children:[e.jsx(re,{className:"mr-1 size-3"}),"Save"]})]})]}):s?e.jsx("div",{className:"prose prose-sm max-w-none rounded-md bg-muted/30 p-3",children:g(s)}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No description"})]})}var ce="Checkbox",[At]=Ws(ce),[Kt,ye]=At(ce);function Rt(s){const{__scopeCheckbox:t,checked:a,children:r,defaultChecked:c,disabled:i,form:o,name:l,onCheckedChange:j,required:f,value:d="on",internal_do_not_use_render:x}=s,[g,N]=Bs({prop:a,defaultProp:c??!1,onChange:j,caller:ce}),[z,k]=h.useState(null),[y,v]=h.useState(null),C=h.useRef(!1),M=z?!!o||!!z.closest("form"):!0,b={checked:g,disabled:i,setChecked:N,control:z,setControl:k,name:l,form:o,value:d,hasConsumerStoppedPropagationRef:C,required:f,defaultChecked:O(c)?!1:c,isFormControl:M,bubbleInput:y,setBubbleInput:v};return e.jsx(Kt,{scope:t,...b,children:Ot(x)?x(b):r})}var Ke="CheckboxTrigger",Re=h.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:a,...r},c)=>{const{control:i,value:o,disabled:l,checked:j,required:f,setControl:d,setChecked:x,hasConsumerStoppedPropagationRef:g,isFormControl:N,bubbleInput:z}=ye(Ke,s),k=Le(c,d),y=h.useRef(j);return h.useEffect(()=>{const v=i?.form;if(v){const C=()=>x(y.current);return v.addEventListener("reset",C),()=>v.removeEventListener("reset",C)}},[i,x]),e.jsx(ve.button,{type:"button",role:"checkbox","aria-checked":O(j)?"mixed":j,"aria-required":f,"data-state":Qe(j),"data-disabled":l?"":void 0,disabled:l,value:o,...r,ref:k,onKeyDown:ze(t,v=>{v.key==="Enter"&&v.preventDefault()}),onClick:ze(a,v=>{x(C=>O(C)?!0:!C),z&&N&&(g.current=v.isPropagationStopped(),g.current||v.stopPropagation())})})});Re.displayName=Ke;var Oe=h.forwardRef((s,t)=>{const{__scopeCheckbox:a,name:r,checked:c,defaultChecked:i,required:o,disabled:l,value:j,onCheckedChange:f,form:d,...x}=s;return e.jsx(Rt,{__scopeCheckbox:a,checked:c,defaultChecked:i,disabled:l,required:o,onCheckedChange:f,name:r,form:d,value:j,internal_do_not_use_render:({isFormControl:g})=>e.jsxs(e.Fragment,{children:[e.jsx(Re,{...x,ref:t,__scopeCheckbox:a}),g&&e.jsx(Fe,{__scopeCheckbox:a})]})})});Oe.displayName=ce;var We="CheckboxIndicator",Be=h.forwardRef((s,t)=>{const{__scopeCheckbox:a,forceMount:r,...c}=s,i=ye(We,a);return e.jsx(Ts,{present:r||O(i.checked)||i.checked===!0,children:e.jsx(ve.span,{"data-state":Qe(i.checked),"data-disabled":i.disabled?"":void 0,...c,ref:t,style:{pointerEvents:"none",...s.style}})})});Be.displayName=We;var Ve="CheckboxBubbleInput",Fe=h.forwardRef(({__scopeCheckbox:s,...t},a)=>{const{control:r,hasConsumerStoppedPropagationRef:c,checked:i,defaultChecked:o,required:l,disabled:j,name:f,value:d,form:x,bubbleInput:g,setBubbleInput:N}=ye(Ve,s),z=Le(a,N),k=Rs(i),y=Vs(r);h.useEffect(()=>{const C=g;if(!C)return;const M=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(M,"checked").set,u=!c.current;if(k!==i&&P){const w=new Event("click",{bubbles:u});C.indeterminate=O(i),P.call(C,O(i)?!1:i),C.dispatchEvent(w)}},[g,k,i,c]);const v=h.useRef(O(i)?!1:i);return e.jsx(ve.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??v.current,required:l,disabled:j,name:f,value:d,form:x,...t,tabIndex:-1,ref:z,style:{...t.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Fe.displayName=Ve;function Ot(s){return typeof s=="function"}function O(s){return s==="indeterminate"}function Qe(s){return O(s)?"indeterminate":s?"checked":"unchecked"}function Wt({className:s,...t}){return e.jsx(Oe,{"data-slot":"checkbox",className:_("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Be,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:e.jsx(re,{className:"size-3.5"})})})}function Bt({todos:s,onAdd:t,onToggle:a,onDelete:r,className:c}){const[i,o]=h.useState(""),l=()=>{i.trim()&&t&&(t(i.trim()),o(""))},j=d=>{d.key==="Enter"&&l()},f=s.filter(d=>d.completed).length;return e.jsxs("div",{className:_("space-y-3",c),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Checklist"}),s.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[f,"/",s.length," completed"]})]}),s.length>0&&e.jsx("div",{className:"h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${f/s.length*100}%`}})}),e.jsx("div",{className:"space-y-1",children:s.map(d=>e.jsxs("div",{"data-testid":"todo-item",className:_("group flex items-center gap-2 rounded-md px-2 py-1.5","hover:bg-muted/50"),children:[e.jsx(vs,{className:"size-4 cursor-grab text-muted-foreground opacity-0 group-hover:opacity-100"}),e.jsx(Wt,{checked:d.completed,onCheckedChange:x=>a?.(d.id,x===!0),"aria-label":`Mark "${d.text}" as ${d.completed?"incomplete":"complete"}`}),e.jsx("span",{className:_("flex-1 text-sm",d.completed&&"text-muted-foreground line-through"),children:d.text}),r&&e.jsxs(m,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:()=>r(d.id),children:[e.jsx(ue,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]},d.id))}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"size-4 text-muted-foreground"}),e.jsx(H,{value:i,onChange:d=>o(d.target.value),onKeyDown:j,placeholder:"Add a task...",className:"h-8 flex-1"}),e.jsx(m,{variant:"ghost",size:"sm",onClick:l,disabled:!i.trim(),children:"Add"})]}),s.length===0&&!t&&e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No tasks yet"})]})}function Vt(s){switch(s){case"project":return e.jsx(ge,{className:"size-4"});case"initiative":return e.jsx(xe,{className:"size-4"});case"epic":return e.jsx(he,{className:"size-4"});case"issue":return e.jsx(ee,{className:"size-4"})}}function Ft(s){switch(s){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function Qt(s){return s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}function Ht({dependencies:s,onDependencyClick:t,onAddDependency:a,className:r}){const c=s.filter(l=>l.direction==="blocked_by"),i=s.filter(l=>l.direction==="blocks"),o=l=>e.jsxs("button",{"data-testid":"dependency-item",className:_("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",t&&"cursor-pointer"),onClick:()=>t?.(l),children:[e.jsx("span",{className:"text-muted-foreground",children:Vt(l.kind)}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm",children:l.title}),e.jsx(D,{variant:Ft(l.status),className:"shrink-0 text-xs",children:Qt(l.status)})]},l.id);return e.jsxs("div",{className:_("space-y-4",r),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(rt,{className:"size-4"}),"Blocked by (",c.length,")"]}),a&&e.jsxs(m,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocked_by"),children:[e.jsx(J,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add blocker"})]})]}),c.length>0?e.jsx("div",{className:"space-y-1",children:c.map(o)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No blockers"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(lt,{className:"size-4"}),"Blocks (",i.length,")"]}),a&&e.jsxs(m,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocks"),children:[e.jsx(J,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add dependent"})]})]}),i.length>0?e.jsx("div",{className:"space-y-1",children:i.map(o)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No dependents"})]})]})}function Gt(s){switch(s){case"project":return e.jsx(ge,{className:"size-3"});case"initiative":return e.jsx(xe,{className:"size-3"});case"epic":return e.jsx(he,{className:"size-3"});case"issue":return e.jsx(ee,{className:"size-3"});default:return null}}function Xt({memory:s,onClick:t,onEdit:a,onDelete:r,className:c}){const i=s.content.slice(0,150)+(s.content.length>150?"...":"");return e.jsxs("div",{"data-testid":"memory-card",className:_("group relative rounded-lg border bg-card p-4 transition-colors hover:bg-accent/50",t&&"cursor-pointer",c),onClick:()=>t?.(s),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-medium leading-tight",children:s.title}),(a||r)&&e.jsxs(Fs,{children:[e.jsx(Qs,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:o=>o.stopPropagation(),children:e.jsx(_s,{className:"size-4"})})}),e.jsxs(Hs,{align:"end",children:[a&&e.jsxs(Se,{onClick:o=>{o.stopPropagation(),a(s)},children:[e.jsx(ne,{className:"mr-2 size-4"}),"Edit"]}),r&&e.jsxs(Se,{className:"text-destructive focus:text-destructive",onClick:o=>{o.stopPropagation(),r(s)},children:[e.jsx(ue,{className:"mr-2 size-4"}),"Delete"]})]})]})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground line-clamp-2",children:i}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:s.linkedItemKind&&s.linkedItemTitle&&e.jsxs("span",{className:"flex items-center gap-1",children:[Gt(s.linkedItemKind),e.jsx("span",{className:"truncate max-w-[120px]",children:s.linkedItemTitle})]})}),e.jsx("span",{children:s.updatedAt.toLocaleDateString()})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.tags.map(o=>e.jsx(D,{variant:"secondary",className:"text-xs",children:o},o))})]})}function Yt({memories:s,onMemoryClick:t,onAddMemory:a,onLinkMemory:r,onEditMemory:c,onDeleteMemory:i,className:o}){return e.jsxs("div",{className:_("space-y-4",o),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Memories"}),e.jsx(D,{variant:"secondary",className:"text-xs",children:s.length})]}),e.jsxs("div",{className:"flex gap-1",children:[r&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link"]}),a&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:a,children:[e.jsx(J,{className:"mr-1 size-3"}),"Add"]})]})]}),s.length>0?e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:s.map(l=>e.jsx(Xt,{memory:l,onClick:t,onEdit:c,onDelete:i},l.id))}):e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx(ee,{className:"mx-auto size-8 text-muted-foreground/50"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"No memories attached"}),(a||r)&&e.jsxs("div",{className:"mt-3 flex justify-center gap-2",children:[a&&e.jsxs(m,{variant:"outline",size:"sm",onClick:a,children:[e.jsx(J,{className:"mr-1 size-3"}),"Create new"]}),r&&e.jsxs(m,{variant:"outline",size:"sm",onClick:r,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link existing"]})]})]})]})}function Jt({memory:s,open:t,onOpenChange:a,onSubmit:r,className:c}){const[i,o]=h.useState(s?.title??""),[l,j]=h.useState(s?.content??""),[f,d]=h.useState(""),[x,g]=h.useState(s?.tags??[]),[N,z]=h.useState("edit"),k=h.useRef(null),y=h.useCallback((u,w="")=>{const S=k.current;if(!S)return;const E=S.selectionStart,se=S.selectionEnd,p=l.slice(E,se),G=l.slice(0,E)+u+(p||"text")+w+l.slice(se);j(G),setTimeout(()=>{S.focus();const F=E+u.length,X=F+(p||"text").length;S.setSelectionRange(F,X)},0)},[l]),v=()=>{const u=f.trim();u&&!x.includes(u)&&(g([...x,u]),d(""))},C=u=>{g(x.filter(w=>w!==u))},M=u=>{u.preventDefault(),r({title:i.trim(),content:l.trim(),tags:x.length>0?x:void 0})},b=i.trim()&&l.trim(),P=u=>u.split(`
`).map((w,S)=>w.startsWith("### ")?e.jsx("h3",{className:"text-lg font-semibold mt-4 mb-2",children:w.slice(4)},S):w.startsWith("## ")?e.jsx("h2",{className:"text-xl font-semibold mt-4 mb-2",children:w.slice(3)},S):w.startsWith("# ")?e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",children:w.slice(2)},S):w.startsWith("- ")||w.startsWith("* ")?e.jsx("li",{className:"ml-4",children:w.slice(2)},S):/^\d+\. /.test(w)?e.jsx("li",{className:"ml-4 list-decimal",children:w.replace(/^\d+\. /,"")},S):w.trim()?e.jsx("p",{className:"my-1",children:w},S):e.jsx("br",{},S));return e.jsx(Gs,{open:t,onOpenChange:a,children:e.jsxs(Xs,{className:_("sm:max-w-2xl",c),children:[e.jsxs(Ys,{children:[e.jsx(Js,{children:s?"Edit Memory":"Create Memory"}),e.jsx(Zs,{className:"sr-only",children:s?"Edit memory details":"Create a new memory entry"})]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"memory-title",className:"text-sm font-medium",children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(H,{id:"memory-title",value:i,onChange:u=>o(u.target.value),placeholder:"Memory title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-medium",children:["Content ",e.jsx("span",{className:"text-destructive",children:"*"})]})}),e.jsxs(pe,{value:N,onValueChange:u=>z(u),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("**","**"),title:"Bold",children:e.jsx(dt,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("*","*"),title:"Italic",children:e.jsx(gt,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("- "),title:"Bullet list",children:e.jsx(st,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("1. "),title:"Numbered list",children:e.jsx(Nt,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("[","](url)"),title:"Link",children:e.jsx(V,{className:"size-4"})}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>y("`","`"),title:"Code",children:e.jsx(xt,{className:"size-4"})})]}),e.jsxs(je,{children:[e.jsxs(A,{value:"edit",className:"gap-1",children:[e.jsx(bt,{className:"size-3"}),"Edit"]}),e.jsxs(A,{value:"preview",className:"gap-1",children:[e.jsx(Ae,{className:"size-3"}),"Preview"]})]})]}),e.jsx(K,{value:"edit",className:"mt-2",children:e.jsx(Ue,{ref:k,value:l,onChange:u=>j(u.target.value),placeholder:"Write your memory content here... (Markdown supported)",className:"min-h-[200px] font-mono text-sm",required:!0})}),e.jsx(K,{value:"preview",className:"mt-2",children:e.jsx("div",{className:"min-h-[200px] rounded-md border bg-muted/30 p-4 text-sm",children:l?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:P(l)}):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"memory-tags",className:"text-sm font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{id:"memory-tags",value:f,onChange:u=>d(u.target.value),placeholder:"Add a tag",onKeyDown:u=>{u.key==="Enter"&&(u.preventDefault(),v())}}),e.jsx(m,{type:"button",variant:"outline",onClick:v,children:"Add"})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:x.map(u=>e.jsxs(D,{variant:"secondary",className:"cursor-pointer",onClick:()=>C(u),children:[u," Ã—"]},u))})]}),e.jsxs(et,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:!b,children:s?"Save Changes":"Create Memory"})]})]})]})})}function Zt({emails:s,calendarEvents:t,onEmailClick:a,onEventClick:r,onUnlinkEmail:c,onUnlinkEvent:i,onLinkEmail:o,onLinkEvent:l,className:j}){const[f,d]=h.useState("emails"),x=s.length+t.length;return e.jsxs("div",{className:_("space-y-4",j),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Communications"}),e.jsx(D,{variant:"secondary",className:"text-xs",children:x})]})}),e.jsxs(pe,{value:f,onValueChange:g=>d(g),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(je,{children:[e.jsxs(A,{value:"emails",className:"gap-1",children:[e.jsx(me,{className:"size-3"}),"Emails",s.length>0&&e.jsx(D,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:s.length})]}),e.jsxs(A,{value:"calendar",className:"gap-1",children:[e.jsx(Y,{className:"size-3"}),"Calendar",t.length>0&&e.jsx(D,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:t.length})]})]}),f==="emails"&&o&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:o,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link Email"]}),f==="calendar"&&l&&e.jsxs(m,{variant:"ghost",size:"sm",onClick:l,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link Event"]})]}),e.jsx(K,{value:"emails",className:"mt-4",children:s.length>0?e.jsx("div",{className:"space-y-2",children:s.map(g=>e.jsx(Es,{email:g,onClick:a,onUnlink:c},g.id))}):e.jsx(Te,{icon:e.jsx(me,{className:"size-8"}),message:"No linked emails",action:o&&e.jsxs(m,{variant:"outline",size:"sm",onClick:o,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link an email"]})})}),e.jsx(K,{value:"calendar",className:"mt-4",children:t.length>0?e.jsx("div",{className:"space-y-2",children:t.map(g=>e.jsx(Is,{event:g,onClick:r,onUnlink:i},g.id))}):e.jsx(Te,{icon:e.jsx(Y,{className:"size-8"}),message:"No linked calendar events",action:l&&e.jsxs(m,{variant:"outline",size:"sm",onClick:l,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link an event"]})})})]})]})}function Te({icon:s,message:t,action:a}){return e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx("div",{className:"mx-auto text-muted-foreground/50",children:s}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t}),a&&e.jsx("div",{className:"mt-3",children:a})]})}function de(s){const a=new Date().getTime()-s.getTime(),r=Math.floor(a/6e4),c=Math.floor(r/60),i=Math.floor(c/24);return r<1?"just now":r<60?`${r}m ago`:c<24?`${c}h ago`:i<7?`${i}d ago`:s.toLocaleDateString(void 0,{month:"short",day:"numeric"})}function Ea(){const{id:s}=gs(),t=s??"",a=Z(),c=zs()?.participants??[],{data:i,isLoading:o,error:l}=Ns(t),{data:j,isLoading:f}=St(t),{data:d,isLoading:x}=Mt(t),{data:g,isLoading:N}=ws(50),z=Dt(),k=_t(),y=Et(),[v,C]=h.useState(!1),[M,b]=h.useState(null),[P,u]=h.useState(!1),{deleteItem:w,isDeleting:S,undoState:E,dismissUndo:se}=ys({onDeleted:()=>{window.location.href="/app/work-items"}}),p=i?(()=>{const n=[];return i.dependencies?.blocks&&n.push(...i.dependencies.blocks.map(I=>({id:I.id,title:I.title,kind:"issue",status:"not_started",direction:"blocks"}))),i.dependencies?.blocked_by&&n.push(...i.dependencies.blocked_by.map(I=>({id:I.id,title:I.title,kind:"issue",status:"not_started",direction:"blocked_by"}))),{id:i.id,title:i.title,kind:i.kind||"issue",status:i.status||"not_started",priority:Ss(i.priority),description:i.description||void 0,parentId:i.parent_id||void 0,parentTitle:i.parent?.title,estimateMinutes:i.estimate_minutes||void 0,actualMinutes:i.actual_minutes||void 0,dueDate:i.not_after?new Date(i.not_after):void 0,startDate:i.not_before?new Date(i.not_before):void 0,createdAt:new Date(i.created_at),updatedAt:new Date(i.updated_at),todos:[],attachments:[],dependencies:n}})():null,G=(j?.memories??[]).map(n=>({id:n.id,title:n.title,content:n.content,linkedItemId:t,linkedItemTitle:p?.title||void 0,linkedItemKind:p?.kind||"issue",createdAt:new Date(n.created_at),updatedAt:new Date(n.updated_at)})),F=(d?.emails??[]).map(n=>({id:n.id,subject:"Email",from:{name:"Unknown",email:""},to:[],date:n.received_at?new Date(n.received_at):new Date,snippet:n.body?.substring(0,100)||"",body:n.body||void 0})),X=(d?.calendar_events??[]).map(n=>({id:n.id,title:"Calendar Event",startTime:n.received_at?new Date(n.received_at):new Date,endTime:n.received_at?new Date(n.received_at):new Date,attendees:[]})),be=(g?.items??[]).filter(n=>n.work_item_id===t),L=h.useCallback(n=>{z.mutate({id:t,body:n})},[t,z]),He=n=>L({title:n}),Ge=n=>L({description:n}),Xe=n=>L({status:n}),Ye=n=>L({priority:Ms(n)}),Je=n=>L({notAfter:n||null}),Ze=n=>L({notBefore:n||null}),es=n=>{const I=parseInt(n,10);L({estimateMinutes:isNaN(I)?null:I})},ss=n=>{const I=parseInt(n,10);L({actualMinutes:isNaN(I)?null:I})},ts=()=>{p?.parentId&&(window.location.href=`/app/work-items/${p.parentId}`)},as=n=>{window.location.href=`/app/work-items/${n.id}`},is=()=>{b(null),C(!0)},ns=n=>{b(n),C(!0)},rs=n=>{k.mutate({workItemId:t,body:{title:n.title,content:n.content,type:"note"}},{onSuccess:()=>C(!1)})},cs=n=>{M&&y.mutate({id:M.id,body:{title:n.title,content:n.content},workItemId:t},{onSuccess:()=>{C(!1),b(null)}})},ls=async n=>{if(confirm(`Delete memory "${n.title}"?`))try{await R.delete(`/api/memories/${n.id}`),a.invalidateQueries({queryKey:$.forWorkItem(t)})}catch{}},os=async n=>{if(confirm("Unlink this email from the work item?"))try{await R.delete(`/api/work-items/${t}/communications/${n.id}`),a.invalidateQueries({queryKey:ie.forWorkItem(t)})}catch{}},ds=async n=>{if(confirm("Unlink this event from the work item?"))try{await R.delete(`/api/work-items/${t}/communications/${n.id}`),a.invalidateQueries({queryKey:ie.forWorkItem(t)})}catch{}},ms=()=>u(!0),us=async()=>{p&&(await w({id:p.id,title:p.title}),u(!1))};return o?e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center gap-4",children:[e.jsx(Q,{width:80,height:32}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{width:100,height:32}),e.jsx(Q,{width:120,height:32})]})]}),e.jsx("div",{className:"flex-1 p-6",children:e.jsxs("div",{className:"mx-auto max-w-5xl space-y-6",children:[e.jsx(we,{}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(we,{})}),e.jsx("div",{children:e.jsx(Q,{width:"100%",height:200})})]})]})})]}):l||!p?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(Cs,{title:"Work Item Not Found",message:l instanceof Error?l.message:"The requested work item could not be loaded.",action:e.jsx(m,{variant:"outline",asChild:!0,children:e.jsx(te,{to:"/work-items",children:"Back to Work Items"})})})}):e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border bg-background flex items-center gap-4 shrink-0",children:[e.jsx(m,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(te,{to:"/work-items",children:[e.jsx(qe,{className:"mr-1 size-4 rotate-180"}),"Back"]})}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(m,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(te,{to:`/work-items/${t}/timeline`,children:[e.jsx(Y,{className:"mr-2 size-4"}),"Timeline"]})}),e.jsx(m,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(te,{to:`/work-items/${t}/graph`,children:[e.jsx(tt,{className:"mr-2 size-4"}),"Dependencies"]})})]})]}),e.jsx(Ps,{className:"flex-1",children:e.jsxs("div",{className:"mx-auto max-w-5xl p-6 space-y-6",children:[e.jsx(Lt,{title:p.title,kind:p.kind,status:p.status,parentTitle:p.parentTitle,onTitleChange:He,onParentClick:ts,onDelete:ms}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"size-3"}),"Created ",de(p.createdAt)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"size-3"}),"Updated ",de(p.updatedAt)]}),z.isPending&&e.jsx(D,{variant:"outline",className:"text-xs animate-pulse",children:"Saving..."})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(q,{children:e.jsx(U,{className:"pt-4",children:e.jsx(qt,{status:p.status,priority:p.priority,assignee:p.assignee,dueDate:p.dueDate,startDate:p.startDate,estimateMinutes:p.estimateMinutes,actualMinutes:p.actualMinutes,onStatusChange:Xe,onPriorityChange:Ye,onDueDateChange:Je,onStartDateChange:Ze,onEstimateChange:es,onActualChange:ss})})}),e.jsxs(pe,{defaultValue:"description",children:[e.jsxs(je,{variant:"line",className:"w-full justify-start",children:[e.jsxs(A,{value:"description",className:"gap-1.5",children:[e.jsx(ee,{className:"size-3.5"}),"Description"]}),e.jsxs(A,{value:"checklist",className:"gap-1.5",children:[e.jsx(zt,{className:"size-3.5"}),"Checklist",p.todos.length>0&&e.jsx(D,{variant:"secondary",className:"ml-1 text-xs px-1.5 py-0",children:p.todos.length})]}),e.jsxs(A,{value:"dependencies",className:"gap-1.5",children:[e.jsx(jt,{className:"size-3.5"}),"Dependencies",p.dependencies.length>0&&e.jsx(D,{variant:"secondary",className:"ml-1 text-xs px-1.5 py-0",children:p.dependencies.length})]}),e.jsxs(A,{value:"activity",className:"gap-1.5",children:[e.jsx(Me,{className:"size-3.5"}),"Activity"]})]}),e.jsx(K,{value:"description","data-testid":"tab-content-description",children:e.jsx(q,{children:e.jsx(U,{className:"pt-4",children:e.jsx(Ut,{description:p.description,onDescriptionChange:Ge})})})}),e.jsx(K,{value:"checklist","data-testid":"tab-content-checklist",children:e.jsx(q,{children:e.jsx(U,{className:"pt-4",children:e.jsx(Bt,{todos:p.todos})})})}),e.jsx(K,{value:"dependencies","data-testid":"tab-content-dependencies",children:e.jsx(q,{children:e.jsx(U,{className:"pt-4",children:e.jsx(Ht,{dependencies:p.dependencies,onDependencyClick:as})})})}),e.jsx(K,{value:"activity","data-testid":"tab-content-activity",children:e.jsx(q,{children:e.jsx(U,{className:"pt-4",children:N?e.jsx(Ds,{count:3,variant:"row"}):be.length===0?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(Me,{className:"size-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No activity recorded yet"})]}):e.jsx("div",{className:"space-y-3",children:be.map(n=>e.jsxs("div",{className:"flex items-start gap-3 py-2 border-b border-border last:border-0",children:[e.jsx("div",{className:`size-7 rounded-full flex items-center justify-center shrink-0 ${n.actor_email?.includes("agent")?"bg-violet-500/10 text-violet-500 dark:bg-violet-500/20":"bg-primary/10 text-primary dark:bg-primary/20"}`,children:e.jsx("span",{className:"text-xs font-medium",children:(n.actor_email??"S").charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-foreground",children:n.actor_email||"System"})," ",e.jsx("span",{className:"text-muted-foreground",children:n.description})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:de(new Date(n.created_at))})]})]},n.id))})})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(q,{children:[e.jsx(le,{className:"pb-3",children:e.jsxs(oe,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ut,{className:"size-4 text-muted-foreground"}),"Memories",G.length>0&&e.jsx(D,{variant:"secondary",className:"text-xs px-1.5 py-0",children:G.length})]})}),e.jsx(U,{children:f?e.jsx(Q,{width:"100%",height:80}):e.jsx(Yt,{memories:G,onAddMemory:is,onEditMemory:ns,onDeleteMemory:ls})})]}),e.jsxs(q,{children:[e.jsx(le,{className:"pb-3",children:e.jsxs(oe,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(me,{className:"size-4 text-muted-foreground"}),"Communications",F.length+X.length>0&&e.jsx(D,{variant:"secondary",className:"text-xs px-1.5 py-0",children:F.length+X.length})]})}),e.jsx(U,{children:x?e.jsx(Q,{width:"100%",height:80}):e.jsx(Zt,{emails:F,calendarEvents:X,onUnlinkEmail:os,onUnlinkEvent:ds})})]}),e.jsxs(q,{children:[e.jsx(le,{className:"pb-3",children:e.jsxs(oe,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx($s,{className:"size-4 text-muted-foreground"}),"Participants"]})}),e.jsx(U,{children:c.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"No participants assigned"}):e.jsx("ul",{className:"space-y-2",children:c.map((n,I)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-7 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:(n.participant??"U")[0].toUpperCase()})}),e.jsx("span",{className:"text-sm",children:n.participant??"Unknown"}),n.role&&e.jsx(D,{variant:"outline",className:"text-xs",children:n.role})]},I))})})]})]})]})]})}),e.jsx(Jt,{memory:M||void 0,open:v,onOpenChange:C,onSubmit:M?cs:rs}),e.jsx(bs,{open:P,onOpenChange:u,item:p?{id:p.id,title:p.title,kind:p.kind,childCount:0}:void 0,onConfirm:us,isDeleting:S}),E&&e.jsx(ks,{visible:!!E,itemTitle:E.itemTitle,onUndo:E.onUndo,onDismiss:se})]})}export{Ea as WorkItemDetailPage};
//# sourceMappingURL=WorkItemDetailPage-BHiNCmzK.js.map
