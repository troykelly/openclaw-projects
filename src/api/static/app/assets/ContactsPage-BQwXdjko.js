import{j as e,r as n,a as te,R as B}from"./index-Dmu1Cmf3.js";import{a as D}from"./api-client-CDvRtWmo.js";import{g as E}from"./work-item-utils-RZsWa1qH.js";import{S as _,a as se,C as F,b as M}from"./card-BWtpZjNX.js";import{E as ae}from"./error-state-CCoNnbdR.js";import{E as ne}from"./empty-state-Cr_6DAnC.js";import{c as P,a as b,B as m}from"./button-B4tyHn7n.js";import{I as H}from"./input-D2fjPNS6.js";import{B as S}from"./badge-BFA1Pi_I.js";import{S as $}from"./scroll-area-C0mBrwpt.js";import{S as q}from"./separator-C6hHh4bC.js";import{R as ie,C as le,g as re,X as oe,T as ce,f as de,P as me,O as xe,D as ue,a as he,b as pe,c as fe,d as je,e as ge}from"./dialog-DPKlQCu7.js";import{T as Ne}from"./textarea-Brqak-GW.js";import{S as ve,a as ye,b as be,c as Ce,d as T}from"./select-q5_DDhZm.js";import{u as we,P as A}from"./use-contacts-BKJTet7w.js";import{S as Se}from"./search-CGjsCXTe.js";import{L as ke}from"./list-CIS01osM.js";import{M as L}from"./mail-Bh_6JRWm.js";import{L as ze}from"./link-2-D5cDWkwv.js";import"./bell-DMA7QWwP.js";import"./users-DVF8IM-O.js";import"./index-DT505RDd.js";import"./index-CicDskkn.js";import"./index-BdQq_4o_.js";import"./index-BdkY-9YW.js";import"./index-BfbTaDZO.js";const De=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],Ee=P("arrow-up-down",De);const _e=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Fe=P("grid-3x3",_e);const Me=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],Te=P("user-plus",Me);function Ae({...s}){return e.jsx(ie,{"data-slot":"sheet",...s})}function Le({...s}){return e.jsx(me,{"data-slot":"sheet-portal",...s})}function Pe({className:s,...i}){return e.jsx(xe,{"data-slot":"sheet-overlay",className:b("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...i})}function Oe({className:s,children:i,side:a="right",showCloseButton:r=!0,...o}){return e.jsxs(Le,{children:[e.jsx(Pe,{}),e.jsxs(le,{"data-slot":"sheet-content",className:b("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",a==="right"&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",a==="left"&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",a==="top"&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",a==="bottom"&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",s),...o,children:[i,r&&e.jsxs(re,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[e.jsx(oe,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Ve({className:s,...i}){return e.jsx("div",{"data-slot":"sheet-header",className:b("flex flex-col gap-1.5 p-4",s),...i})}function Re({className:s,...i}){return e.jsx(ce,{"data-slot":"sheet-title",className:b("text-foreground font-semibold",s),...i})}function Ie({className:s,...i}){return e.jsx(de,{"data-slot":"sheet-description",className:b("text-muted-foreground text-sm",s),...i})}function h(s,i){return s.endpoints.find(r=>r.type===i)?.value??null}function Ue(s,i){const a=[...s];switch(i){case"name":return a.sort((r,o)=>r.display_name.localeCompare(o.display_name));case"recent":return a.sort((r,o)=>new Date(o.created_at).getTime()-new Date(r.created_at).getTime());case"endpoints":return a.sort((r,o)=>o.endpoints.length-r.endpoints.length);default:return a}}function pt(){const[s,i]=n.useState(""),[a,r]=n.useState(""),[o,p]=n.useState("name"),[u,f]=n.useState("grid"),[l,j]=n.useState(null),[k,d]=n.useState(!1),[G,g]=n.useState(!1),[N,v]=n.useState(null),[J,C]=n.useState(!1),O=te();B.useEffect(()=>{const t=setTimeout(()=>{r(s)},300);return()=>clearTimeout(t)},[s]);const{data:w,isLoading:X,isError:K,error:V,refetch:x}=we(a||void 0),z=n.useMemo(()=>w?.contacts?Ue(w.contacts,o):[],[w?.contacts,o]),R=n.useCallback(t=>{j(t),d(!0)},[]),Q=n.useCallback(t=>{O(`/people/${t.id}`)},[O]),W=n.useCallback(async t=>{C(!0);try{await D.post("/api/contacts",t),g(!1),v(null),x()}catch(c){console.error("Failed to create contact:",c)}finally{C(!1)}},[x]),Y=n.useCallback(async t=>{if(N){C(!0);try{await D.patch(`/api/contacts/${N.id}`,t),g(!1),v(null),d(!1),j(null),x()}catch(c){console.error("Failed to update contact:",c)}finally{C(!1)}}},[N,x]),Z=n.useCallback(async t=>{try{await D.delete(`/api/contacts/${t.id}`),d(!1),j(null),x()}catch(c){console.error("Failed to delete contact:",c)}},[x]),ee=n.useCallback(t=>{v(t),d(!1),g(!0)},[]),I=n.useCallback(()=>{v(null),g(!0)},[]);if(X)return e.jsxs("div",{"data-testid":"page-contacts",className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(_,{width:200,height:32}),e.jsx(_,{width:120,height:36})]}),e.jsx(_,{width:"100%",height:40,className:"mb-4"}),e.jsx(se,{count:6,variant:"card"})]});if(K)return e.jsx("div",{"data-testid":"page-contacts",className:"p-6",children:e.jsx(ae,{type:"generic",title:"Failed to load contacts",description:V instanceof Error?V.message:"Unknown error",onRetry:()=>x()})});const U=w?.total??0;return e.jsxs("div",{"data-testid":"page-contacts",className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"People"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[U," contact",U!==1?"s":""]})]}),e.jsxs(m,{onClick:I,"data-testid":"add-contact-button",children:[e.jsx(Te,{className:"mr-2 size-4"}),"Add Contact"]})]}),e.jsxs("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(H,{type:"text",placeholder:"Search contacts...",value:s,onChange:t=>i(t.target.value),className:"pl-9","data-testid":"contact-search-input"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ve,{value:o,onValueChange:t=>p(t),children:[e.jsxs(ye,{className:"w-[150px]","data-testid":"sort-select",children:[e.jsx(Ee,{className:"mr-2 size-4"}),e.jsx(be,{placeholder:"Sort by"})]}),e.jsxs(Ce,{children:[e.jsx(T,{value:"name",children:"Name"}),e.jsx(T,{value:"recent",children:"Most Recent"}),e.jsx(T,{value:"endpoints",children:"Endpoints"})]})]}),e.jsxs("div",{className:"flex rounded-md border",children:[e.jsx(m,{variant:u==="grid"?"default":"ghost",size:"icon",className:"rounded-r-none size-9",onClick:()=>f("grid"),title:"Grid view","data-testid":"view-grid",children:e.jsx(Fe,{className:"size-4"})}),e.jsx(m,{variant:u==="list"?"default":"ghost",size:"icon",className:"rounded-l-none size-9",onClick:()=>f("list"),title:"List view","data-testid":"view-list",children:e.jsx(ke,{className:"size-4"})})]})]})]}),z.length===0?e.jsx(F,{children:e.jsx(M,{className:"p-8",children:e.jsx(ne,{variant:"contacts",title:s?"No contacts found":"No contacts yet",description:s?"Try a different search term.":"Add your first contact to get started.",onAction:s?void 0:I,actionLabel:"Add Contact"})})}):e.jsx($,{className:"flex-1",children:u==="grid"?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3","data-testid":"contacts-grid",children:z.map(t=>{const c=h(t,"email"),y=h(t,"phone");return e.jsx(F,{"data-testid":"contact-card",className:"cursor-pointer transition-colors hover:bg-muted/50",onClick:()=>R(t),children:e.jsxs(M,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex size-12 shrink-0 items-center justify-center rounded-full bg-primary/10 text-sm font-medium text-primary",children:E(t.display_name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-medium text-foreground truncate",children:t.display_name}),c&&e.jsxs("p",{className:"flex items-center gap-1 text-sm text-muted-foreground truncate mt-0.5",children:[e.jsx(L,{className:"size-3 shrink-0"}),c]}),y&&e.jsxs("p",{className:"flex items-center gap-1 text-sm text-muted-foreground truncate mt-0.5",children:[e.jsx(A,{className:"size-3 shrink-0"}),y]})]})]}),t.endpoints.length>0&&e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsxs(S,{variant:"secondary",className:"text-xs gap-1",children:[e.jsx(ze,{className:"size-3"}),t.endpoints.length," endpoint",t.endpoints.length!==1?"s":""]})})]})},t.id)})}):e.jsx(F,{"data-testid":"contacts-list",children:e.jsx(M,{className:"p-0",children:e.jsx("div",{className:"divide-y",children:z.map(t=>{const c=h(t,"email"),y=h(t,"phone");return e.jsxs("button",{"data-testid":"contact-row",onClick:()=>R(t),className:"w-full p-4 text-left hover:bg-muted/50 transition-colors flex items-center gap-3",children:[e.jsx("div",{className:"flex size-10 shrink-0 items-center justify-center rounded-full bg-primary/10 text-sm font-medium text-primary",children:E(t.display_name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground mt-0.5",children:[c&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(L,{className:"size-3 shrink-0"}),c]}),y&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(A,{className:"size-3 shrink-0"}),y]})]})]}),e.jsxs(S,{variant:"secondary",className:"shrink-0",children:[t.endpoints.length," endpoint",t.endpoints.length!==1?"s":""]})]},t.id)})})})})}),e.jsx(Ae,{open:k,onOpenChange:d,children:e.jsxs(Oe,{className:"w-96 sm:max-w-md","data-testid":"contact-detail-sheet",children:[e.jsxs(Ve,{children:[e.jsx(Re,{className:"sr-only",children:"Contact Details"}),e.jsx(Ie,{className:"sr-only",children:"View contact information and endpoints"})]}),l&&e.jsx($,{className:"h-full",children:e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex size-16 items-center justify-center rounded-full bg-primary/10 text-xl font-medium text-primary",children:E(l.display_name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold",children:l.display_name}),h(l,"email")&&e.jsx("p",{className:"text-sm text-muted-foreground",children:h(l,"email")})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>Q(l),"data-testid":"view-full-detail",children:"View Full Profile"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>ee(l),children:"Edit"}),e.jsx(m,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>Z(l),children:"Delete"})]}),e.jsx(q,{}),l.notes&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-md",children:l.notes})]}),e.jsx(q,{})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Endpoints"}),e.jsx(S,{variant:"secondary",className:"text-xs",children:l.endpoints.length})]}),l.endpoints.length>0?e.jsx("div",{className:"space-y-2",children:l.endpoints.map((t,c)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 rounded-md bg-muted/30",children:[t.type==="email"&&e.jsx(L,{className:"size-4 text-muted-foreground"}),t.type==="phone"&&e.jsx(A,{className:"size-4 text-muted-foreground"}),t.type!=="email"&&t.type!=="phone"&&e.jsx(S,{variant:"outline",className:"text-xs",children:t.type}),e.jsx("span",{className:"text-foreground",children:t.value})]},c))}):e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No endpoints"})]})]})})]})}),e.jsx($e,{open:G,onOpenChange:t=>{g(t),t||v(null)},contact:N,isSubmitting:J,onSubmit:t=>{N?Y(t):W(t)}})]})}function $e({open:s,onOpenChange:i,contact:a,isSubmitting:r,onSubmit:o}){const[p,u]=n.useState(""),[f,l]=n.useState("");B.useEffect(()=>{s&&(u(a?.display_name??""),l(a?.notes??""))},[s,a]);const j=d=>{d.preventDefault(),o({displayName:p.trim(),notes:f.trim()||void 0})},k=p.trim().length>0;return e.jsx(ue,{open:s,onOpenChange:i,children:e.jsxs(he,{className:"sm:max-w-md","data-testid":"contact-form-dialog",children:[e.jsxs(pe,{children:[e.jsx(fe,{children:a?"Edit Contact":"Add Contact"}),e.jsx(je,{children:a?"Update the contact details below.":"Fill in the details to add a new contact."})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"contact-name",className:"text-sm font-medium",children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(H,{id:"contact-name",value:p,onChange:d=>u(d.target.value),placeholder:"John Doe",required:!0,"data-testid":"contact-name-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"contact-notes",className:"text-sm font-medium",children:"Notes"}),e.jsx(Ne,{id:"contact-notes",value:f,onChange:d=>l(d.target.value),placeholder:"Additional notes about this contact...",rows:3,"data-testid":"contact-notes-input"})]}),e.jsxs(ge,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:!k||r,"data-testid":"contact-form-submit",children:a?"Save Changes":"Add Contact"})]})]})]})})}export{pt as ContactsPage};
//# sourceMappingURL=ContactsPage-BQwXdjko.js.map
