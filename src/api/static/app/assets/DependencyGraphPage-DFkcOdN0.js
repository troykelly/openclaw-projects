import{c as H,r as p,j as s,L as X,R as F}from"./index-BTKavlMF.js";import{u as U}from"./useQuery-CvMXqy2m.js";import{a as q}from"./api-client-CDvRtWmo.js";import{k as K}from"./work-item-utils-RZsWa1qH.js";import{S as _,C as T,d as A,e as O,b as Q}from"./card-B-p_muP1.js";import{E as J}from"./error-state-B03uaCNt.js";import{B as g}from"./button-4HlqvOJz.js";import{B as V}from"./badge-DQI7MJbM.js";import{C as z}from"./chevron-right-Lgun2PAU.js";import{N as ee}from"./network-D1xpcevb.js";const D={all:["dependency-graph"],item:n=>[...D.all,n]};function se(n){return U({queryKey:D.item(n),queryFn:({signal:f})=>q.get(`/api/work-items/${n}/dependency-graph`,{signal:f}),enabled:!!n})}function xe(){const{id:n}=H(),f=n??"",{data:j,isLoading:$,error:y,refetch:L}=se(f),[l,m]=p.useState(1),[x,k]=p.useState({x:0,y:0}),[S,w]=p.useState(!1),[b,P]=p.useState({x:0,y:0}),B=e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1;m(a=>Math.max(.2,Math.min(3,a*t)))},W=e=>{w(!0),P({x:e.clientX-x.x,y:e.clientY-x.y})},E=e=>{S&&k({x:e.clientX-b.x,y:e.clientY-b.y})},M=()=>{w(!1)};if($)return s.jsxs("div",{"data-testid":"page-dependency-graph",className:"p-6",children:[s.jsx(_,{width:200,height:24,className:"mb-4"}),s.jsx(_,{width:"100%",height:500})]});if(y)return s.jsx("div",{"data-testid":"page-dependency-graph",className:"p-6",children:s.jsx(J,{type:"generic",title:"Failed to load dependency graph",description:y instanceof Error?y.message:"Unknown error",onRetry:()=>L()})});const C=j?.nodes??[],I=j?.edges??[],i=j?.critical_path??[],o=180,c=56,G=120,R=24,h=new Map;for(const e of C)h.has(e.level)||h.set(e.level,[]),h.get(e.level).push(e);const u=new Map;for(const[e,t]of h){const a=60+e*(o+G);for(let r=0;r<t.length;r++){const d=60+r*(c+R);u.set(t[r].id,{x:a,y:d})}}const N=new Set(i.map(e=>e.id));return s.jsxs("div",{"data-testid":"page-dependency-graph",className:"p-6",children:[s.jsx("div",{className:"mb-4",children:s.jsx(g,{variant:"ghost",size:"sm",asChild:!0,children:s.jsxs(X,{to:"/work-items",children:[s.jsx(z,{className:"mr-1 size-4 rotate-180"}),"Back to Work Items"]})})}),s.jsxs(T,{children:[s.jsx(A,{children:s.jsxs(O,{className:"flex items-center gap-2",children:[s.jsx(ee,{className:"size-5"}),"Dependency Graph"]})}),s.jsxs(Q,{children:[s.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[s.jsx(g,{variant:"outline",size:"sm",onClick:()=>m(e=>Math.min(3,e*1.2)),children:"Zoom In"}),s.jsx(g,{variant:"outline",size:"sm",onClick:()=>m(e=>Math.max(.2,e*.8)),children:"Zoom Out"}),s.jsx(g,{variant:"outline",size:"sm",onClick:()=>{m(1),k({x:0,y:0})},children:"Reset"}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:["Zoom: ",Math.round(l*100),"% | Drag to pan"]})]}),s.jsx("div",{className:"rounded-lg border overflow-hidden cursor-grab active:cursor-grabbing select-none",onWheel:B,onMouseDown:W,onMouseMove:E,onMouseUp:M,onMouseLeave:M,children:s.jsxs("svg",{width:900,height:500,viewBox:`${-x.x/l} ${-x.y/l} ${900/l} ${500/l}`,className:"font-sans text-xs bg-muted/20",children:[I.map(e=>{const t=u.get(e.source),a=u.get(e.target);if(!t||!a)return null;const r=a.x+o,d=a.y+c/2,Z=t.x,Y=t.y+c/2,v=N.has(e.source)&&N.has(e.target);return s.jsx("line",{x1:r,y1:d,x2:Z,y2:Y,className:v?"stroke-destructive":"stroke-muted-foreground",strokeWidth:v?2.5:1.5,markerEnd:v?"url(#arrowhead-critical)":"url(#arrowhead-normal)"},e.id)}),C.map(e=>{const t=u.get(e.id);if(!t)return null;const a=N.has(e.id),r=e.status==="done"||e.status==="closed",d=K[e.kind]||"bg-gray-500";return s.jsxs("g",{children:[s.jsx("rect",{x:t.x,y:t.y,width:o,height:c,rx:8,className:`${r?"fill-muted":d} ${r?"opacity-50":""}`,stroke:a?"#ef4444":e.is_blocker?"#f59e0b":"transparent",strokeWidth:a?3:e.is_blocker?2:0}),s.jsx("text",{x:t.x+10,y:t.y+22,className:"fill-white text-xs font-semibold",children:e.title.length>20?e.title.slice(0,18)+"...":e.title}),s.jsxs("text",{x:t.x+10,y:t.y+40,className:"fill-white/80 text-[10px]",children:[e.kind," | ",e.status||"open"]}),e.is_blocker&&s.jsx("text",{x:t.x+o-20,y:t.y+18,className:"fill-yellow-300 text-sm",children:"!"}),e.estimate_minutes&&s.jsx("text",{x:t.x+o-10,y:t.y+c-10,className:"fill-white/70 text-[9px]",textAnchor:"end",children:e.estimate_minutes>=60?`${Math.floor(e.estimate_minutes/60)}h`:`${e.estimate_minutes}m`})]},e.id)}),s.jsxs("defs",{children:[s.jsx("marker",{id:"arrowhead-normal",markerWidth:"8",markerHeight:"8",refX:"6",refY:"4",orient:"auto",children:s.jsx("path",{d:"M0,0 L8,4 L0,8 Z",className:"fill-muted-foreground"})}),s.jsx("marker",{id:"arrowhead-critical",markerWidth:"8",markerHeight:"8",refX:"6",refY:"4",orient:"auto",children:s.jsx("path",{d:"M0,0 L8,4 L0,8 Z",className:"fill-destructive"})})]})]})}),i.length>0&&s.jsxs("div",{className:"mt-6",children:[s.jsx("h3",{className:"text-sm font-medium mb-3",children:"Critical Path"}),s.jsx("div",{className:"flex flex-wrap items-center gap-2",children:i.map((e,t)=>s.jsxs(F.Fragment,{children:[s.jsxs(V,{variant:"outline",className:"border-destructive text-destructive bg-destructive/10",children:[e.title,e.estimate_minutes&&s.jsxs("span",{className:"ml-2 text-muted-foreground",children:["(",e.estimate_minutes>=60?`${Math.floor(e.estimate_minutes/60)}h`:`${e.estimate_minutes}m`,")"]})]}),t<i.length-1&&s.jsx(z,{className:"size-4 text-muted-foreground"})]},e.id))}),s.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Total: ",i.reduce((e,t)=>e+(t.estimate_minutes||0),0)," minutes (",Math.round(i.reduce((e,t)=>e+(t.estimate_minutes||0),0)/60*10)/10," hours)"]})]}),s.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[s.jsx("span",{className:"font-medium",children:"Legend:"}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"size-3 rounded bg-blue-500"})," Project"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"size-3 rounded bg-violet-500"})," Initiative"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"size-3 rounded bg-emerald-500"})," Epic"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"size-3 rounded bg-gray-500"})," Issue"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"text-yellow-500 font-bold",children:"!"})," Blocker"]}),s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"h-0.5 w-4 bg-destructive"})," Critical Path"]})]})]})]})]})}export{xe as DependencyGraphPage};
//# sourceMappingURL=DependencyGraphPage-DFkcOdN0.js.map
