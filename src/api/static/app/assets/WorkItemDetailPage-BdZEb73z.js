import{S as xs,s as ps,h as be,g as js,n as Te,b as V,r as x,c as fs,d as gs,j as e,e as Ns,L as G}from"./index-Dmu1Cmf3.js";import{w as R,L as de,T as me,G as vs,D as ue,a as he,b as xe,c as Y,g as ys,e as bs,f as ks,U as Cs}from"./use-work-item-delete-BEyx1jRy.js";import{u as Ie,C as ke,E as ws}from"./error-state-CCoNnbdR.js";import{a as A}from"./api-client-CDvRtWmo.js";import{r as zs,b as Ds,c as Ss}from"./work-item-utils-RZsWa1qH.js";import{C as $,b as q,c as Ms,d as ce,e as le,S as Ce}from"./card-BWtpZjNX.js";import{c as _,B as u,a as z,u as Pe}from"./button-B4tyHn7n.js";import{B as I}from"./badge-BFA1Pi_I.js";import{S as _s}from"./scroll-area-C0mBrwpt.js";import{I as W}from"./input-D2fjPNS6.js";import{C as Le}from"./chevron-right-BJooG6vZ.js";import{C as se,S as Es,a as Ts,b as Is,c as Ps,d as Ls,u as $s}from"./select-q5_DDhZm.js";import{X as pe,D as qs,a as Us,b as As,c as Ks,d as Rs,e as Os}from"./dialog-DPKlQCu7.js";import{P as te,T as je}from"./index-CqAfc_78.js";import{F as ae,C as B,U as Ws}from"./users-DVF8IM-O.js";import{F as fe,P as F}from"./plus-CdqVz24t.js";import{U as $e}from"./user-DgBB4SX6.js";import{C as oe}from"./clock-DkZQ61zJ.js";import{T as qe}from"./textarea-Brqak-GW.js";import{E as Ue}from"./eye-CSzGZ__s.js";import{P as ge,c as we,a as Bs}from"./index-DT505RDd.js";import{a as Fs}from"./index-BdkY-9YW.js";import{u as Vs}from"./index-BfbTaDZO.js";import{P as Qs}from"./index-CicDskkn.js";import{L as U}from"./link-2-D5cDWkwv.js";import{M as X}from"./mail-Bh_6JRWm.js";import{A as Hs,T as Ae,a as Ke,b as J,c as Z}from"./tabs-CP7p3l1E.js";import{L as Gs}from"./list-CIS01osM.js";import{N as Ys}from"./network-BR9oX5dG.js";import"./index-BdQq_4o_.js";var Xs=class extends xs{#s;#a=void 0;#e;#t;constructor(s,t){super(),this.#s=s,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const t=this.options;this.options=this.#s.defaultMutationOptions(s),ps(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&be(t.mutationKey)!==be(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(s){this.#i(),this.#n(s)}getCurrentResult(){return this.#a}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#n()}mutate(s,t){return this.#t=t,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(s)}#i(){const s=this.#e?.state??js();this.#a={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#n(s){Te.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#a.variables,a=this.#a.context,n={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};if(s?.type==="success"){try{this.#t.onSuccess?.(s.data,t,a,n)}catch(l){Promise.reject(l)}try{this.#t.onSettled?.(s.data,null,t,a,n)}catch(l){Promise.reject(l)}}else if(s?.type==="error"){try{this.#t.onError?.(s.error,t,a,n)}catch(l){Promise.reject(l)}try{this.#t.onSettled?.(void 0,s.error,t,a,n)}catch(l){Promise.reject(l)}}}this.listeners.forEach(t=>{t(this.#a)})})}};function Ne(s,t){const a=V(),[n]=x.useState(()=>new Xs(a,s));x.useEffect(()=>{n.setOptions(s)},[n,s]);const l=x.useSyncExternalStore(x.useCallback(r=>n.subscribe(Te.batchCalls(r)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),i=x.useCallback((r,c)=>{n.mutate(r,c).catch(fs)},[n]);if(l.error&&gs(n.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:i,mutateAsync:l.mutate}}const Js=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Zs=_("arrow-right",Js);const et=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],st=_("bold",et);const tt=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],at=_("brain",tt);const it=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],nt=_("code",it);const rt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],ve=_("ellipsis-vertical",rt);const ct=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],lt=_("external-link",ct);const ot=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],dt=_("italic",ot);const mt=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],ut=_("list-ordered",mt);const ht=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],xt=_("map-pin",ht);const pt=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],jt=_("paperclip",pt);const ft=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],gt=_("pen-line",ft);const Nt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],vt=_("pen",Nt);const yt=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],Re=_("unlink",yt);const bt=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],kt=_("video",bt),L={all:["memories"],lists:()=>[...L.all,"list"],list:()=>[...L.lists()],forWorkItem:s=>[...L.all,"work-item",s]};function Ct(s){return Ie({queryKey:L.forWorkItem(s),queryFn:({signal:t})=>A.get(`/api/work-items/${s}/memories`,{signal:t}),enabled:!!s})}const ee={all:["communications"],forWorkItem:s=>[...ee.all,"work-item",s]};function wt(s){return Ie({queryKey:ee.forWorkItem(s),queryFn:({signal:t})=>A.get(`/api/work-items/${s}/communications`,{signal:t}),enabled:!!s})}function zt(){const s=V();return Ne({mutationFn:({id:t,body:a})=>A.put(`/api/work-items/${t}`,a),onMutate:async({id:t,body:a})=>{await s.cancelQueries({queryKey:R.detail(t)});const n=s.getQueryData(R.detail(t));if(n){const l={...n,...a.title!==void 0?{title:a.title}:{},...a.status!==void 0?{status:a.status}:{},...a.priority!==void 0?{priority:a.priority}:{},...a.description!==void 0?{description:a.description}:{}};s.setQueryData(R.detail(t),l)}return{previousDetail:n}},onError:(t,{id:a},n)=>{n?.previousDetail&&s.setQueryData(R.detail(a),n.previousDetail)},onSettled:(t,a,{id:n})=>{s.invalidateQueries({queryKey:R.detail(n)}),s.invalidateQueries({queryKey:R.lists()}),s.invalidateQueries({queryKey:R.tree()})}})}function Dt(){const s=V();return Ne({mutationFn:({workItemId:t,body:a})=>A.post(`/api/work-items/${t}/memories`,a),onSuccess:(t,{workItemId:a})=>{s.invalidateQueries({queryKey:L.forWorkItem(a)}),s.invalidateQueries({queryKey:L.lists()})}})}function St(){const s=V();return Ne({mutationFn:({id:t,body:a})=>A.patch(`/api/memories/${t}`,a),onSuccess:(t,{workItemId:a})=>{s.invalidateQueries({queryKey:L.lists()}),a&&s.invalidateQueries({queryKey:L.forWorkItem(a)})}})}function Mt(s){switch(s){case"project":return e.jsx(fe,{className:"size-5"});case"initiative":return e.jsx(me,{className:"size-5"});case"epic":return e.jsx(de,{className:"size-5"});case"issue":return e.jsx(ae,{className:"size-5"})}}function _t(s){return s.charAt(0).toUpperCase()+s.slice(1)}function Et(s){switch(s){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function Tt(s){return s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}function It({title:s,kind:t,status:a,parentTitle:n,onTitleChange:l,onParentClick:i,onDelete:r,className:c}){const[m,p]=x.useState(!1),[d,h]=x.useState(s),j=()=>{h(s),p(!0)},v=()=>{d.trim()&&d!==s&&l?.(d.trim()),p(!1)},D=()=>{h(s),p(!1)},y=N=>{N.key==="Enter"?v():N.key==="Escape"&&D()};return e.jsxs("div",{className:z("space-y-2",c),children:[n&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("button",{className:"hover:text-foreground hover:underline",onClick:i,children:n}),e.jsx(Le,{className:"size-4"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 text-muted-foreground",children:Mt(t)}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-2",children:[m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{value:d,onChange:N=>h(N.target.value),onKeyDown:y,autoFocus:!0,className:"text-xl font-semibold"}),e.jsxs(u,{variant:"ghost",size:"icon",onClick:v,children:[e.jsx(se,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Save"})]}),e.jsxs(u,{variant:"ghost",size:"icon",onClick:D,children:[e.jsx(pe,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Cancel"})]})]}):e.jsxs("div",{className:"group flex items-start gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold",children:s}),l&&e.jsxs(u,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 group-hover:opacity-100",onClick:j,children:[e.jsx(te,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Edit title"})]}),r&&e.jsxs(u,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 text-destructive hover:text-destructive group-hover:opacity-100",onClick:r,children:[e.jsx(je,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(I,{variant:"outline",children:_t(t)}),e.jsx(I,{variant:Et(a),children:Tt(a)})]})]})]})]})}function ze(s){return s?s.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"Not set"}function De(s){if(!s)return"Not set";if(s<60)return`${s}m`;const t=Math.floor(s/60),a=s%60;return a>0?`${t}h ${a}m`:`${t}h`}function O({icon:s,label:t,value:a,editable:n,onEdit:l,editType:i="text",options:r}){const[c,m]=x.useState(!1),[p,d]=x.useState(a),h=()=>{l?.(p),m(!1)},j=()=>{d(a),m(!1)};return e.jsxs("div",{className:"flex items-start gap-3 rounded-md p-2 hover:bg-muted/50",children:[e.jsx("span",{className:"mt-0.5 text-muted-foreground",children:s}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:t}),c?e.jsxs("div",{className:"mt-1 flex items-center gap-1",children:[i==="select"&&r?e.jsxs(Es,{value:p,onValueChange:d,children:[e.jsx(Ts,{className:"h-8 text-sm",children:e.jsx(Is,{})}),e.jsx(Ps,{children:r.map(v=>e.jsx(Ls,{value:v.value,children:v.label},v.value))})]}):i==="date"?e.jsx(W,{type:"date",value:p,onChange:v=>d(v.target.value),className:"h-8 text-sm"}):e.jsx(W,{type:i==="number"?"number":"text",value:p,onChange:v=>d(v.target.value),className:"h-8 text-sm"}),e.jsx(u,{variant:"ghost",size:"icon",className:"size-6",onClick:h,children:e.jsx(se,{className:"size-3"})}),e.jsx(u,{variant:"ghost",size:"icon",className:"size-6",onClick:j,children:e.jsx(pe,{className:"size-3"})})]}):e.jsxs("div",{className:"group flex items-center gap-1",children:[e.jsx("p",{className:"text-sm",children:a}),n&&l&&e.jsx(u,{variant:"ghost",size:"icon",className:"size-5 opacity-0 group-hover:opacity-100",onClick:()=>m(!0),children:e.jsx(te,{className:"size-3"})})]})]})]})}const Se=[{value:"not_started",label:"Not Started"},{value:"in_progress",label:"In Progress"},{value:"blocked",label:"Blocked"},{value:"done",label:"Done"},{value:"cancelled",label:"Cancelled"}],Me=[{value:"urgent",label:"Urgent"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}];function Pt({status:s,priority:t,assignee:a,dueDate:n,startDate:l,estimateMinutes:i,actualMinutes:r,onStatusChange:c,onPriorityChange:m,onAssigneeChange:p,onDueDateChange:d,onStartDateChange:h,onEstimateChange:j,onActualChange:v,className:D}){const y=f=>Me.find(C=>C.value===f)?.label??f,N=f=>Se.find(C=>C.value===f)?.label??f;return e.jsxs("div",{className:z("grid gap-1 sm:grid-cols-2",D),children:[e.jsx(O,{icon:e.jsx(ke,{className:"size-4"}),label:"Status",value:N(s),editable:!!c,onEdit:f=>c?.(f),editType:"select",options:Se}),e.jsx(O,{icon:e.jsx(ke,{className:"size-4"}),label:"Priority",value:y(t),editable:!!m,onEdit:f=>m?.(f),editType:"select",options:Me}),e.jsx(O,{icon:e.jsx($e,{className:"size-4"}),label:"Assignee",value:a||"Unassigned",editable:!!p,onEdit:p}),e.jsx(O,{icon:e.jsx(B,{className:"size-4"}),label:"Due Date",value:ze(n),editable:!!d,onEdit:d,editType:"date"}),e.jsx(O,{icon:e.jsx(B,{className:"size-4"}),label:"Start Date",value:ze(l),editable:!!h,onEdit:h,editType:"date"}),e.jsx(O,{icon:e.jsx(oe,{className:"size-4"}),label:"Estimate",value:De(i),editable:!!j,onEdit:j,editType:"number"}),e.jsx(O,{icon:e.jsx(oe,{className:"size-4"}),label:"Actual",value:De(r),editable:!!v,onEdit:v,editType:"number"})]})}function Lt({description:s,onDescriptionChange:t,className:a}){const[n,l]=x.useState(!1),[i,r]=x.useState(s||""),[c,m]=x.useState(!1),p=()=>{r(s||""),l(!0),m(!1)},d=()=>{t?.(i),l(!1)},h=()=>{r(s||""),l(!1),m(!1)},j=v=>v?v.split(`
`).map((y,N)=>{if(y.startsWith("### "))return e.jsx("h4",{className:"mt-4 mb-2 text-sm font-semibold",children:y.slice(4)},N);if(y.startsWith("## "))return e.jsx("h3",{className:"mt-4 mb-2 font-semibold",children:y.slice(3)},N);if(y.startsWith("# "))return e.jsx("h2",{className:"mt-4 mb-2 text-lg font-semibold",children:y.slice(2)},N);if(y.startsWith("- ")||y.startsWith("* "))return e.jsx("li",{className:"ml-4",children:y.slice(2)},N);if(!y.trim())return e.jsx("br",{},N);const f=C=>{const M=[];let b=C,P=0;for(;b.length>0;){const g=b.match(/^`([^`]+)`/);if(g){M.push(e.jsx("code",{className:"rounded bg-muted px-1 text-sm",children:g[1]},P++)),b=b.slice(g[0].length);continue}const k=b.match(/^\*\*([^*]+)\*\*/);if(k){M.push(e.jsx("strong",{children:k[1]},P++)),b=b.slice(k[0].length);continue}const S=b.match(/^\*([^*]+)\*/);if(S){M.push(e.jsx("em",{children:S[1]},P++)),b=b.slice(S[0].length);continue}const w=b.search(/[`*]/);if(w===-1){M.push(b);break}else w===0?(M.push(b[0]),b=b.slice(1)):(M.push(b.slice(0,w)),b=b.slice(w))}return M};return e.jsx("p",{className:"my-1",children:f(y)},N)}):null;return e.jsxs("div",{className:z("space-y-3",a),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Description"}),!n&&t&&e.jsxs(u,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:p,children:[e.jsx(te,{className:"size-3"}),"Edit"]}),n&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(u,{variant:"ghost",size:"sm",className:z("h-7 gap-1",!c&&"bg-muted"),onClick:()=>m(!1),children:[e.jsx(vt,{className:"size-3"}),"Edit"]}),e.jsxs(u,{variant:"ghost",size:"sm",className:z("h-7 gap-1",c&&"bg-muted"),onClick:()=>m(!0),children:[e.jsx(Ue,{className:"size-3"}),"Preview"]})]})]}),n?e.jsxs("div",{className:"space-y-3",children:[c?e.jsx("div",{className:"min-h-32 rounded-md border bg-muted/30 p-3 text-sm",children:i?j(i):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})}):e.jsx(qe,{value:i,onChange:v=>r(v.target.value),placeholder:"Add a description... (Markdown supported)",className:"min-h-32 font-mono text-sm"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(u,{variant:"ghost",size:"sm",onClick:h,children:[e.jsx(pe,{className:"mr-1 size-3"}),"Cancel"]}),e.jsxs(u,{size:"sm",onClick:d,children:[e.jsx(se,{className:"mr-1 size-3"}),"Save"]})]})]}):s?e.jsx("div",{className:"prose prose-sm max-w-none rounded-md bg-muted/30 p-3",children:j(s)}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No description"})]})}var ie="Checkbox",[$t]=Bs(ie),[qt,ye]=$t(ie);function Ut(s){const{__scopeCheckbox:t,checked:a,children:n,defaultChecked:l,disabled:i,form:r,name:c,onCheckedChange:m,required:p,value:d="on",internal_do_not_use_render:h}=s,[j,v]=Fs({prop:a,defaultProp:l??!1,onChange:m,caller:ie}),[D,y]=x.useState(null),[N,f]=x.useState(null),C=x.useRef(!1),M=D?!!r||!!D.closest("form"):!0,b={checked:j,disabled:i,setChecked:v,control:D,setControl:y,name:c,form:r,value:d,hasConsumerStoppedPropagationRef:C,required:p,defaultChecked:K(l)?!1:l,isFormControl:M,bubbleInput:N,setBubbleInput:f};return e.jsx(qt,{scope:t,...b,children:At(h)?h(b):n})}var Oe="CheckboxTrigger",We=x.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:a,...n},l)=>{const{control:i,value:r,disabled:c,checked:m,required:p,setControl:d,setChecked:h,hasConsumerStoppedPropagationRef:j,isFormControl:v,bubbleInput:D}=ye(Oe,s),y=Pe(l,d),N=x.useRef(m);return x.useEffect(()=>{const f=i?.form;if(f){const C=()=>h(N.current);return f.addEventListener("reset",C),()=>f.removeEventListener("reset",C)}},[i,h]),e.jsx(ge.button,{type:"button",role:"checkbox","aria-checked":K(m)?"mixed":m,"aria-required":p,"data-state":Ge(m),"data-disabled":c?"":void 0,disabled:c,value:r,...n,ref:y,onKeyDown:we(t,f=>{f.key==="Enter"&&f.preventDefault()}),onClick:we(a,f=>{h(C=>K(C)?!0:!C),D&&v&&(j.current=f.isPropagationStopped(),j.current||f.stopPropagation())})})});We.displayName=Oe;var Be=x.forwardRef((s,t)=>{const{__scopeCheckbox:a,name:n,checked:l,defaultChecked:i,required:r,disabled:c,value:m,onCheckedChange:p,form:d,...h}=s;return e.jsx(Ut,{__scopeCheckbox:a,checked:l,defaultChecked:i,disabled:c,required:r,onCheckedChange:p,name:n,form:d,value:m,internal_do_not_use_render:({isFormControl:j})=>e.jsxs(e.Fragment,{children:[e.jsx(We,{...h,ref:t,__scopeCheckbox:a}),j&&e.jsx(He,{__scopeCheckbox:a})]})})});Be.displayName=ie;var Fe="CheckboxIndicator",Ve=x.forwardRef((s,t)=>{const{__scopeCheckbox:a,forceMount:n,...l}=s,i=ye(Fe,a);return e.jsx(Qs,{present:n||K(i.checked)||i.checked===!0,children:e.jsx(ge.span,{"data-state":Ge(i.checked),"data-disabled":i.disabled?"":void 0,...l,ref:t,style:{pointerEvents:"none",...s.style}})})});Ve.displayName=Fe;var Qe="CheckboxBubbleInput",He=x.forwardRef(({__scopeCheckbox:s,...t},a)=>{const{control:n,hasConsumerStoppedPropagationRef:l,checked:i,defaultChecked:r,required:c,disabled:m,name:p,value:d,form:h,bubbleInput:j,setBubbleInput:v}=ye(Qe,s),D=Pe(a,v),y=$s(i),N=Vs(n);x.useEffect(()=>{const C=j;if(!C)return;const M=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(M,"checked").set,g=!l.current;if(y!==i&&P){const k=new Event("click",{bubbles:g});C.indeterminate=K(i),P.call(C,K(i)?!1:i),C.dispatchEvent(k)}},[j,y,i,l]);const f=x.useRef(K(i)?!1:i);return e.jsx(ge.input,{type:"checkbox","aria-hidden":!0,defaultChecked:r??f.current,required:c,disabled:m,name:p,value:d,form:h,...t,tabIndex:-1,ref:D,style:{...t.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});He.displayName=Qe;function At(s){return typeof s=="function"}function K(s){return s==="indeterminate"}function Ge(s){return K(s)?"indeterminate":s?"checked":"unchecked"}function Kt({className:s,...t}){return e.jsx(Be,{"data-slot":"checkbox",className:z("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Ve,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:e.jsx(se,{className:"size-3.5"})})})}function Rt({todos:s,onAdd:t,onToggle:a,onDelete:n,className:l}){const[i,r]=x.useState(""),c=()=>{i.trim()&&t&&(t(i.trim()),r(""))},m=d=>{d.key==="Enter"&&c()},p=s.filter(d=>d.completed).length;return e.jsxs("div",{className:z("space-y-3",l),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Checklist"}),s.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[p,"/",s.length," completed"]})]}),s.length>0&&e.jsx("div",{className:"h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${p/s.length*100}%`}})}),e.jsx("div",{className:"space-y-1",children:s.map(d=>e.jsxs("div",{"data-testid":"todo-item",className:z("group flex items-center gap-2 rounded-md px-2 py-1.5","hover:bg-muted/50"),children:[e.jsx(vs,{className:"size-4 cursor-grab text-muted-foreground opacity-0 group-hover:opacity-100"}),e.jsx(Kt,{checked:d.completed,onCheckedChange:h=>a?.(d.id,h===!0),"aria-label":`Mark "${d.text}" as ${d.completed?"incomplete":"complete"}`}),e.jsx("span",{className:z("flex-1 text-sm",d.completed&&"text-muted-foreground line-through"),children:d.text}),n&&e.jsxs(u,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:()=>n(d.id),children:[e.jsx(je,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]},d.id))}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"size-4 text-muted-foreground"}),e.jsx(W,{value:i,onChange:d=>r(d.target.value),onKeyDown:m,placeholder:"Add a task...",className:"h-8 flex-1"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:c,disabled:!i.trim(),children:"Add"})]}),s.length===0&&!t&&e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No tasks yet"})]})}function Ot(s){switch(s){case"memory":return e.jsx(at,{className:"size-4"});case"contact":return e.jsx($e,{className:"size-4"});case"email":return e.jsx(X,{className:"size-4"});case"calendar":return e.jsx(B,{className:"size-4"})}}function Wt(s){switch(s){case"memory":return"Memory";case"contact":return"Contact";case"email":return"Email";case"calendar":return"Event"}}function Bt({attachments:s,onAttachmentClick:t,onLinkNew:a,className:n}){const l=x.useMemo(()=>{const r={memory:[],contact:[],email:[],calendar:[]};for(const c of s)r[c.type].push(c);return r},[s]),i=s.length>0;return e.jsxs("div",{className:z("space-y-4",n),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Linked Items"}),a&&e.jsxs(u,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:a,children:[e.jsx(U,{className:"size-3"}),"Link"]})]}),i?e.jsx("div",{className:"space-y-4",children:Object.entries(l).filter(([r,c])=>c.length>0).map(([r,c])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"mb-2 flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[Ot(r),Wt(r),"s (",c.length,")"]}),e.jsx("div",{className:"space-y-1",children:c.map(m=>e.jsxs("button",{"data-testid":"attachment-item",className:z("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",t&&"cursor-pointer"),onClick:()=>t?.(m),children:[e.jsxs("span",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"block truncate text-sm",children:m.title}),m.subtitle&&e.jsx("span",{className:"block truncate text-xs text-muted-foreground",children:m.subtitle})]}),t&&e.jsx(lt,{className:"size-3 shrink-0 text-muted-foreground"})]},m.id))})]},r))}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No linked items"})]})}function Ft(s){switch(s){case"project":return e.jsx(fe,{className:"size-4"});case"initiative":return e.jsx(me,{className:"size-4"});case"epic":return e.jsx(de,{className:"size-4"});case"issue":return e.jsx(ae,{className:"size-4"})}}function Vt(s){switch(s){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function Qt(s){return s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}function Ht({dependencies:s,onDependencyClick:t,onAddDependency:a,className:n}){const l=s.filter(c=>c.direction==="blocked_by"),i=s.filter(c=>c.direction==="blocks"),r=c=>e.jsxs("button",{"data-testid":"dependency-item",className:z("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",t&&"cursor-pointer"),onClick:()=>t?.(c),children:[e.jsx("span",{className:"text-muted-foreground",children:Ft(c.kind)}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm",children:c.title}),e.jsx(I,{variant:Vt(c.status),className:"shrink-0 text-xs",children:Qt(c.status)})]},c.id);return e.jsxs("div",{className:z("space-y-4",n),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(Hs,{className:"size-4"}),"Blocked by (",l.length,")"]}),a&&e.jsxs(u,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocked_by"),children:[e.jsx(F,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add blocker"})]})]}),l.length>0?e.jsx("div",{className:"space-y-1",children:l.map(r)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No blockers"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(Zs,{className:"size-4"}),"Blocks (",i.length,")"]}),a&&e.jsxs(u,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocks"),children:[e.jsx(F,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add dependent"})]})]}),i.length>0?e.jsx("div",{className:"space-y-1",children:i.map(r)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No dependents"})]})]})}function Gt({item:s,onTitleChange:t,onDescriptionChange:a,onStatusChange:n,onPriorityChange:l,onAssigneeChange:i,onDueDateChange:r,onStartDateChange:c,onEstimateChange:m,onActualChange:p,onTodoAdd:d,onTodoToggle:h,onTodoDelete:j,onAttachmentClick:v,onLinkAttachment:D,onDependencyClick:y,onAddDependency:N,onParentClick:f,onDelete:C,className:M}){return e.jsx("div",{className:z("flex h-full flex-col",M),children:e.jsx(_s,{className:"flex-1",children:e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6 p-6",children:[e.jsx(It,{title:s.title,kind:s.kind,status:s.status,parentTitle:s.parentTitle,onTitleChange:t,onParentClick:f,onDelete:C}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsx($,{children:e.jsx(q,{className:"pt-4",children:e.jsx(Pt,{status:s.status,priority:s.priority,assignee:s.assignee,dueDate:s.dueDate,startDate:s.startDate,estimateMinutes:s.estimateMinutes,actualMinutes:s.actualMinutes,onStatusChange:n,onPriorityChange:l,onAssigneeChange:i,onDueDateChange:r,onStartDateChange:c,onEstimateChange:m,onActualChange:p})})}),e.jsx($,{children:e.jsx(q,{className:"pt-4",children:e.jsx(Lt,{description:s.description,onDescriptionChange:a})})}),e.jsx($,{children:e.jsx(q,{className:"pt-4",children:e.jsx(Rt,{todos:s.todos,onAdd:d,onToggle:h,onDelete:j})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx($,{children:e.jsx(q,{className:"pt-4",children:e.jsx(Bt,{attachments:s.attachments,onAttachmentClick:v,onLinkNew:D})})}),e.jsx($,{children:e.jsx(q,{className:"pt-4",children:e.jsx(Ht,{dependencies:s.dependencies,onDependencyClick:y,onAddDependency:N})})})]})]})]})})})}function Yt(s){switch(s){case"project":return e.jsx(fe,{className:"size-3"});case"initiative":return e.jsx(me,{className:"size-3"});case"epic":return e.jsx(de,{className:"size-3"});case"issue":return e.jsx(ae,{className:"size-3"});default:return null}}function Xt({memory:s,onClick:t,onEdit:a,onDelete:n,className:l}){const i=s.content.slice(0,150)+(s.content.length>150?"...":"");return e.jsxs("div",{"data-testid":"memory-card",className:z("group relative rounded-lg border bg-card p-4 transition-colors hover:bg-accent/50",t&&"cursor-pointer",l),onClick:()=>t?.(s),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-medium leading-tight",children:s.title}),(a||n)&&e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:r=>r.stopPropagation(),children:e.jsx(ve,{className:"size-4"})})}),e.jsxs(xe,{align:"end",children:[a&&e.jsxs(Y,{onClick:r=>{r.stopPropagation(),a(s)},children:[e.jsx(te,{className:"mr-2 size-4"}),"Edit"]}),n&&e.jsxs(Y,{className:"text-destructive focus:text-destructive",onClick:r=>{r.stopPropagation(),n(s)},children:[e.jsx(je,{className:"mr-2 size-4"}),"Delete"]})]})]})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground line-clamp-2",children:i}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:s.linkedItemKind&&s.linkedItemTitle&&e.jsxs("span",{className:"flex items-center gap-1",children:[Yt(s.linkedItemKind),e.jsx("span",{className:"truncate max-w-[120px]",children:s.linkedItemTitle})]})}),e.jsx("span",{children:s.updatedAt.toLocaleDateString()})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.tags.map(r=>e.jsx(I,{variant:"secondary",className:"text-xs",children:r},r))})]})}function Jt({memories:s,onMemoryClick:t,onAddMemory:a,onLinkMemory:n,onEditMemory:l,onDeleteMemory:i,className:r}){return e.jsxs("div",{className:z("space-y-4",r),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Memories"}),e.jsx(I,{variant:"secondary",className:"text-xs",children:s.length})]}),e.jsxs("div",{className:"flex gap-1",children:[n&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:n,children:[e.jsx(U,{className:"mr-1 size-3"}),"Link"]}),a&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:a,children:[e.jsx(F,{className:"mr-1 size-3"}),"Add"]})]})]}),s.length>0?e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:s.map(c=>e.jsx(Xt,{memory:c,onClick:t,onEdit:l,onDelete:i},c.id))}):e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx(ae,{className:"mx-auto size-8 text-muted-foreground/50"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"No memories attached"}),(a||n)&&e.jsxs("div",{className:"mt-3 flex justify-center gap-2",children:[a&&e.jsxs(u,{variant:"outline",size:"sm",onClick:a,children:[e.jsx(F,{className:"mr-1 size-3"}),"Create new"]}),n&&e.jsxs(u,{variant:"outline",size:"sm",onClick:n,children:[e.jsx(U,{className:"mr-1 size-3"}),"Link existing"]})]})]})]})}function Zt({memory:s,open:t,onOpenChange:a,onSubmit:n,className:l}){const[i,r]=x.useState(s?.title??""),[c,m]=x.useState(s?.content??""),[p,d]=x.useState(""),[h,j]=x.useState(s?.tags??[]),[v,D]=x.useState("edit"),y=x.useRef(null),N=x.useCallback((g,k="")=>{const S=y.current;if(!S)return;const w=S.selectionStart,Q=S.selectionEnd,H=c.slice(w,Q),ne=c.slice(0,w)+g+(H||"text")+k+c.slice(Q);m(ne),setTimeout(()=>{S.focus();const T=w+g.length,re=T+(H||"text").length;S.setSelectionRange(T,re)},0)},[c]),f=()=>{const g=p.trim();g&&!h.includes(g)&&(j([...h,g]),d(""))},C=g=>{j(h.filter(k=>k!==g))},M=g=>{g.preventDefault(),n({title:i.trim(),content:c.trim(),tags:h.length>0?h:void 0})},b=i.trim()&&c.trim(),P=g=>g.split(`
`).map((k,S)=>k.startsWith("### ")?e.jsx("h3",{className:"text-lg font-semibold mt-4 mb-2",children:k.slice(4)},S):k.startsWith("## ")?e.jsx("h2",{className:"text-xl font-semibold mt-4 mb-2",children:k.slice(3)},S):k.startsWith("# ")?e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",children:k.slice(2)},S):k.startsWith("- ")||k.startsWith("* ")?e.jsx("li",{className:"ml-4",children:k.slice(2)},S):/^\d+\. /.test(k)?e.jsx("li",{className:"ml-4 list-decimal",children:k.replace(/^\d+\. /,"")},S):k.trim()?e.jsx("p",{className:"my-1",children:k},S):e.jsx("br",{},S));return e.jsx(qs,{open:t,onOpenChange:a,children:e.jsxs(Us,{className:z("sm:max-w-2xl",l),children:[e.jsxs(As,{children:[e.jsx(Ks,{children:s?"Edit Memory":"Create Memory"}),e.jsx(Rs,{className:"sr-only",children:s?"Edit memory details":"Create a new memory entry"})]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"memory-title",className:"text-sm font-medium",children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(W,{id:"memory-title",value:i,onChange:g=>r(g.target.value),placeholder:"Memory title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-medium",children:["Content ",e.jsx("span",{className:"text-destructive",children:"*"})]})}),e.jsxs(Ae,{value:v,onValueChange:g=>D(g),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>N("**","**"),title:"Bold",children:e.jsx(st,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>N("*","*"),title:"Italic",children:e.jsx(dt,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>N("- "),title:"Bullet list",children:e.jsx(Gs,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>N("1. "),title:"Numbered list",children:e.jsx(ut,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>N("[","](url)"),title:"Link",children:e.jsx(U,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>N("`","`"),title:"Code",children:e.jsx(nt,{className:"size-4"})})]}),e.jsxs(Ke,{children:[e.jsxs(J,{value:"edit",className:"gap-1",children:[e.jsx(gt,{className:"size-3"}),"Edit"]}),e.jsxs(J,{value:"preview",className:"gap-1",children:[e.jsx(Ue,{className:"size-3"}),"Preview"]})]})]}),e.jsx(Z,{value:"edit",className:"mt-2",children:e.jsx(qe,{ref:y,value:c,onChange:g=>m(g.target.value),placeholder:"Write your memory content here... (Markdown supported)",className:"min-h-[200px] font-mono text-sm",required:!0})}),e.jsx(Z,{value:"preview",className:"mt-2",children:e.jsx("div",{className:"min-h-[200px] rounded-md border bg-muted/30 p-4 text-sm",children:c?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:P(c)}):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"memory-tags",className:"text-sm font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{id:"memory-tags",value:p,onChange:g=>d(g.target.value),placeholder:"Add a tag",onKeyDown:g=>{g.key==="Enter"&&(g.preventDefault(),f())}}),e.jsx(u,{type:"button",variant:"outline",onClick:f,children:"Add"})]}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:h.map(g=>e.jsxs(I,{variant:"secondary",className:"cursor-pointer",onClick:()=>C(g),children:[g," Ã—"]},g))})]}),e.jsxs(Os,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(u,{type:"submit",disabled:!b,children:s?"Save Changes":"Create Memory"})]})]})]})})}function ea({email:s,onClick:t,onUnlink:a,className:n}){return e.jsxs("div",{"data-testid":"email-card",className:z("group flex items-start gap-3 rounded-lg border bg-card p-3 transition-colors hover:bg-accent/50",t&&"cursor-pointer",!s.isRead&&"border-l-2 border-l-primary",n),onClick:()=>t?.(s),children:[e.jsx("div",{className:"mt-0.5 flex size-8 shrink-0 items-center justify-center rounded-full bg-primary/10",children:e.jsx(X,{className:"size-4 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:z("truncate text-sm",!s.isRead&&"font-semibold"),children:s.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.from.name||s.from.email})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[s.hasAttachments&&e.jsx(jt,{className:"size-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:sa(s.date)}),a&&e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:l=>l.stopPropagation(),children:e.jsx(ve,{className:"size-4"})})}),e.jsx(xe,{align:"end",children:e.jsxs(Y,{className:"text-destructive focus:text-destructive",onClick:l=>{l.stopPropagation(),a(s)},children:[e.jsx(Re,{className:"mr-2 size-4"}),"Unlink"]})})]})]})]}),e.jsx("p",{className:"mt-1 line-clamp-2 text-xs text-muted-foreground",children:s.snippet})]})]})}function sa(s){const a=new Date().getTime()-s.getTime(),n=Math.floor(a/(1e3*60*60*24));return n===0?s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):n===1?"Yesterday":n<7?s.toLocaleDateString([],{weekday:"short"}):s.toLocaleDateString([],{month:"short",day:"numeric"})}function ta({event:s,onClick:t,onUnlink:a,className:n}){const l=s.endTime<new Date,i=aa(s.startTime,new Date);return e.jsxs("div",{"data-testid":"calendar-event-card",className:z("group flex items-start gap-3 rounded-lg border bg-card p-3 transition-colors hover:bg-accent/50",t&&"cursor-pointer",l&&"opacity-60",n),onClick:()=>t?.(s),children:[e.jsxs("div",{className:z("flex size-12 shrink-0 flex-col items-center justify-center rounded-lg",i?"bg-primary text-primary-foreground":"bg-muted"),children:[e.jsx("span",{className:"text-[10px] font-medium uppercase",children:s.startTime.toLocaleDateString([],{weekday:"short"})}),e.jsx("span",{className:"text-lg font-bold",children:s.startTime.getDate()})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-medium leading-tight",children:s.title}),a&&e.jsxs(ue,{children:[e.jsx(he,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:r=>r.stopPropagation(),children:e.jsx(ve,{className:"size-4"})})}),e.jsx(xe,{align:"end",children:e.jsxs(Y,{className:"text-destructive focus:text-destructive",onClick:r=>{r.stopPropagation(),a(s)},children:[e.jsx(Re,{className:"mr-2 size-4"}),"Unlink"]})})]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(oe,{className:"size-3"}),e.jsx("span",{children:s.isAllDay?"All day":`${_e(s.startTime)} - ${_e(s.endTime)}`})]}),s.location&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(xt,{className:"size-3"}),e.jsx("span",{className:"truncate",children:s.location})]}),s.meetingLink&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-primary",children:[e.jsx(kt,{className:"size-3"}),e.jsx("span",{children:"Video meeting"})]}),s.attendees.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(Ws,{className:"size-3 text-muted-foreground"}),e.jsxs("div",{className:"flex items-center gap-1",children:[s.attendees.slice(0,3).map((r,c)=>e.jsx(I,{variant:r.status==="accepted"?"default":r.status==="declined"?"destructive":"secondary",className:"text-[10px] px-1.5 py-0",children:r.name.split(" ")[0]},r.email)),s.attendees.length>3&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.attendees.length-3]})]})]})]})]})}function _e(s){return s.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function aa(s,t){return s.getFullYear()===t.getFullYear()&&s.getMonth()===t.getMonth()&&s.getDate()===t.getDate()}function ia({emails:s,calendarEvents:t,onEmailClick:a,onEventClick:n,onUnlinkEmail:l,onUnlinkEvent:i,onLinkEmail:r,onLinkEvent:c,className:m}){const[p,d]=x.useState("emails"),h=s.length+t.length;return e.jsxs("div",{className:z("space-y-4",m),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Communications"}),e.jsx(I,{variant:"secondary",className:"text-xs",children:h})]})}),e.jsxs(Ae,{value:p,onValueChange:j=>d(j),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ke,{children:[e.jsxs(J,{value:"emails",className:"gap-1",children:[e.jsx(X,{className:"size-3"}),"Emails",s.length>0&&e.jsx(I,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:s.length})]}),e.jsxs(J,{value:"calendar",className:"gap-1",children:[e.jsx(B,{className:"size-3"}),"Calendar",t.length>0&&e.jsx(I,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:t.length})]})]}),p==="emails"&&r&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx(U,{className:"mr-1 size-3"}),"Link Email"]}),p==="calendar"&&c&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:c,children:[e.jsx(U,{className:"mr-1 size-3"}),"Link Event"]})]}),e.jsx(Z,{value:"emails",className:"mt-4",children:s.length>0?e.jsx("div",{className:"space-y-2",children:s.map(j=>e.jsx(ea,{email:j,onClick:a,onUnlink:l},j.id))}):e.jsx(Ee,{icon:e.jsx(X,{className:"size-8"}),message:"No linked emails",action:r&&e.jsxs(u,{variant:"outline",size:"sm",onClick:r,children:[e.jsx(U,{className:"mr-1 size-3"}),"Link an email"]})})}),e.jsx(Z,{value:"calendar",className:"mt-4",children:t.length>0?e.jsx("div",{className:"space-y-2",children:t.map(j=>e.jsx(ta,{event:j,onClick:n,onUnlink:i},j.id))}):e.jsx(Ee,{icon:e.jsx(B,{className:"size-8"}),message:"No linked calendar events",action:c&&e.jsxs(u,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(U,{className:"mr-1 size-3"}),"Link an event"]})})})]})]})}function Ee({icon:s,message:t,action:a}){return e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx("div",{className:"mx-auto text-muted-foreground/50",children:s}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t}),a&&e.jsx("div",{className:"mt-3",children:a})]})}function La(){const{id:s}=Ns(),t=s??"",a=V(),l=zs()?.participants??[],{data:i,isLoading:r,error:c}=ys(t),{data:m,isLoading:p}=Ct(t),{data:d,isLoading:h}=wt(t),j=zt(),v=Dt(),D=St(),[y,N]=x.useState(!1),[f,C]=x.useState(null),[M,b]=x.useState(!1),{deleteItem:P,isDeleting:g,undoState:k,dismissUndo:S}=bs({onDeleted:()=>{window.location.href="/app/work-items"}}),w=i?(()=>{const o=[];return i.dependencies?.blocks&&o.push(...i.dependencies.blocks.map(E=>({id:E.id,title:E.title,kind:"issue",status:"not_started",direction:"blocks"}))),i.dependencies?.blocked_by&&o.push(...i.dependencies.blocked_by.map(E=>({id:E.id,title:E.title,kind:"issue",status:"not_started",direction:"blocked_by"}))),{id:i.id,title:i.title,kind:i.kind||"issue",status:i.status||"not_started",priority:Ds(i.priority),description:i.description||void 0,parentId:i.parent_id||void 0,parentTitle:i.parent?.title,estimateMinutes:i.estimate_minutes||void 0,actualMinutes:i.actual_minutes||void 0,dueDate:i.not_after?new Date(i.not_after):void 0,startDate:i.not_before?new Date(i.not_before):void 0,createdAt:new Date(i.created_at),updatedAt:new Date(i.updated_at),todos:[],attachments:[],dependencies:o}})():null,Q=(m?.memories??[]).map(o=>({id:o.id,title:o.title,content:o.content,linkedItemId:t,linkedItemTitle:w?.title||void 0,linkedItemKind:w?.kind||"issue",createdAt:new Date(o.created_at),updatedAt:new Date(o.updated_at)})),H=(d?.emails??[]).map(o=>({id:o.id,subject:"Email",from:{name:"Unknown",email:""},to:[],date:o.received_at?new Date(o.received_at):new Date,snippet:o.body?.substring(0,100)||"",body:o.body||void 0})),ne=(d?.calendar_events??[]).map(o=>({id:o.id,title:"Calendar Event",startTime:o.received_at?new Date(o.received_at):new Date,endTime:o.received_at?new Date(o.received_at):new Date,attendees:[]})),T=x.useCallback(o=>{j.mutate({id:t,body:o})},[t,j]),re=o=>T({title:o}),Ye=o=>T({description:o}),Xe=o=>T({status:o}),Je=o=>T({priority:Ss(o)}),Ze=o=>T({notAfter:o||null}),es=o=>T({notBefore:o||null}),ss=o=>{const E=parseInt(o,10);T({estimateMinutes:isNaN(E)?null:E})},ts=o=>{const E=parseInt(o,10);T({actualMinutes:isNaN(E)?null:E})},as=()=>{w?.parentId&&(window.location.href=`/app/work-items/${w.parentId}`)},is=o=>{window.location.href=`/app/work-items/${o.id}`},ns=()=>{C(null),N(!0)},rs=o=>{C(o),N(!0)},cs=o=>{v.mutate({workItemId:t,body:{title:o.title,content:o.content,type:"note"}},{onSuccess:()=>N(!1)})},ls=o=>{f&&D.mutate({id:f.id,body:{title:o.title,content:o.content},workItemId:t},{onSuccess:()=>{N(!1),C(null)}})},os=async o=>{if(confirm(`Delete memory "${o.title}"?`))try{await A.delete(`/api/memories/${o.id}`),a.invalidateQueries({queryKey:L.forWorkItem(t)})}catch{}},ds=async o=>{if(confirm("Unlink this email from the work item?"))try{await A.delete(`/api/work-items/${t}/communications/${o.id}`),a.invalidateQueries({queryKey:ee.forWorkItem(t)})}catch{}},ms=async o=>{if(confirm("Unlink this event from the work item?"))try{await A.delete(`/api/work-items/${t}/communications/${o.id}`),a.invalidateQueries({queryKey:ee.forWorkItem(t)})}catch{}},us=()=>b(!0),hs=async()=>{w&&(await P({id:w.id,title:w.title}),b(!1))};return r?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(Ms,{})}):c||!w?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(ws,{title:"Work Item Not Found",message:c instanceof Error?c.message:"The requested work item could not be loaded.",action:e.jsx(u,{variant:"outline",asChild:!0,children:e.jsx(G,{to:"/work-items",children:"Back to Work Items"})})})}):e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b flex items-center gap-4",children:[e.jsx(u,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(G,{to:"/work-items",children:[e.jsx(Le,{className:"mr-1 size-4 rotate-180"}),"Back"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(G,{to:`/work-items/${t}/timeline`,children:[e.jsx(B,{className:"mr-2 size-4"}),"Timeline"]})}),e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(G,{to:`/work-items/${t}/graph`,children:[e.jsx(Ys,{className:"mr-2 size-4"}),"Dependencies"]})})]})]}),e.jsx(Gt,{item:w,onTitleChange:re,onDescriptionChange:Ye,onStatusChange:Xe,onPriorityChange:Je,onDueDateChange:Ze,onStartDateChange:es,onEstimateChange:ss,onActualChange:ts,onParentClick:as,onDependencyClick:is,onDelete:us,className:"flex-1"}),e.jsxs("div",{className:"p-6 space-y-6 border-t",children:[e.jsxs($,{children:[e.jsx(ce,{children:e.jsx(le,{className:"text-lg",children:"Memories"})}),e.jsx(q,{children:p?e.jsx(Ce,{width:"100%",height:100}):e.jsx(Jt,{memories:Q,onAddMemory:ns,onEditMemory:rs,onDeleteMemory:os})})]}),e.jsx(Zt,{memory:f||void 0,open:y,onOpenChange:N,onSubmit:f?ls:cs}),e.jsxs($,{children:[e.jsx(ce,{children:e.jsx(le,{className:"text-lg",children:"Communications"})}),e.jsx(q,{children:h?e.jsx(Ce,{width:"100%",height:100}):e.jsx(ia,{emails:H,calendarEvents:ne,onUnlinkEmail:ds,onUnlinkEvent:ms})})]}),e.jsxs($,{children:[e.jsx(ce,{children:e.jsx(le,{className:"text-lg",children:"Participants"})}),e.jsx(q,{children:l.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No participants assigned"}):e.jsx("ul",{className:"space-y-2",children:l.map((o,E)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:(o.participant??"U")[0].toUpperCase()})}),e.jsx("span",{className:"text-sm",children:o.participant??"Unknown"}),o.role&&e.jsx(I,{variant:"outline",className:"text-xs",children:o.role})]},E))})})]})]}),e.jsx(ks,{open:M,onOpenChange:b,item:w?{id:w.id,title:w.title,kind:w.kind,childCount:0}:void 0,onConfirm:hs,isDeleting:g}),k&&e.jsx(Cs,{visible:!!k,itemTitle:k.itemTitle,onUndo:k.onUndo,onDismiss:S})]})}export{La as WorkItemDetailPage};
//# sourceMappingURL=WorkItemDetailPage-BdZEb73z.js.map
