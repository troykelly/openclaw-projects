import{S as $t,s as At,h as Me,g as Lt,n as qe,b as se,r as u,c as Rt,d as Ut,j as e,e as Kt,L as ne}from"./index-ro4a9Q5M.js";import{w as q,b as qt}from"./use-work-items-d_fseGMd.js";import{m as J,E as fe,u as Ot}from"./use-memories-C180MWXS.js";import{u as Vt}from"./useQuery-BM5zrqpQ.js";import{a as B}from"./api-client-CDvRtWmo.js";import{u as Bt,A as Ie}from"./use-activity-MnyqfU60.js";import{r as Ft,b as Wt,c as Qt}from"./work-item-utils-RZsWa1qH.js";import{S as Q,c as Ee,C as A,b as L,a as Gt,d as xe,e as he}from"./card-BHiA1sJf.js";import{C as Pe,E as Ht}from"./error-state-DkcG1FHk.js";import{c as E,a as z,d as Yt,B as x,u as Oe}from"./button-DA_iHpNz.js";import{B as T}from"./badge-CgqI5a1N.js";import{u as Xt,P as F,c as X,a as Ve}from"./index-BsPYePJp.js";import{R as Jt,I as Zt,d as Be,P as oe,T as ge,L as je,D as ve,a as Ne,b as be,c as re}from"./dropdown-menu-CgTRuYiy.js";import{P as Fe,S as es}from"./scroll-area-B9Z_l3ta.js";import{a as We,u as ts,d as ss}from"./index--BKWNYFM.js";import{I as G}from"./input-DRi0tmhn.js";import{C as Qe}from"./chevron-right-_RLGKu2-.js";import{C as de,S as as,a as is,b as ns,c as rs,d as cs,u as ls}from"./select-C5zmbRBn.js";import{X as ye,D as os,a as ds,b as ms,c as us,d as xs,e as hs}from"./dialog-D0wxGEH5.js";import{F as ae,U as Ge}from"./users-U5fKQJzS.js";import{T as ke,G as ps,u as fs,D as gs,U as js}from"./use-work-item-delete-Bqt0Yr1w.js";import{F as Ce}from"./folder-vadNIucA.js";import{U as vs}from"./user-mXQ37VVs.js";import{C as Z}from"./calendar-CQ44GTMm.js";import{C as ee}from"./clock-BRi0TMPG.js";import{T as He}from"./textarea-DMeENQaF.js";import{E as Ye}from"./eye-DeDrgsi4.js";import{P as te}from"./plus-CQqLjOLW.js";import{A as Ns}from"./arrow-right-CBkgDz4p.js";import{L as V}from"./link-2-7Hnjxb7v.js";import{L as bs}from"./list-rNJji2Jg.js";import{M as ce}from"./mail-DTRndT3i.js";import{N as ys}from"./network-BzJUMjGw.js";import{B as ks}from"./brain-s4a1F55W.js";var Cs=class extends $t{#t;#a=void 0;#e;#s;constructor(t,s){super(),this.#t=t,this.setOptions(s),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#t.defaultMutationOptions(t),At(this.options,s)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),s?.mutationKey&&this.options.mutationKey&&Me(s.mutationKey)!==Me(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#a}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#n()}mutate(t,s){return this.#s=s,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(t)}#i(){const t=this.#e?.state??Lt();this.#a={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){qe.batch(()=>{if(this.#s&&this.hasListeners()){const s=this.#a.variables,a=this.#a.context,i={client:this.#t,meta:this.options.meta,mutationKey:this.options.mutationKey};if(t?.type==="success"){try{this.#s.onSuccess?.(t.data,s,a,i)}catch(r){Promise.reject(r)}try{this.#s.onSettled?.(t.data,null,s,a,i)}catch(r){Promise.reject(r)}}else if(t?.type==="error"){try{this.#s.onError?.(t.error,s,a,i)}catch(r){Promise.reject(r)}try{this.#s.onSettled?.(void 0,t.error,s,a,i)}catch(r){Promise.reject(r)}}}this.listeners.forEach(s=>{s(this.#a)})})}};function we(t,s){const a=se(),[i]=u.useState(()=>new Cs(a,t));u.useEffect(()=>{i.setOptions(t)},[i,t]);const r=u.useSyncExternalStore(u.useCallback(c=>i.subscribe(qe.batchCalls(c)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),n=u.useCallback((c,o)=>{i.mutate(c,o).catch(Rt)},[i]);if(r.error&&Ut(i.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:n,mutateAsync:r.mutate}}const ws=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],zs=E("arrow-left",ws);const Ds=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],Ss=E("bold",Ds);const _s=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],Ts=E("code",_s);const Ms=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],Is=E("git-branch",Ms);const Es=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],Ps=E("italic",Es);const $s=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],As=E("list-ordered",$s);const Ls=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Rs=E("map-pin",Ls);const Us=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],Ks=E("paperclip",Us);const qs=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Os=E("pen-line",qs);const Vs=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Bs=E("pen",Vs);const Fs=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Ws=E("square-check-big",Fs);const Qs=[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]],Xe=E("unlink",Qs);const Gs=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Hs=E("video",Gs),le={all:["communications"],forWorkItem:t=>[...le.all,"work-item",t]};function Ys(t){return Vt({queryKey:le.forWorkItem(t),queryFn:({signal:s})=>B.get(`/api/work-items/${t}/communications`,{signal:s}),enabled:!!t})}function Xs(){const t=se();return we({mutationFn:({id:s,body:a})=>B.put(`/api/work-items/${s}`,a),onMutate:async({id:s,body:a})=>{await t.cancelQueries({queryKey:q.detail(s)});const i=t.getQueryData(q.detail(s));if(i){const r={...i,...a.title!==void 0?{title:a.title}:{},...a.status!==void 0?{status:a.status}:{},...a.priority!==void 0?{priority:a.priority}:{},...a.description!==void 0?{description:a.description}:{}};t.setQueryData(q.detail(s),r)}return{previousDetail:i}},onError:(s,{id:a},i)=>{i?.previousDetail&&t.setQueryData(q.detail(a),i.previousDetail)},onSettled:(s,a,{id:i})=>{t.invalidateQueries({queryKey:q.detail(i)}),t.invalidateQueries({queryKey:q.lists()}),t.invalidateQueries({queryKey:q.tree()})}})}function Js(){const t=se();return we({mutationFn:({workItemId:s,body:a})=>B.post(`/api/work-items/${s}/memories`,a),onSuccess:(s,{workItemId:a})=>{t.invalidateQueries({queryKey:J.forWorkItem(a)}),t.invalidateQueries({queryKey:J.lists()})}})}function Zs(){const t=se();return we({mutationFn:({id:s,body:a})=>B.patch(`/api/memories/${s}`,a),onSuccess:(s,{workItemId:a})=>{t.invalidateQueries({queryKey:J.lists()}),a&&t.invalidateQueries({queryKey:J.forWorkItem(a)})}})}var me="Tabs",[ea]=Ve(me,[Be]),Je=Be(),[ta,ze]=ea(me),Ze=u.forwardRef((t,s)=>{const{__scopeTabs:a,value:i,onValueChange:r,defaultValue:n,orientation:c="horizontal",dir:o,activationMode:h="automatic",...p}=t,d=Xt(o),[m,f]=We({prop:i,onChange:r,defaultProp:n??"",caller:me});return e.jsx(ta,{scope:a,baseId:ts(),value:m,onValueChange:f,orientation:c,dir:d,activationMode:h,children:e.jsx(F.div,{dir:d,"data-orientation":c,...p,ref:s})})});Ze.displayName=me;var et="TabsList",tt=u.forwardRef((t,s)=>{const{__scopeTabs:a,loop:i=!0,...r}=t,n=ze(et,a),c=Je(a);return e.jsx(Jt,{asChild:!0,...c,orientation:n.orientation,dir:n.dir,loop:i,children:e.jsx(F.div,{role:"tablist","aria-orientation":n.orientation,...r,ref:s})})});tt.displayName=et;var st="TabsTrigger",at=u.forwardRef((t,s)=>{const{__scopeTabs:a,value:i,disabled:r=!1,...n}=t,c=ze(st,a),o=Je(a),h=rt(c.baseId,i),p=ct(c.baseId,i),d=i===c.value;return e.jsx(Zt,{asChild:!0,...o,focusable:!r,active:d,children:e.jsx(F.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":p,"data-state":d?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:h,...n,ref:s,onMouseDown:X(t.onMouseDown,m=>{!r&&m.button===0&&m.ctrlKey===!1?c.onValueChange(i):m.preventDefault()}),onKeyDown:X(t.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&c.onValueChange(i)}),onFocus:X(t.onFocus,()=>{const m=c.activationMode!=="manual";!d&&!r&&m&&c.onValueChange(i)})})})});at.displayName=st;var it="TabsContent",nt=u.forwardRef((t,s)=>{const{__scopeTabs:a,value:i,forceMount:r,children:n,...c}=t,o=ze(it,a),h=rt(o.baseId,i),p=ct(o.baseId,i),d=i===o.value,m=u.useRef(d);return u.useEffect(()=>{const f=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(f)},[]),e.jsx(Fe,{present:r||d,children:({present:f})=>e.jsx(F.div,{"data-state":d?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":h,hidden:!f,id:p,tabIndex:0,...c,ref:s,style:{...t.style,animationDuration:m.current?"0s":void 0},children:f&&n})})});nt.displayName=it;function rt(t,s){return`${t}-trigger-${s}`}function ct(t,s){return`${t}-content-${s}`}var sa=Ze,aa=tt,ia=at,na=nt;function De({className:t,orientation:s="horizontal",...a}){return e.jsx(sa,{"data-slot":"tabs","data-orientation":s,orientation:s,className:z("group/tabs flex gap-2 data-[orientation=horizontal]:flex-col",t),...a})}const ra=Yt("rounded-lg p-[3px] group-data-[orientation=horizontal]/tabs:h-9 data-[variant=line]:rounded-none group/tabs-list text-muted-foreground inline-flex w-fit items-center justify-center group-data-[orientation=vertical]/tabs:h-fit group-data-[orientation=vertical]/tabs:flex-col",{variants:{variant:{default:"bg-muted",line:"gap-1 bg-transparent"}},defaultVariants:{variant:"default"}});function Se({className:t,variant:s="default",...a}){return e.jsx(aa,{"data-slot":"tabs-list","data-variant":s,className:z(ra({variant:s}),t),...a})}function R({className:t,...s}){return e.jsx(ia,{"data-slot":"tabs-trigger",className:z("focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring text-foreground/60 hover:text-foreground dark:text-muted-foreground dark:hover:text-foreground relative inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-all group-data-[orientation=vertical]/tabs:w-full group-data-[orientation=vertical]/tabs:justify-start focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 group-data-[variant=default]/tabs-list:data-[state=active]:shadow-sm group-data-[variant=line]/tabs-list:data-[state=active]:shadow-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4","group-data-[variant=line]/tabs-list:bg-transparent group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:border-transparent dark:group-data-[variant=line]/tabs-list:data-[state=active]:bg-transparent","data-[state=active]:bg-background dark:data-[state=active]:text-foreground dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 data-[state=active]:text-foreground","after:bg-foreground after:absolute after:opacity-0 after:transition-opacity group-data-[orientation=horizontal]/tabs:after:inset-x-0 group-data-[orientation=horizontal]/tabs:after:bottom-[-5px] group-data-[orientation=horizontal]/tabs:after:h-0.5 group-data-[orientation=vertical]/tabs:after:inset-y-0 group-data-[orientation=vertical]/tabs:after:-right-1 group-data-[orientation=vertical]/tabs:after:w-0.5 group-data-[variant=line]/tabs-list:data-[state=active]:after:opacity-100",t),...s})}function U({className:t,...s}){return e.jsx(na,{"data-slot":"tabs-content",className:z("flex-1 outline-none",t),...s})}function ca(t){switch(t){case"project":return e.jsx(Ce,{className:"size-5"});case"initiative":return e.jsx(ke,{className:"size-5"});case"epic":return e.jsx(je,{className:"size-5"});case"issue":return e.jsx(ae,{className:"size-5"})}}function la(t){return t.charAt(0).toUpperCase()+t.slice(1)}function oa(t){switch(t){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function da(t){return t.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())}function ma({title:t,kind:s,status:a,parentTitle:i,onTitleChange:r,onParentClick:n,onDelete:c,className:o}){const[h,p]=u.useState(!1),[d,m]=u.useState(t),f=()=>{m(t),p(!0)},N=()=>{d.trim()&&d!==t&&r?.(d.trim()),p(!1)},D=()=>{m(t),p(!1)},k=b=>{b.key==="Enter"?N():b.key==="Escape"&&D()};return e.jsxs("div",{className:z("space-y-2",o),children:[i&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("button",{className:"hover:text-foreground hover:underline",onClick:n,children:i}),e.jsx(Qe,{className:"size-4"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 text-muted-foreground",children:ca(s)}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-2",children:[h?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{value:d,onChange:b=>m(b.target.value),onKeyDown:k,autoFocus:!0,className:"text-xl font-semibold"}),e.jsxs(x,{variant:"ghost",size:"icon",onClick:N,children:[e.jsx(de,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Save"})]}),e.jsxs(x,{variant:"ghost",size:"icon",onClick:D,children:[e.jsx(ye,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Cancel"})]})]}):e.jsxs("div",{className:"group flex items-start gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold",children:t}),r&&e.jsxs(x,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 group-hover:opacity-100",onClick:f,children:[e.jsx(oe,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Edit title"})]}),c&&e.jsxs(x,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 text-destructive hover:text-destructive group-hover:opacity-100",onClick:c,children:[e.jsx(ge,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(T,{variant:"outline",children:la(s)}),e.jsx(T,{variant:oa(a),children:da(a)})]})]})]})]})}function $e(t){return t?t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"Not set"}function Ae(t){if(!t)return"Not set";if(t<60)return`${t}m`;const s=Math.floor(t/60),a=t%60;return a>0?`${s}h ${a}m`:`${s}h`}function O({icon:t,label:s,value:a,editable:i,onEdit:r,editType:n="text",options:c}){const[o,h]=u.useState(!1),[p,d]=u.useState(a),m=()=>{r?.(p),h(!1)},f=()=>{d(a),h(!1)};return e.jsxs("div",{className:"flex items-start gap-3 rounded-md p-2 hover:bg-muted/50",children:[e.jsx("span",{className:"mt-0.5 text-muted-foreground",children:t}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:s}),o?e.jsxs("div",{className:"mt-1 flex items-center gap-1",children:[n==="select"&&c?e.jsxs(as,{value:p,onValueChange:d,children:[e.jsx(is,{className:"h-8 text-sm",children:e.jsx(ns,{})}),e.jsx(rs,{children:c.map(N=>e.jsx(cs,{value:N.value,children:N.label},N.value))})]}):n==="date"?e.jsx(G,{type:"date",value:p,onChange:N=>d(N.target.value),className:"h-8 text-sm"}):e.jsx(G,{type:n==="number"?"number":"text",value:p,onChange:N=>d(N.target.value),className:"h-8 text-sm"}),e.jsx(x,{variant:"ghost",size:"icon",className:"size-6",onClick:m,children:e.jsx(de,{className:"size-3"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"size-6",onClick:f,children:e.jsx(ye,{className:"size-3"})})]}):e.jsxs("div",{className:"group flex items-center gap-1",children:[e.jsx("p",{className:"text-sm",children:a}),i&&r&&e.jsx(x,{variant:"ghost",size:"icon",className:"size-5 opacity-0 group-hover:opacity-100",onClick:()=>h(!0),children:e.jsx(oe,{className:"size-3"})})]})]})]})}const Le=[{value:"not_started",label:"Not Started"},{value:"in_progress",label:"In Progress"},{value:"blocked",label:"Blocked"},{value:"done",label:"Done"},{value:"cancelled",label:"Cancelled"}],Re=[{value:"urgent",label:"Urgent"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}];function ua({status:t,priority:s,assignee:a,dueDate:i,startDate:r,estimateMinutes:n,actualMinutes:c,onStatusChange:o,onPriorityChange:h,onAssigneeChange:p,onDueDateChange:d,onStartDateChange:m,onEstimateChange:f,onActualChange:N,className:D}){const k=v=>Re.find(C=>C.value===v)?.label??v,b=v=>Le.find(C=>C.value===v)?.label??v;return e.jsxs("div",{className:z("grid gap-1 sm:grid-cols-2",D),children:[e.jsx(O,{icon:e.jsx(Pe,{className:"size-4"}),label:"Status",value:b(t),editable:!!o,onEdit:v=>o?.(v),editType:"select",options:Le}),e.jsx(O,{icon:e.jsx(Pe,{className:"size-4"}),label:"Priority",value:k(s),editable:!!h,onEdit:v=>h?.(v),editType:"select",options:Re}),e.jsx(O,{icon:e.jsx(vs,{className:"size-4"}),label:"Assignee",value:a||"Unassigned",editable:!!p,onEdit:p}),e.jsx(O,{icon:e.jsx(Z,{className:"size-4"}),label:"Due Date",value:$e(i),editable:!!d,onEdit:d,editType:"date"}),e.jsx(O,{icon:e.jsx(Z,{className:"size-4"}),label:"Start Date",value:$e(r),editable:!!m,onEdit:m,editType:"date"}),e.jsx(O,{icon:e.jsx(ee,{className:"size-4"}),label:"Estimate",value:Ae(n),editable:!!f,onEdit:f,editType:"number"}),e.jsx(O,{icon:e.jsx(ee,{className:"size-4"}),label:"Actual",value:Ae(c),editable:!!N,onEdit:N,editType:"number"})]})}function xa({description:t,onDescriptionChange:s,className:a}){const[i,r]=u.useState(!1),[n,c]=u.useState(t||""),[o,h]=u.useState(!1),p=()=>{c(t||""),r(!0),h(!1)},d=()=>{s?.(n),r(!1)},m=()=>{c(t||""),r(!1),h(!1)},f=N=>N?N.split(`
`).map((k,b)=>{if(k.startsWith("### "))return e.jsx("h4",{className:"mt-4 mb-2 text-sm font-semibold",children:k.slice(4)},b);if(k.startsWith("## "))return e.jsx("h3",{className:"mt-4 mb-2 font-semibold",children:k.slice(3)},b);if(k.startsWith("# "))return e.jsx("h2",{className:"mt-4 mb-2 text-lg font-semibold",children:k.slice(2)},b);if(k.startsWith("- ")||k.startsWith("* "))return e.jsx("li",{className:"ml-4",children:k.slice(2)},b);if(!k.trim())return e.jsx("br",{},b);const v=C=>{const _=[];let y=C,P=0;for(;y.length>0;){const g=y.match(/^`([^`]+)`/);if(g){_.push(e.jsx("code",{className:"rounded bg-muted px-1 text-sm",children:g[1]},P++)),y=y.slice(g[0].length);continue}const w=y.match(/^\*\*([^*]+)\*\*/);if(w){_.push(e.jsx("strong",{children:w[1]},P++)),y=y.slice(w[0].length);continue}const S=y.match(/^\*([^*]+)\*/);if(S){_.push(e.jsx("em",{children:S[1]},P++)),y=y.slice(S[0].length);continue}const M=y.search(/[`*]/);if(M===-1){_.push(y);break}else M===0?(_.push(y[0]),y=y.slice(1)):(_.push(y.slice(0,M)),y=y.slice(M))}return _};return e.jsx("p",{className:"my-1",children:v(k)},b)}):null;return e.jsxs("div",{className:z("space-y-3",a),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Description"}),!i&&s&&e.jsxs(x,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:p,children:[e.jsx(oe,{className:"size-3"}),"Edit"]}),i&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(x,{variant:"ghost",size:"sm",className:z("h-7 gap-1",!o&&"bg-muted"),onClick:()=>h(!1),children:[e.jsx(Bs,{className:"size-3"}),"Edit"]}),e.jsxs(x,{variant:"ghost",size:"sm",className:z("h-7 gap-1",o&&"bg-muted"),onClick:()=>h(!0),children:[e.jsx(Ye,{className:"size-3"}),"Preview"]})]})]}),i?e.jsxs("div",{className:"space-y-3",children:[o?e.jsx("div",{className:"min-h-32 rounded-md border bg-muted/30 p-3 text-sm",children:n?f(n):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})}):e.jsx(He,{value:n,onChange:N=>c(N.target.value),placeholder:"Add a description... (Markdown supported)",className:"min-h-32 font-mono text-sm"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(x,{variant:"ghost",size:"sm",onClick:m,children:[e.jsx(ye,{className:"mr-1 size-3"}),"Cancel"]}),e.jsxs(x,{size:"sm",onClick:d,children:[e.jsx(de,{className:"mr-1 size-3"}),"Save"]})]})]}):t?e.jsx("div",{className:"prose prose-sm max-w-none rounded-md bg-muted/30 p-3",children:f(t)}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No description"})]})}var ue="Checkbox",[ha]=Ve(ue),[pa,_e]=ha(ue);function fa(t){const{__scopeCheckbox:s,checked:a,children:i,defaultChecked:r,disabled:n,form:c,name:o,onCheckedChange:h,required:p,value:d="on",internal_do_not_use_render:m}=t,[f,N]=We({prop:a,defaultProp:r??!1,onChange:h,caller:ue}),[D,k]=u.useState(null),[b,v]=u.useState(null),C=u.useRef(!1),_=D?!!c||!!D.closest("form"):!0,y={checked:f,disabled:n,setChecked:N,control:D,setControl:k,name:o,form:c,value:d,hasConsumerStoppedPropagationRef:C,required:p,defaultChecked:K(r)?!1:r,isFormControl:_,bubbleInput:b,setBubbleInput:v};return e.jsx(pa,{scope:s,...y,children:ga(m)?m(y):i})}var lt="CheckboxTrigger",ot=u.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:a,...i},r)=>{const{control:n,value:c,disabled:o,checked:h,required:p,setControl:d,setChecked:m,hasConsumerStoppedPropagationRef:f,isFormControl:N,bubbleInput:D}=_e(lt,t),k=Oe(r,d),b=u.useRef(h);return u.useEffect(()=>{const v=n?.form;if(v){const C=()=>m(b.current);return v.addEventListener("reset",C),()=>v.removeEventListener("reset",C)}},[n,m]),e.jsx(F.button,{type:"button",role:"checkbox","aria-checked":K(h)?"mixed":h,"aria-required":p,"data-state":pt(h),"data-disabled":o?"":void 0,disabled:o,value:c,...i,ref:k,onKeyDown:X(s,v=>{v.key==="Enter"&&v.preventDefault()}),onClick:X(a,v=>{m(C=>K(C)?!0:!C),D&&N&&(f.current=v.isPropagationStopped(),f.current||v.stopPropagation())})})});ot.displayName=lt;var dt=u.forwardRef((t,s)=>{const{__scopeCheckbox:a,name:i,checked:r,defaultChecked:n,required:c,disabled:o,value:h,onCheckedChange:p,form:d,...m}=t;return e.jsx(fa,{__scopeCheckbox:a,checked:r,defaultChecked:n,disabled:o,required:c,onCheckedChange:p,name:i,form:d,value:h,internal_do_not_use_render:({isFormControl:f})=>e.jsxs(e.Fragment,{children:[e.jsx(ot,{...m,ref:s,__scopeCheckbox:a}),f&&e.jsx(ht,{__scopeCheckbox:a})]})})});dt.displayName=ue;var mt="CheckboxIndicator",ut=u.forwardRef((t,s)=>{const{__scopeCheckbox:a,forceMount:i,...r}=t,n=_e(mt,a);return e.jsx(Fe,{present:i||K(n.checked)||n.checked===!0,children:e.jsx(F.span,{"data-state":pt(n.checked),"data-disabled":n.disabled?"":void 0,...r,ref:s,style:{pointerEvents:"none",...t.style}})})});ut.displayName=mt;var xt="CheckboxBubbleInput",ht=u.forwardRef(({__scopeCheckbox:t,...s},a)=>{const{control:i,hasConsumerStoppedPropagationRef:r,checked:n,defaultChecked:c,required:o,disabled:h,name:p,value:d,form:m,bubbleInput:f,setBubbleInput:N}=_e(xt,t),D=Oe(a,N),k=ls(n),b=ss(i);u.useEffect(()=>{const C=f;if(!C)return;const _=window.HTMLInputElement.prototype,P=Object.getOwnPropertyDescriptor(_,"checked").set,g=!r.current;if(k!==n&&P){const w=new Event("click",{bubbles:g});C.indeterminate=K(n),P.call(C,K(n)?!1:n),C.dispatchEvent(w)}},[f,k,n,r]);const v=u.useRef(K(n)?!1:n);return e.jsx(F.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??v.current,required:o,disabled:h,name:p,value:d,form:m,...s,tabIndex:-1,ref:D,style:{...s.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});ht.displayName=xt;function ga(t){return typeof t=="function"}function K(t){return t==="indeterminate"}function pt(t){return K(t)?"indeterminate":t?"checked":"unchecked"}function ja({className:t,...s}){return e.jsx(dt,{"data-slot":"checkbox",className:z("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(ut,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:e.jsx(de,{className:"size-3.5"})})})}function va({todos:t,onAdd:s,onToggle:a,onDelete:i,className:r}){const[n,c]=u.useState(""),o=()=>{n.trim()&&s&&(s(n.trim()),c(""))},h=d=>{d.key==="Enter"&&o()},p=t.filter(d=>d.completed).length;return e.jsxs("div",{className:z("space-y-3",r),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Checklist"}),t.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[p,"/",t.length," completed"]})]}),t.length>0&&e.jsx("div",{className:"h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${p/t.length*100}%`}})}),e.jsx("div",{className:"space-y-1",children:t.map(d=>e.jsxs("div",{"data-testid":"todo-item",className:z("group flex items-center gap-2 rounded-md px-2 py-1.5","hover:bg-muted/50"),children:[e.jsx(ps,{className:"size-4 cursor-grab text-muted-foreground opacity-0 group-hover:opacity-100"}),e.jsx(ja,{checked:d.completed,onCheckedChange:m=>a?.(d.id,m===!0),"aria-label":`Mark "${d.text}" as ${d.completed?"incomplete":"complete"}`}),e.jsx("span",{className:z("flex-1 text-sm",d.completed&&"text-muted-foreground line-through"),children:d.text}),i&&e.jsxs(x,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:()=>i(d.id),children:[e.jsx(ge,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]},d.id))}),s&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"size-4 text-muted-foreground"}),e.jsx(G,{value:n,onChange:d=>c(d.target.value),onKeyDown:h,placeholder:"Add a task...",className:"h-8 flex-1"}),e.jsx(x,{variant:"ghost",size:"sm",onClick:o,disabled:!n.trim(),children:"Add"})]}),t.length===0&&!s&&e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No tasks yet"})]})}function Na(t){switch(t){case"project":return e.jsx(Ce,{className:"size-4"});case"initiative":return e.jsx(ke,{className:"size-4"});case"epic":return e.jsx(je,{className:"size-4"});case"issue":return e.jsx(ae,{className:"size-4"})}}function ba(t){switch(t){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function ya(t){return t.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase())}function ka({dependencies:t,onDependencyClick:s,onAddDependency:a,className:i}){const r=t.filter(o=>o.direction==="blocked_by"),n=t.filter(o=>o.direction==="blocks"),c=o=>e.jsxs("button",{"data-testid":"dependency-item",className:z("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",s&&"cursor-pointer"),onClick:()=>s?.(o),children:[e.jsx("span",{className:"text-muted-foreground",children:Na(o.kind)}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm",children:o.title}),e.jsx(T,{variant:ba(o.status),className:"shrink-0 text-xs",children:ya(o.status)})]},o.id);return e.jsxs("div",{className:z("space-y-4",i),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(zs,{className:"size-4"}),"Blocked by (",r.length,")"]}),a&&e.jsxs(x,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocked_by"),children:[e.jsx(te,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add blocker"})]})]}),r.length>0?e.jsx("div",{className:"space-y-1",children:r.map(c)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No blockers"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(Ns,{className:"size-4"}),"Blocks (",n.length,")"]}),a&&e.jsxs(x,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocks"),children:[e.jsx(te,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add dependent"})]})]}),n.length>0?e.jsx("div",{className:"space-y-1",children:n.map(c)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No dependents"})]})]})}function Ca(t){switch(t){case"project":return e.jsx(Ce,{className:"size-3"});case"initiative":return e.jsx(ke,{className:"size-3"});case"epic":return e.jsx(je,{className:"size-3"});case"issue":return e.jsx(ae,{className:"size-3"});default:return null}}function wa({memory:t,onClick:s,onEdit:a,onDelete:i,className:r}){const n=t.content.slice(0,150)+(t.content.length>150?"...":"");return e.jsxs("div",{"data-testid":"memory-card",className:z("group relative rounded-lg border bg-card p-4 transition-colors hover:bg-accent/50",s&&"cursor-pointer",r),onClick:()=>s?.(t),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-medium leading-tight",children:t.title}),(a||i)&&e.jsxs(ve,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:c=>c.stopPropagation(),children:e.jsx(fe,{className:"size-4"})})}),e.jsxs(be,{align:"end",children:[a&&e.jsxs(re,{onClick:c=>{c.stopPropagation(),a(t)},children:[e.jsx(oe,{className:"mr-2 size-4"}),"Edit"]}),i&&e.jsxs(re,{className:"text-destructive focus:text-destructive",onClick:c=>{c.stopPropagation(),i(t)},children:[e.jsx(ge,{className:"mr-2 size-4"}),"Delete"]})]})]})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground line-clamp-2",children:n}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.linkedItemKind&&t.linkedItemTitle&&e.jsxs("span",{className:"flex items-center gap-1",children:[Ca(t.linkedItemKind),e.jsx("span",{className:"truncate max-w-[120px]",children:t.linkedItemTitle})]})}),e.jsx("span",{children:t.updatedAt.toLocaleDateString()})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:t.tags.map(c=>e.jsx(T,{variant:"secondary",className:"text-xs",children:c},c))})]})}function za({memories:t,onMemoryClick:s,onAddMemory:a,onLinkMemory:i,onEditMemory:r,onDeleteMemory:n,className:c}){return e.jsxs("div",{className:z("space-y-4",c),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Memories"}),e.jsx(T,{variant:"secondary",className:"text-xs",children:t.length})]}),e.jsxs("div",{className:"flex gap-1",children:[i&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:i,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link"]}),a&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:a,children:[e.jsx(te,{className:"mr-1 size-3"}),"Add"]})]})]}),t.length>0?e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:t.map(o=>e.jsx(wa,{memory:o,onClick:s,onEdit:r,onDelete:n},o.id))}):e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx(ae,{className:"mx-auto size-8 text-muted-foreground/50"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"No memories attached"}),(a||i)&&e.jsxs("div",{className:"mt-3 flex justify-center gap-2",children:[a&&e.jsxs(x,{variant:"outline",size:"sm",onClick:a,children:[e.jsx(te,{className:"mr-1 size-3"}),"Create new"]}),i&&e.jsxs(x,{variant:"outline",size:"sm",onClick:i,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link existing"]})]})]})]})}function Da({memory:t,open:s,onOpenChange:a,onSubmit:i,className:r}){const[n,c]=u.useState(t?.title??""),[o,h]=u.useState(t?.content??""),[p,d]=u.useState(""),[m,f]=u.useState(t?.tags??[]),[N,D]=u.useState("edit"),k=u.useRef(null),b=u.useCallback((g,w="")=>{const S=k.current;if(!S)return;const M=S.selectionStart,ie=S.selectionEnd,j=o.slice(M,ie),H=o.slice(0,M)+g+(j||"text")+w+o.slice(ie);h(H),setTimeout(()=>{S.focus();const W=M+g.length,Y=W+(j||"text").length;S.setSelectionRange(W,Y)},0)},[o]),v=()=>{const g=p.trim();g&&!m.includes(g)&&(f([...m,g]),d(""))},C=g=>{f(m.filter(w=>w!==g))},_=g=>{g.preventDefault(),i({title:n.trim(),content:o.trim(),tags:m.length>0?m:void 0})},y=n.trim()&&o.trim(),P=g=>g.split(`
`).map((w,S)=>w.startsWith("### ")?e.jsx("h3",{className:"text-lg font-semibold mt-4 mb-2",children:w.slice(4)},S):w.startsWith("## ")?e.jsx("h2",{className:"text-xl font-semibold mt-4 mb-2",children:w.slice(3)},S):w.startsWith("# ")?e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",children:w.slice(2)},S):w.startsWith("- ")||w.startsWith("* ")?e.jsx("li",{className:"ml-4",children:w.slice(2)},S):/^\d+\. /.test(w)?e.jsx("li",{className:"ml-4 list-decimal",children:w.replace(/^\d+\. /,"")},S):w.trim()?e.jsx("p",{className:"my-1",children:w},S):e.jsx("br",{},S));return e.jsx(os,{open:s,onOpenChange:a,children:e.jsxs(ds,{className:z("sm:max-w-2xl",r),children:[e.jsxs(ms,{children:[e.jsx(us,{children:t?"Edit Memory":"Create Memory"}),e.jsx(xs,{className:"sr-only",children:t?"Edit memory details":"Create a new memory entry"})]}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"memory-title",className:"text-sm font-medium",children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(G,{id:"memory-title",value:n,onChange:g=>c(g.target.value),placeholder:"Memory title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-medium",children:["Content ",e.jsx("span",{className:"text-destructive",children:"*"})]})}),e.jsxs(De,{value:N,onValueChange:g=>D(g),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>b("**","**"),title:"Bold",children:e.jsx(Ss,{className:"size-4"})}),e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>b("*","*"),title:"Italic",children:e.jsx(Ps,{className:"size-4"})}),e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>b("- "),title:"Bullet list",children:e.jsx(bs,{className:"size-4"})}),e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>b("1. "),title:"Numbered list",children:e.jsx(As,{className:"size-4"})}),e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>b("[","](url)"),title:"Link",children:e.jsx(V,{className:"size-4"})}),e.jsx(x,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>b("`","`"),title:"Code",children:e.jsx(Ts,{className:"size-4"})})]}),e.jsxs(Se,{children:[e.jsxs(R,{value:"edit",className:"gap-1",children:[e.jsx(Os,{className:"size-3"}),"Edit"]}),e.jsxs(R,{value:"preview",className:"gap-1",children:[e.jsx(Ye,{className:"size-3"}),"Preview"]})]})]}),e.jsx(U,{value:"edit",className:"mt-2",children:e.jsx(He,{ref:k,value:o,onChange:g=>h(g.target.value),placeholder:"Write your memory content here... (Markdown supported)",className:"min-h-[200px] font-mono text-sm",required:!0})}),e.jsx(U,{value:"preview",className:"mt-2",children:e.jsx("div",{className:"min-h-[200px] rounded-md border bg-muted/30 p-4 text-sm",children:o?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:P(o)}):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"memory-tags",className:"text-sm font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(G,{id:"memory-tags",value:p,onChange:g=>d(g.target.value),placeholder:"Add a tag",onKeyDown:g=>{g.key==="Enter"&&(g.preventDefault(),v())}}),e.jsx(x,{type:"button",variant:"outline",onClick:v,children:"Add"})]}),m.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:m.map(g=>e.jsxs(T,{variant:"secondary",className:"cursor-pointer",onClick:()=>C(g),children:[g," Ã—"]},g))})]}),e.jsxs(hs,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(x,{type:"submit",disabled:!y,children:t?"Save Changes":"Create Memory"})]})]})]})})}function Sa({email:t,onClick:s,onUnlink:a,className:i}){return e.jsxs("div",{"data-testid":"email-card",className:z("group flex items-start gap-3 rounded-lg border bg-card p-3 transition-colors hover:bg-accent/50",s&&"cursor-pointer",!t.isRead&&"border-l-2 border-l-primary",i),onClick:()=>s?.(t),children:[e.jsx("div",{className:"mt-0.5 flex size-8 shrink-0 items-center justify-center rounded-full bg-primary/10",children:e.jsx(ce,{className:"size-4 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:z("truncate text-sm",!t.isRead&&"font-semibold"),children:t.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.from.name||t.from.email})]}),e.jsxs("div",{className:"flex shrink-0 items-center gap-1",children:[t.hasAttachments&&e.jsx(Ks,{className:"size-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:_a(t.date)}),a&&e.jsxs(ve,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:r=>r.stopPropagation(),children:e.jsx(fe,{className:"size-4"})})}),e.jsx(be,{align:"end",children:e.jsxs(re,{className:"text-destructive focus:text-destructive",onClick:r=>{r.stopPropagation(),a(t)},children:[e.jsx(Xe,{className:"mr-2 size-4"}),"Unlink"]})})]})]})]}),e.jsx("p",{className:"mt-1 line-clamp-2 text-xs text-muted-foreground",children:t.snippet})]})]})}function _a(t){const a=new Date().getTime()-t.getTime(),i=Math.floor(a/(1e3*60*60*24));return i===0?t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}):i===1?"Yesterday":i<7?t.toLocaleDateString([],{weekday:"short"}):t.toLocaleDateString([],{month:"short",day:"numeric"})}function Ta({event:t,onClick:s,onUnlink:a,className:i}){const r=t.endTime<new Date,n=Ma(t.startTime,new Date);return e.jsxs("div",{"data-testid":"calendar-event-card",className:z("group flex items-start gap-3 rounded-lg border bg-card p-3 transition-colors hover:bg-accent/50",s&&"cursor-pointer",r&&"opacity-60",i),onClick:()=>s?.(t),children:[e.jsxs("div",{className:z("flex size-12 shrink-0 flex-col items-center justify-center rounded-lg",n?"bg-primary text-primary-foreground":"bg-muted"),children:[e.jsx("span",{className:"text-[10px] font-medium uppercase",children:t.startTime.toLocaleDateString([],{weekday:"short"})}),e.jsx("span",{className:"text-lg font-bold",children:t.startTime.getDate()})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-medium leading-tight",children:t.title}),a&&e.jsxs(ve,{children:[e.jsx(Ne,{asChild:!0,children:e.jsx(x,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:c=>c.stopPropagation(),children:e.jsx(fe,{className:"size-4"})})}),e.jsx(be,{align:"end",children:e.jsxs(re,{className:"text-destructive focus:text-destructive",onClick:c=>{c.stopPropagation(),a(t)},children:[e.jsx(Xe,{className:"mr-2 size-4"}),"Unlink"]})})]})]}),e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(ee,{className:"size-3"}),e.jsx("span",{children:t.isAllDay?"All day":`${Ue(t.startTime)} - ${Ue(t.endTime)}`})]}),t.location&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Rs,{className:"size-3"}),e.jsx("span",{className:"truncate",children:t.location})]}),t.meetingLink&&e.jsxs("div",{className:"mt-1 flex items-center gap-1 text-xs text-primary",children:[e.jsx(Hs,{className:"size-3"}),e.jsx("span",{children:"Video meeting"})]}),t.attendees.length>0&&e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx(Ge,{className:"size-3 text-muted-foreground"}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.attendees.slice(0,3).map((c,o)=>e.jsx(T,{variant:c.status==="accepted"?"default":c.status==="declined"?"destructive":"secondary",className:"text-[10px] px-1.5 py-0",children:c.name.split(" ")[0]},c.email)),t.attendees.length>3&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",t.attendees.length-3]})]})]})]})]})}function Ue(t){return t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function Ma(t,s){return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()}function Ia({emails:t,calendarEvents:s,onEmailClick:a,onEventClick:i,onUnlinkEmail:r,onUnlinkEvent:n,onLinkEmail:c,onLinkEvent:o,className:h}){const[p,d]=u.useState("emails"),m=t.length+s.length;return e.jsxs("div",{className:z("space-y-4",h),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Communications"}),e.jsx(T,{variant:"secondary",className:"text-xs",children:m})]})}),e.jsxs(De,{value:p,onValueChange:f=>d(f),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Se,{children:[e.jsxs(R,{value:"emails",className:"gap-1",children:[e.jsx(ce,{className:"size-3"}),"Emails",t.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:t.length})]}),e.jsxs(R,{value:"calendar",className:"gap-1",children:[e.jsx(Z,{className:"size-3"}),"Calendar",s.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:s.length})]})]}),p==="emails"&&c&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:c,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link Email"]}),p==="calendar"&&o&&e.jsxs(x,{variant:"ghost",size:"sm",onClick:o,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link Event"]})]}),e.jsx(U,{value:"emails",className:"mt-4",children:t.length>0?e.jsx("div",{className:"space-y-2",children:t.map(f=>e.jsx(Sa,{email:f,onClick:a,onUnlink:r},f.id))}):e.jsx(Ke,{icon:e.jsx(ce,{className:"size-8"}),message:"No linked emails",action:c&&e.jsxs(x,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link an email"]})})}),e.jsx(U,{value:"calendar",className:"mt-4",children:s.length>0?e.jsx("div",{className:"space-y-2",children:s.map(f=>e.jsx(Ta,{event:f,onClick:i,onUnlink:n},f.id))}):e.jsx(Ke,{icon:e.jsx(Z,{className:"size-8"}),message:"No linked calendar events",action:o&&e.jsxs(x,{variant:"outline",size:"sm",onClick:o,children:[e.jsx(V,{className:"mr-1 size-3"}),"Link an event"]})})})]})]})}function Ke({icon:t,message:s,action:a}){return e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx("div",{className:"mx-auto text-muted-foreground/50",children:t}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:s}),a&&e.jsx("div",{className:"mt-3",children:a})]})}function pe(t){const a=new Date().getTime()-t.getTime(),i=Math.floor(a/6e4),r=Math.floor(i/60),n=Math.floor(r/24);return i<1?"just now":i<60?`${i}m ago`:r<24?`${r}h ago`:n<7?`${n}d ago`:t.toLocaleDateString(void 0,{month:"short",day:"numeric"})}function xi(){const{id:t}=Kt(),s=t??"",a=se(),r=Ft()?.participants??[],{data:n,isLoading:c,error:o}=qt(s),{data:h,isLoading:p}=Ot(s),{data:d,isLoading:m}=Ys(s),{data:f,isLoading:N}=Bt(50),D=Xs(),k=Js(),b=Zs(),[v,C]=u.useState(!1),[_,y]=u.useState(null),[P,g]=u.useState(!1),{deleteItem:w,isDeleting:S,undoState:M,dismissUndo:ie}=fs({onDeleted:()=>{window.location.href="/app/work-items"}}),j=n?(()=>{const l=[];return n.dependencies?.blocks&&l.push(...n.dependencies.blocks.map(I=>({id:I.id,title:I.title,kind:"issue",status:"not_started",direction:"blocks"}))),n.dependencies?.blocked_by&&l.push(...n.dependencies.blocked_by.map(I=>({id:I.id,title:I.title,kind:"issue",status:"not_started",direction:"blocked_by"}))),{id:n.id,title:n.title,kind:n.kind||"issue",status:n.status||"not_started",priority:Wt(n.priority),description:n.description||void 0,parentId:n.parent_id||void 0,parentTitle:n.parent?.title,estimateMinutes:n.estimate_minutes||void 0,actualMinutes:n.actual_minutes||void 0,dueDate:n.not_after?new Date(n.not_after):void 0,startDate:n.not_before?new Date(n.not_before):void 0,createdAt:new Date(n.created_at),updatedAt:new Date(n.updated_at),todos:[],attachments:[],dependencies:l}})():null,H=(h?.memories??[]).map(l=>({id:l.id,title:l.title,content:l.content,linkedItemId:s,linkedItemTitle:j?.title||void 0,linkedItemKind:j?.kind||"issue",createdAt:new Date(l.created_at),updatedAt:new Date(l.updated_at)})),W=(d?.emails??[]).map(l=>({id:l.id,subject:"Email",from:{name:"Unknown",email:""},to:[],date:l.received_at?new Date(l.received_at):new Date,snippet:l.body?.substring(0,100)||"",body:l.body||void 0})),Y=(d?.calendar_events??[]).map(l=>({id:l.id,title:"Calendar Event",startTime:l.received_at?new Date(l.received_at):new Date,endTime:l.received_at?new Date(l.received_at):new Date,attendees:[]})),Te=(f?.items??[]).filter(l=>l.work_item_id===s),$=u.useCallback(l=>{D.mutate({id:s,body:l})},[s,D]),ft=l=>$({title:l}),gt=l=>$({description:l}),jt=l=>$({status:l}),vt=l=>$({priority:Qt(l)}),Nt=l=>$({notAfter:l||null}),bt=l=>$({notBefore:l||null}),yt=l=>{const I=parseInt(l,10);$({estimateMinutes:isNaN(I)?null:I})},kt=l=>{const I=parseInt(l,10);$({actualMinutes:isNaN(I)?null:I})},Ct=()=>{j?.parentId&&(window.location.href=`/app/work-items/${j.parentId}`)},wt=l=>{window.location.href=`/app/work-items/${l.id}`},zt=()=>{y(null),C(!0)},Dt=l=>{y(l),C(!0)},St=l=>{k.mutate({workItemId:s,body:{title:l.title,content:l.content,type:"note"}},{onSuccess:()=>C(!1)})},_t=l=>{_&&b.mutate({id:_.id,body:{title:l.title,content:l.content},workItemId:s},{onSuccess:()=>{C(!1),y(null)}})},Tt=async l=>{if(confirm(`Delete memory "${l.title}"?`))try{await B.delete(`/api/memories/${l.id}`),a.invalidateQueries({queryKey:J.forWorkItem(s)})}catch{}},Mt=async l=>{if(confirm("Unlink this email from the work item?"))try{await B.delete(`/api/work-items/${s}/communications/${l.id}`),a.invalidateQueries({queryKey:le.forWorkItem(s)})}catch{}},It=async l=>{if(confirm("Unlink this event from the work item?"))try{await B.delete(`/api/work-items/${s}/communications/${l.id}`),a.invalidateQueries({queryKey:le.forWorkItem(s)})}catch{}},Et=()=>g(!0),Pt=async()=>{j&&(await w({id:j.id,title:j.title}),g(!1))};return c?e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center gap-4",children:[e.jsx(Q,{width:80,height:32}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{width:100,height:32}),e.jsx(Q,{width:120,height:32})]})]}),e.jsx("div",{className:"flex-1 p-6",children:e.jsxs("div",{className:"mx-auto max-w-5xl space-y-6",children:[e.jsx(Ee,{}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(Ee,{})}),e.jsx("div",{children:e.jsx(Q,{width:"100%",height:200})})]})]})})]}):o||!j?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(Ht,{title:"Work Item Not Found",message:o instanceof Error?o.message:"The requested work item could not be loaded.",action:e.jsx(x,{variant:"outline",asChild:!0,children:e.jsx(ne,{to:"/work-items",children:"Back to Work Items"})})})}):e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-border bg-background flex items-center gap-4 shrink-0",children:[e.jsx(x,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(ne,{to:"/work-items",children:[e.jsx(Qe,{className:"mr-1 size-4 rotate-180"}),"Back"]})}),e.jsxs("div",{className:"flex gap-2 ml-auto",children:[e.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(ne,{to:`/work-items/${s}/timeline`,children:[e.jsx(Z,{className:"mr-2 size-4"}),"Timeline"]})}),e.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(ne,{to:`/work-items/${s}/graph`,children:[e.jsx(ys,{className:"mr-2 size-4"}),"Dependencies"]})})]})]}),e.jsx(es,{className:"flex-1",children:e.jsxs("div",{className:"mx-auto max-w-5xl p-6 space-y-6",children:[e.jsx(ma,{title:j.title,kind:j.kind,status:j.status,parentTitle:j.parentTitle,onTitleChange:ft,onParentClick:Ct,onDelete:Et}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"size-3"}),"Created ",pe(j.createdAt)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ee,{className:"size-3"}),"Updated ",pe(j.updatedAt)]}),D.isPending&&e.jsx(T,{variant:"outline",className:"text-xs animate-pulse",children:"Saving..."})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(ua,{status:j.status,priority:j.priority,assignee:j.assignee,dueDate:j.dueDate,startDate:j.startDate,estimateMinutes:j.estimateMinutes,actualMinutes:j.actualMinutes,onStatusChange:jt,onPriorityChange:vt,onDueDateChange:Nt,onStartDateChange:bt,onEstimateChange:yt,onActualChange:kt})})}),e.jsxs(De,{defaultValue:"description",children:[e.jsxs(Se,{variant:"line",className:"w-full justify-start",children:[e.jsxs(R,{value:"description",className:"gap-1.5",children:[e.jsx(ae,{className:"size-3.5"}),"Description"]}),e.jsxs(R,{value:"checklist",className:"gap-1.5",children:[e.jsx(Ws,{className:"size-3.5"}),"Checklist",j.todos.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-xs px-1.5 py-0",children:j.todos.length})]}),e.jsxs(R,{value:"dependencies",className:"gap-1.5",children:[e.jsx(Is,{className:"size-3.5"}),"Dependencies",j.dependencies.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-xs px-1.5 py-0",children:j.dependencies.length})]}),e.jsxs(R,{value:"activity",className:"gap-1.5",children:[e.jsx(Ie,{className:"size-3.5"}),"Activity"]})]}),e.jsx(U,{value:"description","data-testid":"tab-content-description",children:e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(xa,{description:j.description,onDescriptionChange:gt})})})}),e.jsx(U,{value:"checklist","data-testid":"tab-content-checklist",children:e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(va,{todos:j.todos})})})}),e.jsx(U,{value:"dependencies","data-testid":"tab-content-dependencies",children:e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:e.jsx(ka,{dependencies:j.dependencies,onDependencyClick:wt})})})}),e.jsx(U,{value:"activity","data-testid":"tab-content-activity",children:e.jsx(A,{children:e.jsx(L,{className:"pt-4",children:N?e.jsx(Gt,{count:3,variant:"row"}):Te.length===0?e.jsxs("div",{className:"py-8 text-center text-muted-foreground",children:[e.jsx(Ie,{className:"size-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No activity recorded yet"})]}):e.jsx("div",{className:"space-y-3",children:Te.map(l=>e.jsxs("div",{className:"flex items-start gap-3 py-2 border-b border-border last:border-0",children:[e.jsx("div",{className:`size-7 rounded-full flex items-center justify-center shrink-0 ${l.actor_email?.includes("agent")?"bg-violet-500/10 text-violet-500 dark:bg-violet-500/20":"bg-primary/10 text-primary dark:bg-primary/20"}`,children:e.jsx("span",{className:"text-xs font-medium",children:(l.actor_email??"S").charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium text-foreground",children:l.actor_email||"System"})," ",e.jsx("span",{className:"text-muted-foreground",children:l.description})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:pe(new Date(l.created_at))})]})]},l.id))})})})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(A,{children:[e.jsx(xe,{className:"pb-3",children:e.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ks,{className:"size-4 text-muted-foreground"}),"Memories",H.length>0&&e.jsx(T,{variant:"secondary",className:"text-xs px-1.5 py-0",children:H.length})]})}),e.jsx(L,{children:p?e.jsx(Q,{width:"100%",height:80}):e.jsx(za,{memories:H,onAddMemory:zt,onEditMemory:Dt,onDeleteMemory:Tt})})]}),e.jsxs(A,{children:[e.jsx(xe,{className:"pb-3",children:e.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ce,{className:"size-4 text-muted-foreground"}),"Communications",W.length+Y.length>0&&e.jsx(T,{variant:"secondary",className:"text-xs px-1.5 py-0",children:W.length+Y.length})]})}),e.jsx(L,{children:m?e.jsx(Q,{width:"100%",height:80}):e.jsx(Ia,{emails:W,calendarEvents:Y,onUnlinkEmail:Mt,onUnlinkEvent:It})})]}),e.jsxs(A,{children:[e.jsx(xe,{className:"pb-3",children:e.jsxs(he,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ge,{className:"size-4 text-muted-foreground"}),"Participants"]})}),e.jsx(L,{children:r.length===0?e.jsx("p",{className:"text-xs text-muted-foreground",children:"No participants assigned"}):e.jsx("ul",{className:"space-y-2",children:r.map((l,I)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-7 rounded-full bg-primary/10 dark:bg-primary/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:(l.participant??"U")[0].toUpperCase()})}),e.jsx("span",{className:"text-sm",children:l.participant??"Unknown"}),l.role&&e.jsx(T,{variant:"outline",className:"text-xs",children:l.role})]},I))})})]})]})]})]})}),e.jsx(Da,{memory:_||void 0,open:v,onOpenChange:C,onSubmit:_?_t:St}),e.jsx(gs,{open:P,onOpenChange:g,item:j?{id:j.id,title:j.title,kind:j.kind,childCount:0}:void 0,onConfirm:Pt,isDeleting:S}),M&&e.jsx(js,{visible:!!M,itemTitle:M.itemTitle,onUndo:M.onUndo,onDismiss:ie})]})}export{xi as WorkItemDetailPage};
//# sourceMappingURL=WorkItemDetailPage-Cr1sjnFc.js.map
