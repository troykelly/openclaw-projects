import{r as m,j as e,L as _}from"./index-BTKavlMF.js";import{u as z,A as j}from"./use-activity-Crug4fkm.js";import{S as g,a as M,C as h,b as f}from"./card-B-p_muP1.js";import{E as S,R as A}from"./error-state-B03uaCNt.js";import{E as T}from"./empty-state-4YFWPGw_.js";import{c as x,B as u}from"./button-4HlqvOJz.js";import{B as y}from"./badge-DQI7MJbM.js";import{S as D}from"./scroll-area-C7lCNkM3.js";import{M as v}from"./mail-Dxtcdvk2.js";import{S as L,M as I}from"./settings-DtE8TC8v.js";import{B as C}from"./brain-CTHW2xD0.js";import{U as F}from"./user-plus-DbfplgaW.js";import{P as $}from"./plus-DK79iTRj.js";import"./useQuery-CvMXqy2m.js";import"./api-client-CDvRtWmo.js";import"./bell-DDXm4AVD.js";import"./calendar-Bg7Wilqy.js";import"./users-CqTs1AU5.js";import"./folder-open-CVH1OSKw.js";import"./search-CshjFlwn.js";import"./index-DYGATo4h.js";import"./index-B3VtdiG5.js";import"./index-BdQq_4o_.js";const E=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],N=x("bot",E);const B=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m16 12-4-4-4 4",key:"177agl"}],["path",{d:"M12 16V8",key:"1sbj14"}]],k=x("circle-arrow-up",B);const R=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],b=x("funnel",R);function P(t){const r=t.actor_email?t.actor_email.includes("agent")||t.actor_email.includes("openclaw")?"agent":"human":"system",i=t.type==="status_change"?"status_changed":t.type;return{id:t.id,actorType:r,actorName:t.actor_email||"System",action:i,actionLabel:U(i),entityId:t.work_item_id,entityTitle:t.work_item_title,detail:t.description,timestamp:new Date(t.created_at),type:t.type}}function U(t){switch(t){case"created":return"created";case"updated":return"updated";case"status_changed":return"changed status of";case"commented":return"commented on";case"assigned":return"assigned";case"memory_added":return"added memory to";case"communication_linked":return"linked communication to";default:return t.replace(/_/g," ")}}function Y(t,r){if(r==="agent")return e.jsx(N,{className:"size-4"});switch(t){case"created":return e.jsx($,{className:"size-4"});case"updated":case"status_change":case"status_changed":return e.jsx(k,{className:"size-4"});case"commented":return e.jsx(I,{className:"size-4"});case"assigned":return e.jsx(F,{className:"size-4"});case"memory_added":return e.jsx(C,{className:"size-4"});case"communication_linked":return e.jsx(v,{className:"size-4"});default:return e.jsx(j,{className:"size-4"})}}function q(t,r){if(r==="agent")return"bg-violet-500/10 text-violet-500 dark:bg-violet-500/20";if(r==="system")return"bg-gray-500/10 text-gray-500 dark:bg-gray-500/20";switch(t){case"created":return"bg-green-500/10 text-green-500 dark:bg-green-500/20";case"updated":case"status_change":case"status_changed":return"bg-blue-500/10 text-blue-500 dark:bg-blue-500/20";case"commented":return"bg-amber-500/10 text-amber-500 dark:bg-amber-500/20";case"assigned":return"bg-indigo-500/10 text-indigo-500 dark:bg-indigo-500/20";case"memory_added":return"bg-purple-500/10 text-purple-500 dark:bg-purple-500/20";case"communication_linked":return"bg-teal-500/10 text-teal-500 dark:bg-teal-500/20";default:return"bg-primary/10 text-primary dark:bg-primary/20"}}function H(t){const r=new Date,i=new Date(r.getFullYear(),r.getMonth(),r.getDate()),c=new Date(i.getTime()-864e5),n=new Date(t.getFullYear(),t.getMonth(),t.getDate());return n.getTime()===i.getTime()?"Today":n.getTime()===c.getTime()?"Yesterday":t.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})}function O(t){const i=new Date().getTime()-t.getTime(),c=Math.floor(i/6e4),n=Math.floor(c/60);return c<1?"just now":c<60?`${c}m ago`:n<24?`${n}h ago`:t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}function V(t){return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}const K=[{value:"all",label:"All",icon:e.jsx(j,{className:"size-3.5"})},{value:"work_items",label:"Work Items",icon:e.jsx(k,{className:"size-3.5"})},{value:"communications",label:"Comms",icon:e.jsx(v,{className:"size-3.5"})},{value:"agent",label:"Agent",icon:e.jsx(N,{className:"size-3.5"})},{value:"system",label:"System",icon:e.jsx(L,{className:"size-3.5"})}];function ye(){const{data:t,isLoading:r,error:i,refetch:c}=z(100),[n,p]=m.useState("all"),l=m.useMemo(()=>(t?.items??[]).map(P),[t]),d=m.useMemo(()=>n==="all"?l:l.filter(a=>{switch(n){case"work_items":return["created","updated","status_changed","assigned"].includes(a.action);case"communications":return["commented","communication_linked"].includes(a.action);case"agent":return a.actorType==="agent";case"system":return a.actorType==="system";default:return!0}}),[l,n]),w=m.useMemo(()=>{const a=new Map;for(const s of d){const o=V(s.timestamp);a.has(o)||a.set(o,{label:H(s.timestamp),items:[]}),a.get(o).items.push(s)}return Array.from(a.entries()).map(([s,o])=>({key:s,label:o.label,items:o.items}))},[d]);return r?e.jsxs("div",{"data-testid":"page-activity",className:"p-6",children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsx(g,{width:200,height:32})}),e.jsx("div",{className:"mb-4 flex gap-2",children:Array.from({length:5}).map((a,s)=>e.jsx(g,{width:80,height:32},s))}),e.jsx(M,{count:8,variant:"row"})]}):i?e.jsx("div",{"data-testid":"page-activity",className:"p-6",children:e.jsx(S,{type:"generic",title:"Failed to load activity",description:i instanceof Error?i.message:"Unknown error",onRetry:()=>c()})}):(t?.items??[]).length===0?e.jsxs("div",{"data-testid":"page-activity",className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground mb-4",children:"Activity Feed"}),e.jsx(h,{children:e.jsx(f,{className:"p-8",children:e.jsx(T,{variant:"no-data",title:"No activity yet",description:"Activity will appear here when work items are created or updated."})})})]}):e.jsxs("div",{"data-testid":"page-activity",className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Activity Feed"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Recent updates across all work items"})]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>c(),className:"gap-1.5",children:[e.jsx(A,{className:"size-3.5"}),"Refresh"]})]}),e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx(b,{className:"size-4 text-muted-foreground"}),K.map(a=>e.jsxs(u,{variant:n===a.value?"default":"outline",size:"sm",className:"gap-1.5",onClick:()=>p(a.value),children:[a.icon,a.label]},a.value)),n!=="all"&&e.jsxs(y,{variant:"secondary",className:"text-xs",children:[d.length," of ",l.length]})]}),e.jsx(h,{className:"flex-1",children:e.jsx(f,{className:"p-0",children:e.jsx(D,{className:"h-[calc(100vh-280px)]",children:d.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(b,{className:"size-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No activities match the selected filter"}),e.jsx(u,{variant:"ghost",size:"sm",className:"mt-2",onClick:()=>p("all"),children:"Show all activities"})]}):e.jsx("div",{children:w.map(a=>e.jsxs("div",{children:[e.jsxs("div",{"data-testid":"date-separator",className:"sticky top-0 z-10 bg-muted/80 backdrop-blur-sm border-b border-border px-4 py-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wider",children:a.label}),e.jsx(y,{variant:"outline",className:"ml-2 text-xs",children:a.items.length})]}),a.items.map(s=>e.jsx("div",{className:"px-4 py-3 hover:bg-muted/50 dark:hover:bg-muted/30 transition-colors border-b border-border last:border-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{"data-testid":"activity-type-icon",className:`size-8 rounded-full flex items-center justify-center shrink-0 ${q(s.type,s.actorType)}`,children:Y(s.type,s.actorType)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:s.actorName}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.actionLabel}),e.jsx(_,{to:`/work-items/${s.entityId}`,className:"text-sm font-medium text-primary hover:underline truncate max-w-[200px] sm:max-w-none",children:s.entityTitle})]}),s.detail&&e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5 line-clamp-2",children:s.detail})]}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap shrink-0",children:O(s.timestamp)})]})},s.id))]},a.key))})})})})]})}export{ye as ActivityPage};
//# sourceMappingURL=ActivityPage-CxYpanKp.js.map
