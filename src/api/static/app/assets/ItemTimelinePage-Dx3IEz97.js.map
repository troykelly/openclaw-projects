{"version":3,"file":"ItemTimelinePage-Dx3IEz97.js","sources":["../../../../../node_modules/.pnpm/lucide-react@0.563.0_react@19.2.4/node_modules/lucide-react/dist/esm/icons/chart-column.js","../../../../ui/pages/ItemTimelinePage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.563.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 3v16a2 2 0 0 0 2 2h16\", key: \"c24i48\" }],\n  [\"path\", { d: \"M18 17V9\", key: \"2bz60n\" }],\n  [\"path\", { d: \"M13 17V5\", key: \"1frdt8\" }],\n  [\"path\", { d: \"M8 17v-3\", key: \"17ska0\" }]\n];\nconst ChartColumn = createLucideIcon(\"chart-column\", __iconNode);\n\nexport { __iconNode, ChartColumn as default };\n//# sourceMappingURL=chart-column.js.map\n","/**\n * Work item timeline / Gantt chart page.\n *\n * Displays a Gantt-style SVG chart showing the timeline for a single\n * work item and its children, including dependency arrows.\n * Uses TanStack Query via the useItemTimeline hook for data fetching.\n */\nimport React from 'react';\nimport { useParams, Link } from 'react-router';\nimport { useItemTimeline } from '@/ui/hooks/queries/use-timeline';\nimport { kindColors } from '@/ui/lib/work-item-utils';\nimport { Skeleton, ErrorState } from '@/ui/components/feedback';\nimport { Button } from '@/ui/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/ui/components/ui/card';\nimport { ScrollArea, ScrollBar } from '@/ui/components/ui/scroll-area';\nimport { ChevronRight, BarChart3 } from 'lucide-react';\n\nexport function ItemTimelinePage(): React.JSX.Element {\n  const { id } = useParams<{ id: string }>();\n  const itemId = id ?? '';\n  const { data, isLoading, error, refetch } = useItemTimeline(itemId);\n\n  if (isLoading) {\n    return (\n      <div data-testid=\"page-item-timeline\" className=\"p-6\">\n        <Skeleton width={150} height={24} className=\"mb-4\" />\n        <Skeleton width=\"100%\" height={400} />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div data-testid=\"page-item-timeline\" className=\"p-6\">\n        <ErrorState\n          type=\"generic\"\n          title=\"Failed to load timeline\"\n          description={error instanceof Error ? error.message : 'Unknown error'}\n          onRetry={() => refetch()}\n        />\n      </div>\n    );\n  }\n\n  const items = data?.items ?? [];\n  const dependencies = data?.dependencies ?? [];\n\n  // Compute date range\n  const dates = items\n    .flatMap((i) => [i.not_before, i.not_after])\n    .filter((d): d is string => d !== null)\n    .map((d) => new Date(d).getTime());\n\n  const now = Date.now();\n  let minDate = dates.length > 0 ? Math.min(...dates) : now;\n  let maxDate = dates.length > 0 ? Math.max(...dates) : now + 30 * 24 * 60 * 60 * 1000;\n\n  const range = maxDate - minDate || 1;\n  minDate -= range * 0.05;\n  maxDate += range * 0.05;\n\n  const chartWidth = 900;\n  const rowHeight = 40;\n  const labelWidth = 220;\n  const chartHeight = items.length * rowHeight + 60;\n\n  function dateToX(date: number): number {\n    return labelWidth + ((date - minDate) / (maxDate - minDate)) * (chartWidth - labelWidth - 20);\n  }\n\n  const itemPositions: Record<string, { y: number }> = {};\n  items.forEach((item, idx) => {\n    itemPositions[item.id] = { y: idx * rowHeight + 30 };\n  });\n\n  return (\n    <div data-testid=\"page-item-timeline\" className=\"p-6\">\n      <div className=\"mb-4\">\n        <Button variant=\"ghost\" size=\"sm\" asChild>\n          <Link to=\"/work-items\">\n            <ChevronRight className=\"mr-1 size-4 rotate-180\" />\n            Back to Work Items\n          </Link>\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <BarChart3 className=\"size-5\" />\n            Timeline / Gantt Chart\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ScrollArea className=\"w-full\">\n            <svg\n              width={chartWidth}\n              height={chartHeight}\n              className=\"font-sans text-xs\"\n            >\n              {/* Background */}\n              <rect x={labelWidth} y={0} width={chartWidth - labelWidth} height={chartHeight} className=\"fill-muted/30\" />\n\n              {/* Date axis markers */}\n              {[0.25, 0.5, 0.75, 1].map((pct) => {\n                const x = labelWidth + pct * (chartWidth - labelWidth - 20);\n                const dateVal = minDate + pct * (maxDate - minDate);\n                const label = new Date(dateVal).toLocaleDateString();\n                return (\n                  <g key={pct}>\n                    <line x1={x} y1={0} x2={x} y2={chartHeight} className=\"stroke-border\" strokeDasharray=\"4,4\" />\n                    <text x={x} y={chartHeight - 8} textAnchor=\"middle\" className=\"fill-muted-foreground text-[10px]\">\n                      {label}\n                    </text>\n                  </g>\n                );\n              })}\n\n              {/* Items */}\n              {items.map((item, idx) => {\n                const y = idx * rowHeight + 30;\n                const indent = item.level * 16;\n\n                const hasStart = item.not_before !== null;\n                const hasEnd = item.not_after !== null;\n                let barX = labelWidth + 10;\n                let barWidth = 60;\n\n                if (hasStart && hasEnd) {\n                  barX = dateToX(new Date(item.not_before!).getTime());\n                  barWidth = Math.max(8, dateToX(new Date(item.not_after!).getTime()) - barX);\n                } else if (hasStart) {\n                  barX = dateToX(new Date(item.not_before!).getTime());\n                } else if (hasEnd) {\n                  barX = dateToX(new Date(item.not_after!).getTime()) - 60;\n                }\n\n                const colorClass = kindColors[item.kind] || 'bg-gray-500';\n                const isDone = item.status === 'done' || item.status === 'closed';\n\n                return (\n                  <g key={item.id}>\n                    <rect x={0} y={y - 15} width={chartWidth} height={rowHeight} className={idx % 2 === 0 ? 'fill-transparent' : 'fill-muted/20'} />\n                    <text x={8 + indent} y={y + 5} className=\"fill-foreground text-xs font-medium\">\n                      {item.title.length > 24 ? item.title.slice(0, 22) + '...' : item.title}\n                    </text>\n                    <rect\n                      x={barX}\n                      y={y - 10}\n                      width={barWidth}\n                      height={24}\n                      rx={4}\n                      className={`${colorClass} ${isDone ? 'opacity-40' : 'opacity-80'}`}\n                    />\n                    <text x={barX + 6} y={y + 5} className=\"fill-white text-[10px] font-medium\">\n                      {item.kind.charAt(0).toUpperCase()}\n                    </text>\n                  </g>\n                );\n              })}\n\n              {/* Dependencies */}\n              {dependencies.map((dep) => {\n                const fromPos = itemPositions[dep.from_id];\n                const toPos = itemPositions[dep.to_id];\n                if (!fromPos || !toPos) return null;\n\n                const fromItem = items.find((i) => i.id === dep.from_id);\n                const toItem = items.find((i) => i.id === dep.to_id);\n                if (!fromItem || !toItem) return null;\n\n                const fromY = fromPos.y;\n                const toY = toPos.y;\n\n                let fromX = labelWidth + 40;\n                let toX = labelWidth + 40;\n\n                if (toItem.not_after) {\n                  toX = dateToX(new Date(toItem.not_after).getTime());\n                }\n                if (fromItem.not_before) {\n                  fromX = dateToX(new Date(fromItem.not_before).getTime());\n                }\n\n                return (\n                  <line\n                    key={dep.id}\n                    x1={toX + 4}\n                    y1={toY}\n                    x2={fromX - 4}\n                    y2={fromY}\n                    className=\"stroke-destructive\"\n                    strokeWidth={1.5}\n                    markerEnd=\"url(#arrowhead)\"\n                  />\n                );\n              })}\n\n              <defs>\n                <marker id=\"arrowhead\" markerWidth=\"8\" markerHeight=\"8\" refX=\"6\" refY=\"4\" orient=\"auto\">\n                  <path d=\"M0,0 L8,4 L0,8 Z\" className=\"fill-destructive\" />\n                </marker>\n              </defs>\n            </svg>\n            <ScrollBar orientation=\"horizontal\" />\n          </ScrollArea>\n\n          {/* Legend */}\n          <div className=\"mt-4 flex flex-wrap items-center gap-4 text-sm text-muted-foreground\">\n            <span className=\"font-medium\">Legend:</span>\n            <span className=\"flex items-center gap-1\">\n              <span className=\"size-3 rounded bg-blue-500\" /> Project\n            </span>\n            <span className=\"flex items-center gap-1\">\n              <span className=\"size-3 rounded bg-violet-500\" /> Initiative\n            </span>\n            <span className=\"flex items-center gap-1\">\n              <span className=\"size-3 rounded bg-emerald-500\" /> Epic\n            </span>\n            <span className=\"flex items-center gap-1\">\n              <span className=\"size-3 rounded bg-gray-500\" /> Issue\n            </span>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":["__iconNode","ChartColumn","createLucideIcon","ItemTimelinePage","id","useParams","itemId","data","isLoading","error","refetch","useItemTimeline","jsxs","jsx","Skeleton","ErrorState","items","dependencies","dates","i","d","now","minDate","maxDate","range","chartWidth","rowHeight","labelWidth","chartHeight","dateToX","date","itemPositions","item","idx","Button","Link","ChevronRight","Card","CardHeader","CardTitle","BarChart3","CardContent","ScrollArea","pct","x","dateVal","label","y","indent","hasStart","hasEnd","barX","barWidth","colorClass","kindColors","isDone","dep","fromPos","toPos","fromItem","toItem","fromY","toY","fromX","toX","ScrollBar"],"mappings":"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","x_google_ignoreList":[0]}