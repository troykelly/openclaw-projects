import{r as a,a as te,R as B,j as e}from"./index-DoQKFsVP.js";import{a as w}from"./api-client-CDvRtWmo.js";import{g as E}from"./work-item-utils-RZsWa1qH.js";import{S as _,a as se}from"./skeleton-6qwQjcya.js";import{u as ae,E as ne}from"./error-state-BiIOivoY.js";import{E as ie}from"./empty-state-CaNdnNB4.js";import{c as I,B as m}from"./button-BTQRjsho.js";import{I as H}from"./input-CKNIOnpa.js";import{B as S}from"./badge-DsiyHYV4.js";import{C as F,a as A}from"./card-Cf-It-QS.js";import{S as O}from"./scroll-area-XA4Aq3a2.js";import{S as P}from"./separator-LHAeuEtu.js";import{D as le,a as re,b as ce,c as oe,d as de,e as me}from"./dialog-Cq4tsCLN.js";import{T as xe}from"./textarea-YxKrgQ6U.js";import{A as he,S as ue,a as pe,b as fe,c as je,d as ge}from"./sheet-SipWvLGg.js";import{S as Ne,a as ve,b as ye,c as Ce,d as M}from"./select-DcL9NSeY.js";import{S as be}from"./search-BHgE2aeV.js";import{L as Se}from"./list-CihwikGH.js";import{M as T}from"./mail-DC9xiueU.js";import{L as we}from"./link-2-Btskszyn.js";import"./bell-CNA8j3so.js";import"./users-CJNt4qKT.js";import"./index-Qf36hgnl.js";import"./index-CznuPdXa.js";import"./index-K96IL8No.js";import"./chevron-down-CTcxn7D3.js";const ke=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],ze=I("grid-3x3",ke);const De=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],L=I("phone",De);const Ee=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],_e=I("user-plus",Ee),k={all:["contacts"],lists:()=>[...k.all,"list"],list:s=>[...k.lists(),s],detail:s=>[...k.all,"detail",s]};function Fe(s){const d=s?`?search=${encodeURIComponent(s)}`:"";return ae({queryKey:k.list(s),queryFn:({signal:n})=>w.get(`/api/contacts${d}`,{signal:n})})}function u(s,d){return s.endpoints.find(r=>r.type===d)?.value??null}function Ae(s,d){const n=[...s];switch(d){case"name":return n.sort((r,c)=>r.display_name.localeCompare(c.display_name));case"recent":return n.sort((r,c)=>new Date(c.created_at).getTime()-new Date(r.created_at).getTime());case"endpoints":return n.sort((r,c)=>c.endpoints.length-r.endpoints.length);default:return n}}function lt(){const[s,d]=a.useState(""),[n,r]=a.useState(""),[c,p]=a.useState("name"),[h,f]=a.useState("grid"),[i,j]=a.useState(null),[z,o]=a.useState(!1),[G,g]=a.useState(!1),[N,v]=a.useState(null),[K,C]=a.useState(!1),V=te();B.useEffect(()=>{const t=setTimeout(()=>{r(s)},300);return()=>clearTimeout(t)},[s]);const{data:b,isLoading:J,isError:Q,error:$,refetch:x}=Fe(n||void 0),D=a.useMemo(()=>b?.contacts?Ae(b.contacts,c):[],[b?.contacts,c]),q=a.useCallback(t=>{j(t),o(!0)},[]),W=a.useCallback(t=>{V(`/people/${t.id}`)},[V]),X=a.useCallback(async t=>{C(!0);try{await w.post("/api/contacts",t),g(!1),v(null),x()}catch(l){console.error("Failed to create contact:",l)}finally{C(!1)}},[x]),Y=a.useCallback(async t=>{if(N){C(!0);try{await w.patch(`/api/contacts/${N.id}`,t),g(!1),v(null),o(!1),j(null),x()}catch(l){console.error("Failed to update contact:",l)}finally{C(!1)}}},[N,x]),Z=a.useCallback(async t=>{try{await w.delete(`/api/contacts/${t.id}`),o(!1),j(null),x()}catch(l){console.error("Failed to delete contact:",l)}},[x]),ee=a.useCallback(t=>{v(t),o(!1),g(!0)},[]),R=a.useCallback(()=>{v(null),g(!0)},[]);if(J)return e.jsxs("div",{"data-testid":"page-contacts",className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx(_,{width:200,height:32}),e.jsx(_,{width:120,height:36})]}),e.jsx(_,{width:"100%",height:40,className:"mb-4"}),e.jsx(se,{count:6,variant:"card"})]});if(Q)return e.jsx("div",{"data-testid":"page-contacts",className:"p-6",children:e.jsx(ne,{type:"generic",title:"Failed to load contacts",description:$ instanceof Error?$.message:"Unknown error",onRetry:()=>x()})});const U=b?.total??0;return e.jsxs("div",{"data-testid":"page-contacts",className:"p-6 h-full flex flex-col",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"People"}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[U," contact",U!==1?"s":""]})]}),e.jsxs(m,{onClick:R,"data-testid":"add-contact-button",children:[e.jsx(_e,{className:"mr-2 size-4"}),"Add Contact"]})]}),e.jsxs("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(be,{className:"absolute left-3 top-1/2 size-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(H,{type:"text",placeholder:"Search contacts...",value:s,onChange:t=>d(t.target.value),className:"pl-9","data-testid":"contact-search-input"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ne,{value:c,onValueChange:t=>p(t),children:[e.jsxs(ve,{className:"w-[150px]","data-testid":"sort-select",children:[e.jsx(he,{className:"mr-2 size-4"}),e.jsx(ye,{placeholder:"Sort by"})]}),e.jsxs(Ce,{children:[e.jsx(M,{value:"name",children:"Name"}),e.jsx(M,{value:"recent",children:"Most Recent"}),e.jsx(M,{value:"endpoints",children:"Endpoints"})]})]}),e.jsxs("div",{className:"flex rounded-md border",children:[e.jsx(m,{variant:h==="grid"?"default":"ghost",size:"icon",className:"rounded-r-none size-9",onClick:()=>f("grid"),title:"Grid view","data-testid":"view-grid",children:e.jsx(ze,{className:"size-4"})}),e.jsx(m,{variant:h==="list"?"default":"ghost",size:"icon",className:"rounded-l-none size-9",onClick:()=>f("list"),title:"List view","data-testid":"view-list",children:e.jsx(Se,{className:"size-4"})})]})]})]}),D.length===0?e.jsx(F,{children:e.jsx(A,{className:"p-8",children:e.jsx(ie,{variant:"contacts",title:s?"No contacts found":"No contacts yet",description:s?"Try a different search term.":"Add your first contact to get started.",onAction:s?void 0:R,actionLabel:"Add Contact"})})}):e.jsx(O,{className:"flex-1",children:h==="grid"?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3","data-testid":"contacts-grid",children:D.map(t=>{const l=u(t,"email"),y=u(t,"phone");return e.jsx(F,{"data-testid":"contact-card",className:"cursor-pointer transition-colors hover:bg-muted/50",onClick:()=>q(t),children:e.jsxs(A,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex size-12 shrink-0 items-center justify-center rounded-full bg-primary/10 text-sm font-medium text-primary",children:E(t.display_name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"font-medium text-foreground truncate",children:t.display_name}),l&&e.jsxs("p",{className:"flex items-center gap-1 text-sm text-muted-foreground truncate mt-0.5",children:[e.jsx(T,{className:"size-3 shrink-0"}),l]}),y&&e.jsxs("p",{className:"flex items-center gap-1 text-sm text-muted-foreground truncate mt-0.5",children:[e.jsx(L,{className:"size-3 shrink-0"}),y]})]})]}),t.endpoints.length>0&&e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsxs(S,{variant:"secondary",className:"text-xs gap-1",children:[e.jsx(we,{className:"size-3"}),t.endpoints.length," endpoint",t.endpoints.length!==1?"s":""]})})]})},t.id)})}):e.jsx(F,{"data-testid":"contacts-list",children:e.jsx(A,{className:"p-0",children:e.jsx("div",{className:"divide-y",children:D.map(t=>{const l=u(t,"email"),y=u(t,"phone");return e.jsxs("button",{"data-testid":"contact-row",onClick:()=>q(t),className:"w-full p-4 text-left hover:bg-muted/50 transition-colors flex items-center gap-3",children:[e.jsx("div",{className:"flex size-10 shrink-0 items-center justify-center rounded-full bg-primary/10 text-sm font-medium text-primary",children:E(t.display_name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:t.display_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground mt-0.5",children:[l&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(T,{className:"size-3 shrink-0"}),l]}),y&&e.jsxs("span",{className:"flex items-center gap-1 truncate",children:[e.jsx(L,{className:"size-3 shrink-0"}),y]})]})]}),e.jsxs(S,{variant:"secondary",className:"shrink-0",children:[t.endpoints.length," endpoint",t.endpoints.length!==1?"s":""]})]},t.id)})})})})}),e.jsx(ue,{open:z,onOpenChange:o,children:e.jsxs(pe,{className:"w-96 sm:max-w-md","data-testid":"contact-detail-sheet",children:[e.jsxs(fe,{children:[e.jsx(je,{className:"sr-only",children:"Contact Details"}),e.jsx(ge,{className:"sr-only",children:"View contact information and endpoints"})]}),i&&e.jsx(O,{className:"h-full",children:e.jsxs("div",{className:"space-y-6 pb-6",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex size-16 items-center justify-center rounded-full bg-primary/10 text-xl font-medium text-primary",children:E(i.display_name)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h2",{className:"text-lg font-semibold",children:i.display_name}),u(i,"email")&&e.jsx("p",{className:"text-sm text-muted-foreground",children:u(i,"email")})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>W(i),"data-testid":"view-full-detail",children:"View Full Profile"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>ee(i),children:"Edit"}),e.jsx(m,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>Z(i),children:"Delete"})]}),e.jsx(P,{}),i.notes&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Notes"}),e.jsx("p",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-md",children:i.notes})]}),e.jsx(P,{})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Endpoints"}),e.jsx(S,{variant:"secondary",className:"text-xs",children:i.endpoints.length})]}),i.endpoints.length>0?e.jsx("div",{className:"space-y-2",children:i.endpoints.map((t,l)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 rounded-md bg-muted/30",children:[t.type==="email"&&e.jsx(T,{className:"size-4 text-muted-foreground"}),t.type==="phone"&&e.jsx(L,{className:"size-4 text-muted-foreground"}),t.type!=="email"&&t.type!=="phone"&&e.jsx(S,{variant:"outline",className:"text-xs",children:t.type}),e.jsx("span",{className:"text-foreground",children:t.value})]},l))}):e.jsx("p",{className:"text-sm text-muted-foreground py-4 text-center",children:"No endpoints"})]})]})})]})}),e.jsx(Me,{open:G,onOpenChange:t=>{g(t),t||v(null)},contact:N,isSubmitting:K,onSubmit:t=>{N?Y(t):X(t)}})]})}function Me({open:s,onOpenChange:d,contact:n,isSubmitting:r,onSubmit:c}){const[p,h]=a.useState(""),[f,i]=a.useState("");B.useEffect(()=>{s&&(h(n?.display_name??""),i(n?.notes??""))},[s,n]);const j=o=>{o.preventDefault(),c({displayName:p.trim(),notes:f.trim()||void 0})},z=p.trim().length>0;return e.jsx(le,{open:s,onOpenChange:d,children:e.jsxs(re,{className:"sm:max-w-md","data-testid":"contact-form-dialog",children:[e.jsxs(ce,{children:[e.jsx(oe,{children:n?"Edit Contact":"Add Contact"}),e.jsx(de,{children:n?"Update the contact details below.":"Fill in the details to add a new contact."})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"contact-name",className:"text-sm font-medium",children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(H,{id:"contact-name",value:p,onChange:o=>h(o.target.value),placeholder:"John Doe",required:!0,"data-testid":"contact-name-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"contact-notes",className:"text-sm font-medium",children:"Notes"}),e.jsx(xe,{id:"contact-notes",value:f,onChange:o=>i(o.target.value),placeholder:"Additional notes about this contact...",rows:3,"data-testid":"contact-notes-input"})]}),e.jsxs(me,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:!z||r,"data-testid":"contact-form-submit",children:n?"Save Changes":"Add Contact"})]})]})]})})}export{lt as ContactsPage};
//# sourceMappingURL=ContactsPage-C2JFP6co.js.map
