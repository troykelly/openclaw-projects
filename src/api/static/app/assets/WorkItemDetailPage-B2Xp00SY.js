import{S as cs,s as os,h as je,g as ds,n as Se,b as V,r as x,c as ms,d as us,j as e,e as hs,L as G}from"./index-DoQKFsVP.js";import{w as A,P as Z,T as ce,L as oe,a as de,G as xs,d as ps,c as js,D as fs,U as gs}from"./use-work-item-delete-LbVpmwm-.js";import{u as Me,C as fe,E as vs}from"./error-state-BiIOivoY.js";import{a as U}from"./api-client-CDvRtWmo.js";import{r as Ns,b as ys,c as bs}from"./work-item-utils-RZsWa1qH.js";import{b as ks,S as ge}from"./skeleton-6qwQjcya.js";import{c as P,B as u,a as M,u as De}from"./button-BTQRjsho.js";import{B as T}from"./badge-DsiyHYV4.js";import{C as q,a as K,b as ne,c as re}from"./card-Cf-It-QS.js";import{P as Cs,S as ws}from"./scroll-area-XA4Aq3a2.js";import{I as W}from"./input-CKNIOnpa.js";import{C as Ee}from"./chevron-right-8_zGT1Qv.js";import{C as ee}from"./chevron-down-CTcxn7D3.js";import{X as me}from"./index-CznuPdXa.js";import{F as se,C as B}from"./users-CJNt4qKT.js";import{F as ue,P as F}from"./plus-BvmWMub_.js";import{S as zs,a as Ss,b as Ms,c as Ds,d as Es,u as _s}from"./select-DcL9NSeY.js";import{U as _e}from"./user-CDLllFi1.js";import{C as ve}from"./clock-CzeeMNDe.js";import{T as Ie}from"./textarea-YxKrgQ6U.js";import{E as Te}from"./eye-dPsgE9Rb.js";import{P as he,c as Ne,a as Is}from"./index-Qf36hgnl.js";import{a as Ts,d as Ps}from"./index-K96IL8No.js";import{L as $}from"./link-2-Btskszyn.js";import{M as le}from"./mail-DC9xiueU.js";import{D as Ls,a as qs,b as Ks,c as ye}from"./dropdown-menu-BLWdwj2m.js";import{E as $s,T as Pe,a as Le,b as X,c as Y,d as Us,C as Rs}from"./calendar-event-card-CN0YX43d.js";import{D as As,a as Os,b as Ws,c as Bs,d as Fs,e as Vs}from"./dialog-Cq4tsCLN.js";import{L as Qs}from"./list-CihwikGH.js";import{N as Hs}from"./network-BfCBnC1K.js";var Gs=class extends cs{#s;#a=void 0;#e;#t;constructor(s,t){super(),this.#s=s,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(s){const t=this.options;this.options=this.#s.defaultMutationOptions(s),os(this.options,t)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&je(t.mutationKey)!==je(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(s){this.#i(),this.#n(s)}getCurrentResult(){return this.#a}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#n()}mutate(s,t){return this.#t=t,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(s)}#i(){const s=this.#e?.state??ds();this.#a={...s,isPending:s.status==="pending",isSuccess:s.status==="success",isError:s.status==="error",isIdle:s.status==="idle",mutate:this.mutate,reset:this.reset}}#n(s){Se.batch(()=>{if(this.#t&&this.hasListeners()){const t=this.#a.variables,a=this.#a.context,n={client:this.#s,meta:this.options.meta,mutationKey:this.options.mutationKey};if(s?.type==="success"){try{this.#t.onSuccess?.(s.data,t,a,n)}catch(l){Promise.reject(l)}try{this.#t.onSettled?.(s.data,null,t,a,n)}catch(l){Promise.reject(l)}}else if(s?.type==="error"){try{this.#t.onError?.(s.error,t,a,n)}catch(l){Promise.reject(l)}try{this.#t.onSettled?.(void 0,s.error,t,a,n)}catch(l){Promise.reject(l)}}}this.listeners.forEach(t=>{t(this.#a)})})}};function xe(s,t){const a=V(),[n]=x.useState(()=>new Gs(a,s));x.useEffect(()=>{n.setOptions(s)},[n,s]);const l=x.useSyncExternalStore(x.useCallback(o=>n.subscribe(Se.batchCalls(o)),[n]),()=>n.getCurrentResult(),()=>n.getCurrentResult()),i=x.useCallback((o,r)=>{n.mutate(o,r).catch(ms)},[n]);if(l.error&&us(n.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:i,mutateAsync:l.mutate}}const Xs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Ys=P("arrow-left",Xs);const Js=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Zs=P("arrow-right",Js);const et=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],st=P("bold",et);const tt=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],at=P("brain",tt);const it=[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]],nt=P("code",it);const rt=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],lt=P("external-link",rt);const ct=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],ot=P("italic",ct);const dt=[["path",{d:"M11 5h10",key:"1cz7ny"}],["path",{d:"M11 12h10",key:"1438ji"}],["path",{d:"M11 19h10",key:"11t30w"}],["path",{d:"M4 4h1v5",key:"10yrso"}],["path",{d:"M4 9h2",key:"r1h2o0"}],["path",{d:"M6.5 20H3.4c0-1 2.6-1.925 2.6-3.5a1.5 1.5 0 0 0-2.6-1.02",key:"xtkcd5"}]],mt=P("list-ordered",dt);const ut=[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ht=P("pen-line",ut);const xt=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],pt=P("pen",xt),L={all:["memories"],lists:()=>[...L.all,"list"],list:()=>[...L.lists()],forWorkItem:s=>[...L.all,"work-item",s]};function jt(s){return Me({queryKey:L.forWorkItem(s),queryFn:({signal:t})=>U.get(`/api/work-items/${s}/memories`,{signal:t}),enabled:!!s})}const J={all:["communications"],forWorkItem:s=>[...J.all,"work-item",s]};function ft(s){return Me({queryKey:J.forWorkItem(s),queryFn:({signal:t})=>U.get(`/api/work-items/${s}/communications`,{signal:t}),enabled:!!s})}function gt(){const s=V();return xe({mutationFn:({id:t,body:a})=>U.put(`/api/work-items/${t}`,a),onMutate:async({id:t,body:a})=>{await s.cancelQueries({queryKey:A.detail(t)});const n=s.getQueryData(A.detail(t));if(n){const l={...n,...a.title!==void 0?{title:a.title}:{},...a.status!==void 0?{status:a.status}:{},...a.priority!==void 0?{priority:a.priority}:{},...a.description!==void 0?{description:a.description}:{}};s.setQueryData(A.detail(t),l)}return{previousDetail:n}},onError:(t,{id:a},n)=>{n?.previousDetail&&s.setQueryData(A.detail(a),n.previousDetail)},onSettled:(t,a,{id:n})=>{s.invalidateQueries({queryKey:A.detail(n)}),s.invalidateQueries({queryKey:A.lists()}),s.invalidateQueries({queryKey:A.tree()})}})}function vt(){const s=V();return xe({mutationFn:({workItemId:t,body:a})=>U.post(`/api/work-items/${t}/memories`,a),onSuccess:(t,{workItemId:a})=>{s.invalidateQueries({queryKey:L.forWorkItem(a)}),s.invalidateQueries({queryKey:L.lists()})}})}function Nt(){const s=V();return xe({mutationFn:({id:t,body:a})=>U.patch(`/api/memories/${t}`,a),onSuccess:(t,{workItemId:a})=>{s.invalidateQueries({queryKey:L.lists()}),a&&s.invalidateQueries({queryKey:L.forWorkItem(a)})}})}function yt(s){switch(s){case"project":return e.jsx(ue,{className:"size-5"});case"initiative":return e.jsx(de,{className:"size-5"});case"epic":return e.jsx(oe,{className:"size-5"});case"issue":return e.jsx(se,{className:"size-5"})}}function bt(s){return s.charAt(0).toUpperCase()+s.slice(1)}function kt(s){switch(s){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function Ct(s){return s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}function wt({title:s,kind:t,status:a,parentTitle:n,onTitleChange:l,onParentClick:i,onDelete:o,className:r}){const[m,p]=x.useState(!1),[d,h]=x.useState(s),j=()=>{h(s),p(!0)},N=()=>{d.trim()&&d!==s&&l?.(d.trim()),p(!1)},z=()=>{h(s),p(!1)},y=v=>{v.key==="Enter"?N():v.key==="Escape"&&z()};return e.jsxs("div",{className:M("space-y-2",r),children:[n&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx("button",{className:"hover:text-foreground hover:underline",onClick:i,children:n}),e.jsx(Ee,{className:"size-4"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"mt-1 text-muted-foreground",children:yt(t)}),e.jsxs("div",{className:"min-w-0 flex-1 space-y-2",children:[m?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{value:d,onChange:v=>h(v.target.value),onKeyDown:y,autoFocus:!0,className:"text-xl font-semibold"}),e.jsxs(u,{variant:"ghost",size:"icon",onClick:N,children:[e.jsx(ee,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Save"})]}),e.jsxs(u,{variant:"ghost",size:"icon",onClick:z,children:[e.jsx(me,{className:"size-4"}),e.jsx("span",{className:"sr-only",children:"Cancel"})]})]}):e.jsxs("div",{className:"group flex items-start gap-2",children:[e.jsx("h1",{className:"text-xl font-semibold",children:s}),l&&e.jsxs(u,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 group-hover:opacity-100",onClick:j,children:[e.jsx(Z,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Edit title"})]}),o&&e.jsxs(u,{variant:"ghost",size:"icon",className:"mt-0.5 size-6 opacity-0 text-destructive hover:text-destructive group-hover:opacity-100",onClick:o,children:[e.jsx(ce,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(T,{variant:"outline",children:bt(t)}),e.jsx(T,{variant:kt(a),children:Ct(a)})]})]})]})]})}function be(s){return s?s.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"Not set"}function ke(s){if(!s)return"Not set";if(s<60)return`${s}m`;const t=Math.floor(s/60),a=s%60;return a>0?`${t}h ${a}m`:`${t}h`}function O({icon:s,label:t,value:a,editable:n,onEdit:l,editType:i="text",options:o}){const[r,m]=x.useState(!1),[p,d]=x.useState(a),h=()=>{l?.(p),m(!1)},j=()=>{d(a),m(!1)};return e.jsxs("div",{className:"flex items-start gap-3 rounded-md p-2 hover:bg-muted/50",children:[e.jsx("span",{className:"mt-0.5 text-muted-foreground",children:s}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:t}),r?e.jsxs("div",{className:"mt-1 flex items-center gap-1",children:[i==="select"&&o?e.jsxs(zs,{value:p,onValueChange:d,children:[e.jsx(Ss,{className:"h-8 text-sm",children:e.jsx(Ms,{})}),e.jsx(Ds,{children:o.map(N=>e.jsx(Es,{value:N.value,children:N.label},N.value))})]}):i==="date"?e.jsx(W,{type:"date",value:p,onChange:N=>d(N.target.value),className:"h-8 text-sm"}):e.jsx(W,{type:i==="number"?"number":"text",value:p,onChange:N=>d(N.target.value),className:"h-8 text-sm"}),e.jsx(u,{variant:"ghost",size:"icon",className:"size-6",onClick:h,children:e.jsx(ee,{className:"size-3"})}),e.jsx(u,{variant:"ghost",size:"icon",className:"size-6",onClick:j,children:e.jsx(me,{className:"size-3"})})]}):e.jsxs("div",{className:"group flex items-center gap-1",children:[e.jsx("p",{className:"text-sm",children:a}),n&&l&&e.jsx(u,{variant:"ghost",size:"icon",className:"size-5 opacity-0 group-hover:opacity-100",onClick:()=>m(!0),children:e.jsx(Z,{className:"size-3"})})]})]})]})}const Ce=[{value:"not_started",label:"Not Started"},{value:"in_progress",label:"In Progress"},{value:"blocked",label:"Blocked"},{value:"done",label:"Done"},{value:"cancelled",label:"Cancelled"}],we=[{value:"urgent",label:"Urgent"},{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}];function zt({status:s,priority:t,assignee:a,dueDate:n,startDate:l,estimateMinutes:i,actualMinutes:o,onStatusChange:r,onPriorityChange:m,onAssigneeChange:p,onDueDateChange:d,onStartDateChange:h,onEstimateChange:j,onActualChange:N,className:z}){const y=f=>we.find(C=>C.value===f)?.label??f,v=f=>Ce.find(C=>C.value===f)?.label??f;return e.jsxs("div",{className:M("grid gap-1 sm:grid-cols-2",z),children:[e.jsx(O,{icon:e.jsx(fe,{className:"size-4"}),label:"Status",value:v(s),editable:!!r,onEdit:f=>r?.(f),editType:"select",options:Ce}),e.jsx(O,{icon:e.jsx(fe,{className:"size-4"}),label:"Priority",value:y(t),editable:!!m,onEdit:f=>m?.(f),editType:"select",options:we}),e.jsx(O,{icon:e.jsx(_e,{className:"size-4"}),label:"Assignee",value:a||"Unassigned",editable:!!p,onEdit:p}),e.jsx(O,{icon:e.jsx(B,{className:"size-4"}),label:"Due Date",value:be(n),editable:!!d,onEdit:d,editType:"date"}),e.jsx(O,{icon:e.jsx(B,{className:"size-4"}),label:"Start Date",value:be(l),editable:!!h,onEdit:h,editType:"date"}),e.jsx(O,{icon:e.jsx(ve,{className:"size-4"}),label:"Estimate",value:ke(i),editable:!!j,onEdit:j,editType:"number"}),e.jsx(O,{icon:e.jsx(ve,{className:"size-4"}),label:"Actual",value:ke(o),editable:!!N,onEdit:N,editType:"number"})]})}function St({description:s,onDescriptionChange:t,className:a}){const[n,l]=x.useState(!1),[i,o]=x.useState(s||""),[r,m]=x.useState(!1),p=()=>{o(s||""),l(!0),m(!1)},d=()=>{t?.(i),l(!1)},h=()=>{o(s||""),l(!1),m(!1)},j=N=>N?N.split(`
`).map((y,v)=>{if(y.startsWith("### "))return e.jsx("h4",{className:"mt-4 mb-2 text-sm font-semibold",children:y.slice(4)},v);if(y.startsWith("## "))return e.jsx("h3",{className:"mt-4 mb-2 font-semibold",children:y.slice(3)},v);if(y.startsWith("# "))return e.jsx("h2",{className:"mt-4 mb-2 text-lg font-semibold",children:y.slice(2)},v);if(y.startsWith("- ")||y.startsWith("* "))return e.jsx("li",{className:"ml-4",children:y.slice(2)},v);if(!y.trim())return e.jsx("br",{},v);const f=C=>{const D=[];let b=C,I=0;for(;b.length>0;){const g=b.match(/^`([^`]+)`/);if(g){D.push(e.jsx("code",{className:"rounded bg-muted px-1 text-sm",children:g[1]},I++)),b=b.slice(g[0].length);continue}const k=b.match(/^\*\*([^*]+)\*\*/);if(k){D.push(e.jsx("strong",{children:k[1]},I++)),b=b.slice(k[0].length);continue}const S=b.match(/^\*([^*]+)\*/);if(S){D.push(e.jsx("em",{children:S[1]},I++)),b=b.slice(S[0].length);continue}const w=b.search(/[`*]/);if(w===-1){D.push(b);break}else w===0?(D.push(b[0]),b=b.slice(1)):(D.push(b.slice(0,w)),b=b.slice(w))}return D};return e.jsx("p",{className:"my-1",children:f(y)},v)}):null;return e.jsxs("div",{className:M("space-y-3",a),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Description"}),!n&&t&&e.jsxs(u,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:p,children:[e.jsx(Z,{className:"size-3"}),"Edit"]}),n&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(u,{variant:"ghost",size:"sm",className:M("h-7 gap-1",!r&&"bg-muted"),onClick:()=>m(!1),children:[e.jsx(pt,{className:"size-3"}),"Edit"]}),e.jsxs(u,{variant:"ghost",size:"sm",className:M("h-7 gap-1",r&&"bg-muted"),onClick:()=>m(!0),children:[e.jsx(Te,{className:"size-3"}),"Preview"]})]})]}),n?e.jsxs("div",{className:"space-y-3",children:[r?e.jsx("div",{className:"min-h-32 rounded-md border bg-muted/30 p-3 text-sm",children:i?j(i):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})}):e.jsx(Ie,{value:i,onChange:N=>o(N.target.value),placeholder:"Add a description... (Markdown supported)",className:"min-h-32 font-mono text-sm"}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(u,{variant:"ghost",size:"sm",onClick:h,children:[e.jsx(me,{className:"mr-1 size-3"}),"Cancel"]}),e.jsxs(u,{size:"sm",onClick:d,children:[e.jsx(ee,{className:"mr-1 size-3"}),"Save"]})]})]}):s?e.jsx("div",{className:"prose prose-sm max-w-none rounded-md bg-muted/30 p-3",children:j(s)}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No description"})]})}var te="Checkbox",[Mt]=Is(te),[Dt,pe]=Mt(te);function Et(s){const{__scopeCheckbox:t,checked:a,children:n,defaultChecked:l,disabled:i,form:o,name:r,onCheckedChange:m,required:p,value:d="on",internal_do_not_use_render:h}=s,[j,N]=Ts({prop:a,defaultProp:l??!1,onChange:m,caller:te}),[z,y]=x.useState(null),[v,f]=x.useState(null),C=x.useRef(!1),D=z?!!o||!!z.closest("form"):!0,b={checked:j,disabled:i,setChecked:N,control:z,setControl:y,name:r,form:o,value:d,hasConsumerStoppedPropagationRef:C,required:p,defaultChecked:R(l)?!1:l,isFormControl:D,bubbleInput:v,setBubbleInput:f};return e.jsx(Dt,{scope:t,...b,children:_t(h)?h(b):n})}var qe="CheckboxTrigger",Ke=x.forwardRef(({__scopeCheckbox:s,onKeyDown:t,onClick:a,...n},l)=>{const{control:i,value:o,disabled:r,checked:m,required:p,setControl:d,setChecked:h,hasConsumerStoppedPropagationRef:j,isFormControl:N,bubbleInput:z}=pe(qe,s),y=De(l,d),v=x.useRef(m);return x.useEffect(()=>{const f=i?.form;if(f){const C=()=>h(v.current);return f.addEventListener("reset",C),()=>f.removeEventListener("reset",C)}},[i,h]),e.jsx(he.button,{type:"button",role:"checkbox","aria-checked":R(m)?"mixed":m,"aria-required":p,"data-state":We(m),"data-disabled":r?"":void 0,disabled:r,value:o,...n,ref:y,onKeyDown:Ne(t,f=>{f.key==="Enter"&&f.preventDefault()}),onClick:Ne(a,f=>{h(C=>R(C)?!0:!C),z&&N&&(j.current=f.isPropagationStopped(),j.current||f.stopPropagation())})})});Ke.displayName=qe;var $e=x.forwardRef((s,t)=>{const{__scopeCheckbox:a,name:n,checked:l,defaultChecked:i,required:o,disabled:r,value:m,onCheckedChange:p,form:d,...h}=s;return e.jsx(Et,{__scopeCheckbox:a,checked:l,defaultChecked:i,disabled:r,required:o,onCheckedChange:p,name:n,form:d,value:m,internal_do_not_use_render:({isFormControl:j})=>e.jsxs(e.Fragment,{children:[e.jsx(Ke,{...h,ref:t,__scopeCheckbox:a}),j&&e.jsx(Oe,{__scopeCheckbox:a})]})})});$e.displayName=te;var Ue="CheckboxIndicator",Re=x.forwardRef((s,t)=>{const{__scopeCheckbox:a,forceMount:n,...l}=s,i=pe(Ue,a);return e.jsx(Cs,{present:n||R(i.checked)||i.checked===!0,children:e.jsx(he.span,{"data-state":We(i.checked),"data-disabled":i.disabled?"":void 0,...l,ref:t,style:{pointerEvents:"none",...s.style}})})});Re.displayName=Ue;var Ae="CheckboxBubbleInput",Oe=x.forwardRef(({__scopeCheckbox:s,...t},a)=>{const{control:n,hasConsumerStoppedPropagationRef:l,checked:i,defaultChecked:o,required:r,disabled:m,name:p,value:d,form:h,bubbleInput:j,setBubbleInput:N}=pe(Ae,s),z=De(a,N),y=_s(i),v=Ps(n);x.useEffect(()=>{const C=j;if(!C)return;const D=window.HTMLInputElement.prototype,I=Object.getOwnPropertyDescriptor(D,"checked").set,g=!l.current;if(y!==i&&I){const k=new Event("click",{bubbles:g});C.indeterminate=R(i),I.call(C,R(i)?!1:i),C.dispatchEvent(k)}},[j,y,i,l]);const f=x.useRef(R(i)?!1:i);return e.jsx(he.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??f.current,required:r,disabled:m,name:p,value:d,form:h,...t,tabIndex:-1,ref:z,style:{...t.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});Oe.displayName=Ae;function _t(s){return typeof s=="function"}function R(s){return s==="indeterminate"}function We(s){return R(s)?"indeterminate":s?"checked":"unchecked"}function It({className:s,...t}){return e.jsx($e,{"data-slot":"checkbox",className:M("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Re,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:e.jsx(ee,{className:"size-3.5"})})})}function Tt({todos:s,onAdd:t,onToggle:a,onDelete:n,className:l}){const[i,o]=x.useState(""),r=()=>{i.trim()&&t&&(t(i.trim()),o(""))},m=d=>{d.key==="Enter"&&r()},p=s.filter(d=>d.completed).length;return e.jsxs("div",{className:M("space-y-3",l),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Checklist"}),s.length>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:[p,"/",s.length," completed"]})]}),s.length>0&&e.jsx("div",{className:"h-1.5 overflow-hidden rounded-full bg-muted",children:e.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${p/s.length*100}%`}})}),e.jsx("div",{className:"space-y-1",children:s.map(d=>e.jsxs("div",{"data-testid":"todo-item",className:M("group flex items-center gap-2 rounded-md px-2 py-1.5","hover:bg-muted/50"),children:[e.jsx(xs,{className:"size-4 cursor-grab text-muted-foreground opacity-0 group-hover:opacity-100"}),e.jsx(It,{checked:d.completed,onCheckedChange:h=>a?.(d.id,h===!0),"aria-label":`Mark "${d.text}" as ${d.completed?"incomplete":"complete"}`}),e.jsx("span",{className:M("flex-1 text-sm",d.completed&&"text-muted-foreground line-through"),children:d.text}),n&&e.jsxs(u,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:()=>n(d.id),children:[e.jsx(ce,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Delete"})]})]},d.id))}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"size-4 text-muted-foreground"}),e.jsx(W,{value:i,onChange:d=>o(d.target.value),onKeyDown:m,placeholder:"Add a task...",className:"h-8 flex-1"}),e.jsx(u,{variant:"ghost",size:"sm",onClick:r,disabled:!i.trim(),children:"Add"})]}),s.length===0&&!t&&e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No tasks yet"})]})}function Pt(s){switch(s){case"memory":return e.jsx(at,{className:"size-4"});case"contact":return e.jsx(_e,{className:"size-4"});case"email":return e.jsx(le,{className:"size-4"});case"calendar":return e.jsx(B,{className:"size-4"})}}function Lt(s){switch(s){case"memory":return"Memory";case"contact":return"Contact";case"email":return"Email";case"calendar":return"Event"}}function qt({attachments:s,onAttachmentClick:t,onLinkNew:a,className:n}){const l=x.useMemo(()=>{const o={memory:[],contact:[],email:[],calendar:[]};for(const r of s)o[r.type].push(r);return o},[s]),i=s.length>0;return e.jsxs("div",{className:M("space-y-4",n),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Linked Items"}),a&&e.jsxs(u,{variant:"ghost",size:"sm",className:"h-7 gap-1",onClick:a,children:[e.jsx($,{className:"size-3"}),"Link"]})]}),i?e.jsx("div",{className:"space-y-4",children:Object.entries(l).filter(([o,r])=>r.length>0).map(([o,r])=>e.jsxs("div",{children:[e.jsxs("h4",{className:"mb-2 flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[Pt(o),Lt(o),"s (",r.length,")"]}),e.jsx("div",{className:"space-y-1",children:r.map(m=>e.jsxs("button",{"data-testid":"attachment-item",className:M("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",t&&"cursor-pointer"),onClick:()=>t?.(m),children:[e.jsxs("span",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"block truncate text-sm",children:m.title}),m.subtitle&&e.jsx("span",{className:"block truncate text-xs text-muted-foreground",children:m.subtitle})]}),t&&e.jsx(lt,{className:"size-3 shrink-0 text-muted-foreground"})]},m.id))})]},o))}):e.jsx("p",{className:"py-4 text-center text-sm text-muted-foreground",children:"No linked items"})]})}function Kt(s){switch(s){case"project":return e.jsx(ue,{className:"size-4"});case"initiative":return e.jsx(de,{className:"size-4"});case"epic":return e.jsx(oe,{className:"size-4"});case"issue":return e.jsx(se,{className:"size-4"})}}function $t(s){switch(s){case"in_progress":return"default";case"done":return"secondary";case"blocked":return"destructive";default:return"outline"}}function Ut(s){return s.replace("_"," ").replace(/\b\w/g,t=>t.toUpperCase())}function Rt({dependencies:s,onDependencyClick:t,onAddDependency:a,className:n}){const l=s.filter(r=>r.direction==="blocked_by"),i=s.filter(r=>r.direction==="blocks"),o=r=>e.jsxs("button",{"data-testid":"dependency-item",className:M("flex w-full items-center gap-2 rounded-md px-2 py-1.5 text-left","hover:bg-muted/50",t&&"cursor-pointer"),onClick:()=>t?.(r),children:[e.jsx("span",{className:"text-muted-foreground",children:Kt(r.kind)}),e.jsx("span",{className:"min-w-0 flex-1 truncate text-sm",children:r.title}),e.jsx(T,{variant:$t(r.status),className:"shrink-0 text-xs",children:Ut(r.status)})]},r.id);return e.jsxs("div",{className:M("space-y-4",n),children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(Ys,{className:"size-4"}),"Blocked by (",l.length,")"]}),a&&e.jsxs(u,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocked_by"),children:[e.jsx(F,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add blocker"})]})]}),l.length>0?e.jsx("div",{className:"space-y-1",children:l.map(o)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No blockers"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsxs("h4",{className:"flex items-center gap-2 text-xs font-medium text-muted-foreground",children:[e.jsx(Zs,{className:"size-4"}),"Blocks (",i.length,")"]}),a&&e.jsxs(u,{variant:"ghost",size:"icon",className:"size-6",onClick:()=>a("blocks"),children:[e.jsx(F,{className:"size-3"}),e.jsx("span",{className:"sr-only",children:"Add dependent"})]})]}),i.length>0?e.jsx("div",{className:"space-y-1",children:i.map(o)}):e.jsx("p",{className:"py-2 text-center text-xs text-muted-foreground",children:"No dependents"})]})]})}function At({item:s,onTitleChange:t,onDescriptionChange:a,onStatusChange:n,onPriorityChange:l,onAssigneeChange:i,onDueDateChange:o,onStartDateChange:r,onEstimateChange:m,onActualChange:p,onTodoAdd:d,onTodoToggle:h,onTodoDelete:j,onAttachmentClick:N,onLinkAttachment:z,onDependencyClick:y,onAddDependency:v,onParentClick:f,onDelete:C,className:D}){return e.jsx("div",{className:M("flex h-full flex-col",D),children:e.jsx(ws,{className:"flex-1",children:e.jsxs("div",{className:"mx-auto max-w-4xl space-y-6 p-6",children:[e.jsx(wt,{title:s.title,kind:s.kind,status:s.status,parentTitle:s.parentTitle,onTitleChange:t,onParentClick:f,onDelete:C}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-3",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-2",children:[e.jsx(q,{children:e.jsx(K,{className:"pt-4",children:e.jsx(zt,{status:s.status,priority:s.priority,assignee:s.assignee,dueDate:s.dueDate,startDate:s.startDate,estimateMinutes:s.estimateMinutes,actualMinutes:s.actualMinutes,onStatusChange:n,onPriorityChange:l,onAssigneeChange:i,onDueDateChange:o,onStartDateChange:r,onEstimateChange:m,onActualChange:p})})}),e.jsx(q,{children:e.jsx(K,{className:"pt-4",children:e.jsx(St,{description:s.description,onDescriptionChange:a})})}),e.jsx(q,{children:e.jsx(K,{className:"pt-4",children:e.jsx(Tt,{todos:s.todos,onAdd:d,onToggle:h,onDelete:j})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{children:e.jsx(K,{className:"pt-4",children:e.jsx(qt,{attachments:s.attachments,onAttachmentClick:N,onLinkNew:z})})}),e.jsx(q,{children:e.jsx(K,{className:"pt-4",children:e.jsx(Rt,{dependencies:s.dependencies,onDependencyClick:y,onAddDependency:v})})})]})]})]})})})}function Ot(s){switch(s){case"project":return e.jsx(ue,{className:"size-3"});case"initiative":return e.jsx(de,{className:"size-3"});case"epic":return e.jsx(oe,{className:"size-3"});case"issue":return e.jsx(se,{className:"size-3"});default:return null}}function Wt({memory:s,onClick:t,onEdit:a,onDelete:n,className:l}){const i=s.content.slice(0,150)+(s.content.length>150?"...":"");return e.jsxs("div",{"data-testid":"memory-card",className:M("group relative rounded-lg border bg-card p-4 transition-colors hover:bg-accent/50",t&&"cursor-pointer",l),onClick:()=>t?.(s),children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-medium leading-tight",children:s.title}),(a||n)&&e.jsxs(Ls,{children:[e.jsx(qs,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"icon",className:"size-6 opacity-0 group-hover:opacity-100",onClick:o=>o.stopPropagation(),children:e.jsx($s,{className:"size-4"})})}),e.jsxs(Ks,{align:"end",children:[a&&e.jsxs(ye,{onClick:o=>{o.stopPropagation(),a(s)},children:[e.jsx(Z,{className:"mr-2 size-4"}),"Edit"]}),n&&e.jsxs(ye,{className:"text-destructive focus:text-destructive",onClick:o=>{o.stopPropagation(),n(s)},children:[e.jsx(ce,{className:"mr-2 size-4"}),"Delete"]})]})]})]}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground line-clamp-2",children:i}),e.jsxs("div",{className:"mt-3 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("div",{className:"flex items-center gap-2",children:s.linkedItemKind&&s.linkedItemTitle&&e.jsxs("span",{className:"flex items-center gap-1",children:[Ot(s.linkedItemKind),e.jsx("span",{className:"truncate max-w-[120px]",children:s.linkedItemTitle})]})}),e.jsx("span",{children:s.updatedAt.toLocaleDateString()})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.tags.map(o=>e.jsx(T,{variant:"secondary",className:"text-xs",children:o},o))})]})}function Bt({memories:s,onMemoryClick:t,onAddMemory:a,onLinkMemory:n,onEditMemory:l,onDeleteMemory:i,className:o}){return e.jsxs("div",{className:M("space-y-4",o),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Memories"}),e.jsx(T,{variant:"secondary",className:"text-xs",children:s.length})]}),e.jsxs("div",{className:"flex gap-1",children:[n&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:n,children:[e.jsx($,{className:"mr-1 size-3"}),"Link"]}),a&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:a,children:[e.jsx(F,{className:"mr-1 size-3"}),"Add"]})]})]}),s.length>0?e.jsx("div",{className:"grid gap-2 sm:grid-cols-2",children:s.map(r=>e.jsx(Wt,{memory:r,onClick:t,onEdit:l,onDelete:i},r.id))}):e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx(se,{className:"mx-auto size-8 text-muted-foreground/50"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"No memories attached"}),(a||n)&&e.jsxs("div",{className:"mt-3 flex justify-center gap-2",children:[a&&e.jsxs(u,{variant:"outline",size:"sm",onClick:a,children:[e.jsx(F,{className:"mr-1 size-3"}),"Create new"]}),n&&e.jsxs(u,{variant:"outline",size:"sm",onClick:n,children:[e.jsx($,{className:"mr-1 size-3"}),"Link existing"]})]})]})]})}function Ft({memory:s,open:t,onOpenChange:a,onSubmit:n,className:l}){const[i,o]=x.useState(s?.title??""),[r,m]=x.useState(s?.content??""),[p,d]=x.useState(""),[h,j]=x.useState(s?.tags??[]),[N,z]=x.useState("edit"),y=x.useRef(null),v=x.useCallback((g,k="")=>{const S=y.current;if(!S)return;const w=S.selectionStart,Q=S.selectionEnd,H=r.slice(w,Q),ae=r.slice(0,w)+g+(H||"text")+k+r.slice(Q);m(ae),setTimeout(()=>{S.focus();const _=w+g.length,ie=_+(H||"text").length;S.setSelectionRange(_,ie)},0)},[r]),f=()=>{const g=p.trim();g&&!h.includes(g)&&(j([...h,g]),d(""))},C=g=>{j(h.filter(k=>k!==g))},D=g=>{g.preventDefault(),n({title:i.trim(),content:r.trim(),tags:h.length>0?h:void 0})},b=i.trim()&&r.trim(),I=g=>g.split(`
`).map((k,S)=>k.startsWith("### ")?e.jsx("h3",{className:"text-lg font-semibold mt-4 mb-2",children:k.slice(4)},S):k.startsWith("## ")?e.jsx("h2",{className:"text-xl font-semibold mt-4 mb-2",children:k.slice(3)},S):k.startsWith("# ")?e.jsx("h1",{className:"text-2xl font-bold mt-4 mb-2",children:k.slice(2)},S):k.startsWith("- ")||k.startsWith("* ")?e.jsx("li",{className:"ml-4",children:k.slice(2)},S):/^\d+\. /.test(k)?e.jsx("li",{className:"ml-4 list-decimal",children:k.replace(/^\d+\. /,"")},S):k.trim()?e.jsx("p",{className:"my-1",children:k},S):e.jsx("br",{},S));return e.jsx(As,{open:t,onOpenChange:a,children:e.jsxs(Os,{className:M("sm:max-w-2xl",l),children:[e.jsxs(Ws,{children:[e.jsx(Bs,{children:s?"Edit Memory":"Create Memory"}),e.jsx(Fs,{className:"sr-only",children:s?"Edit memory details":"Create a new memory entry"})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"memory-title",className:"text-sm font-medium",children:["Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(W,{id:"memory-title",value:i,onChange:g=>o(g.target.value),placeholder:"Memory title",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("label",{className:"text-sm font-medium",children:["Content ",e.jsx("span",{className:"text-destructive",children:"*"})]})}),e.jsxs(Pe,{value:N,onValueChange:g=>z(g),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("**","**"),title:"Bold",children:e.jsx(st,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("*","*"),title:"Italic",children:e.jsx(ot,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("- "),title:"Bullet list",children:e.jsx(Qs,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("1. "),title:"Numbered list",children:e.jsx(mt,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("[","](url)"),title:"Link",children:e.jsx($,{className:"size-4"})}),e.jsx(u,{type:"button",variant:"ghost",size:"icon",className:"size-8",onClick:()=>v("`","`"),title:"Code",children:e.jsx(nt,{className:"size-4"})})]}),e.jsxs(Le,{children:[e.jsxs(X,{value:"edit",className:"gap-1",children:[e.jsx(ht,{className:"size-3"}),"Edit"]}),e.jsxs(X,{value:"preview",className:"gap-1",children:[e.jsx(Te,{className:"size-3"}),"Preview"]})]})]}),e.jsx(Y,{value:"edit",className:"mt-2",children:e.jsx(Ie,{ref:y,value:r,onChange:g=>m(g.target.value),placeholder:"Write your memory content here... (Markdown supported)",className:"min-h-[200px] font-mono text-sm",required:!0})}),e.jsx(Y,{value:"preview",className:"mt-2",children:e.jsx("div",{className:"min-h-[200px] rounded-md border bg-muted/30 p-4 text-sm",children:r?e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:I(r)}):e.jsx("p",{className:"text-muted-foreground",children:"Nothing to preview"})})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"memory-tags",className:"text-sm font-medium",children:"Tags"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(W,{id:"memory-tags",value:p,onChange:g=>d(g.target.value),placeholder:"Add a tag",onKeyDown:g=>{g.key==="Enter"&&(g.preventDefault(),f())}}),e.jsx(u,{type:"button",variant:"outline",onClick:f,children:"Add"})]}),h.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:h.map(g=>e.jsxs(T,{variant:"secondary",className:"cursor-pointer",onClick:()=>C(g),children:[g," Ã—"]},g))})]}),e.jsxs(Vs,{children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(u,{type:"submit",disabled:!b,children:s?"Save Changes":"Create Memory"})]})]})]})})}function Vt({emails:s,calendarEvents:t,onEmailClick:a,onEventClick:n,onUnlinkEmail:l,onUnlinkEvent:i,onLinkEmail:o,onLinkEvent:r,className:m}){const[p,d]=x.useState("emails"),h=s.length+t.length;return e.jsxs("div",{className:M("space-y-4",m),children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Communications"}),e.jsx(T,{variant:"secondary",className:"text-xs",children:h})]})}),e.jsxs(Pe,{value:p,onValueChange:j=>d(j),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Le,{children:[e.jsxs(X,{value:"emails",className:"gap-1",children:[e.jsx(le,{className:"size-3"}),"Emails",s.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:s.length})]}),e.jsxs(X,{value:"calendar",className:"gap-1",children:[e.jsx(B,{className:"size-3"}),"Calendar",t.length>0&&e.jsx(T,{variant:"secondary",className:"ml-1 text-[10px] px-1",children:t.length})]})]}),p==="emails"&&o&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:o,children:[e.jsx($,{className:"mr-1 size-3"}),"Link Email"]}),p==="calendar"&&r&&e.jsxs(u,{variant:"ghost",size:"sm",onClick:r,children:[e.jsx($,{className:"mr-1 size-3"}),"Link Event"]})]}),e.jsx(Y,{value:"emails",className:"mt-4",children:s.length>0?e.jsx("div",{className:"space-y-2",children:s.map(j=>e.jsx(Us,{email:j,onClick:a,onUnlink:l},j.id))}):e.jsx(ze,{icon:e.jsx(le,{className:"size-8"}),message:"No linked emails",action:o&&e.jsxs(u,{variant:"outline",size:"sm",onClick:o,children:[e.jsx($,{className:"mr-1 size-3"}),"Link an email"]})})}),e.jsx(Y,{value:"calendar",className:"mt-4",children:t.length>0?e.jsx("div",{className:"space-y-2",children:t.map(j=>e.jsx(Rs,{event:j,onClick:n,onUnlink:i},j.id))}):e.jsx(ze,{icon:e.jsx(B,{className:"size-8"}),message:"No linked calendar events",action:r&&e.jsxs(u,{variant:"outline",size:"sm",onClick:r,children:[e.jsx($,{className:"mr-1 size-3"}),"Link an event"]})})})]})]})}function ze({icon:s,message:t,action:a}){return e.jsxs("div",{className:"rounded-lg border border-dashed p-6 text-center",children:[e.jsx("div",{className:"mx-auto text-muted-foreground/50",children:s}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:t}),a&&e.jsx("div",{className:"mt-3",children:a})]})}function ka(){const{id:s}=hs(),t=s??"",a=V(),l=Ns()?.participants??[],{data:i,isLoading:o,error:r}=ps(t),{data:m,isLoading:p}=jt(t),{data:d,isLoading:h}=ft(t),j=gt(),N=vt(),z=Nt(),[y,v]=x.useState(!1),[f,C]=x.useState(null),[D,b]=x.useState(!1),{deleteItem:I,isDeleting:g,undoState:k,dismissUndo:S}=js({onDeleted:()=>{window.location.href="/app/work-items"}}),w=i?(()=>{const c=[];return i.dependencies?.blocks&&c.push(...i.dependencies.blocks.map(E=>({id:E.id,title:E.title,kind:"issue",status:"not_started",direction:"blocks"}))),i.dependencies?.blocked_by&&c.push(...i.dependencies.blocked_by.map(E=>({id:E.id,title:E.title,kind:"issue",status:"not_started",direction:"blocked_by"}))),{id:i.id,title:i.title,kind:i.kind||"issue",status:i.status||"not_started",priority:ys(i.priority),description:i.description||void 0,parentId:i.parent_id||void 0,parentTitle:i.parent?.title,estimateMinutes:i.estimate_minutes||void 0,actualMinutes:i.actual_minutes||void 0,dueDate:i.not_after?new Date(i.not_after):void 0,startDate:i.not_before?new Date(i.not_before):void 0,createdAt:new Date(i.created_at),updatedAt:new Date(i.updated_at),todos:[],attachments:[],dependencies:c}})():null,Q=(m?.memories??[]).map(c=>({id:c.id,title:c.title,content:c.content,linkedItemId:t,linkedItemTitle:w?.title||void 0,linkedItemKind:w?.kind||"issue",createdAt:new Date(c.created_at),updatedAt:new Date(c.updated_at)})),H=(d?.emails??[]).map(c=>({id:c.id,subject:"Email",from:{name:"Unknown",email:""},to:[],date:c.received_at?new Date(c.received_at):new Date,snippet:c.body?.substring(0,100)||"",body:c.body||void 0})),ae=(d?.calendar_events??[]).map(c=>({id:c.id,title:"Calendar Event",startTime:c.received_at?new Date(c.received_at):new Date,endTime:c.received_at?new Date(c.received_at):new Date,attendees:[]})),_=x.useCallback(c=>{j.mutate({id:t,body:c})},[t,j]),ie=c=>_({title:c}),Be=c=>_({description:c}),Fe=c=>_({status:c}),Ve=c=>_({priority:bs(c)}),Qe=c=>_({notAfter:c||null}),He=c=>_({notBefore:c||null}),Ge=c=>{const E=parseInt(c,10);_({estimateMinutes:isNaN(E)?null:E})},Xe=c=>{const E=parseInt(c,10);_({actualMinutes:isNaN(E)?null:E})},Ye=()=>{w?.parentId&&(window.location.href=`/app/work-items/${w.parentId}`)},Je=c=>{window.location.href=`/app/work-items/${c.id}`},Ze=()=>{C(null),v(!0)},es=c=>{C(c),v(!0)},ss=c=>{N.mutate({workItemId:t,body:{title:c.title,content:c.content,type:"note"}},{onSuccess:()=>v(!1)})},ts=c=>{f&&z.mutate({id:f.id,body:{title:c.title,content:c.content},workItemId:t},{onSuccess:()=>{v(!1),C(null)}})},as=async c=>{if(confirm(`Delete memory "${c.title}"?`))try{await U.delete(`/api/memories/${c.id}`),a.invalidateQueries({queryKey:L.forWorkItem(t)})}catch{}},is=async c=>{if(confirm("Unlink this email from the work item?"))try{await U.delete(`/api/work-items/${t}/communications/${c.id}`),a.invalidateQueries({queryKey:J.forWorkItem(t)})}catch{}},ns=async c=>{if(confirm("Unlink this event from the work item?"))try{await U.delete(`/api/work-items/${t}/communications/${c.id}`),a.invalidateQueries({queryKey:J.forWorkItem(t)})}catch{}},rs=()=>b(!0),ls=async()=>{w&&(await I({id:w.id,title:w.title}),b(!1))};return o?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(ks,{})}):r||!w?e.jsx("div",{"data-testid":"page-work-item-detail",className:"p-6",children:e.jsx(vs,{title:"Work Item Not Found",message:r instanceof Error?r.message:"The requested work item could not be loaded.",action:e.jsx(u,{variant:"outline",asChild:!0,children:e.jsx(G,{to:"/work-items",children:"Back to Work Items"})})})}):e.jsxs("div",{"data-testid":"page-work-item-detail",className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b flex items-center gap-4",children:[e.jsx(u,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(G,{to:"/work-items",children:[e.jsx(Ee,{className:"mr-1 size-4 rotate-180"}),"Back"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(G,{to:`/work-items/${t}/timeline`,children:[e.jsx(B,{className:"mr-2 size-4"}),"Timeline"]})}),e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(G,{to:`/work-items/${t}/graph`,children:[e.jsx(Hs,{className:"mr-2 size-4"}),"Dependencies"]})})]})]}),e.jsx(At,{item:w,onTitleChange:ie,onDescriptionChange:Be,onStatusChange:Fe,onPriorityChange:Ve,onDueDateChange:Qe,onStartDateChange:He,onEstimateChange:Ge,onActualChange:Xe,onParentClick:Ye,onDependencyClick:Je,onDelete:rs,className:"flex-1"}),e.jsxs("div",{className:"p-6 space-y-6 border-t",children:[e.jsxs(q,{children:[e.jsx(ne,{children:e.jsx(re,{className:"text-lg",children:"Memories"})}),e.jsx(K,{children:p?e.jsx(ge,{width:"100%",height:100}):e.jsx(Bt,{memories:Q,onAddMemory:Ze,onEditMemory:es,onDeleteMemory:as})})]}),e.jsx(Ft,{memory:f||void 0,open:y,onOpenChange:v,onSubmit:f?ts:ss}),e.jsxs(q,{children:[e.jsx(ne,{children:e.jsx(re,{className:"text-lg",children:"Communications"})}),e.jsx(K,{children:h?e.jsx(ge,{width:"100%",height:100}):e.jsx(Vt,{emails:H,calendarEvents:ae,onUnlinkEmail:is,onUnlinkEvent:ns})})]}),e.jsxs(q,{children:[e.jsx(ne,{children:e.jsx(re,{className:"text-lg",children:"Participants"})}),e.jsx(K,{children:l.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No participants assigned"}):e.jsx("ul",{className:"space-y-2",children:l.map((c,E)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"size-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-primary",children:(c.participant??"U")[0].toUpperCase()})}),e.jsx("span",{className:"text-sm",children:c.participant??"Unknown"}),c.role&&e.jsx(T,{variant:"outline",className:"text-xs",children:c.role})]},E))})})]})]}),e.jsx(fs,{open:D,onOpenChange:b,item:w?{id:w.id,title:w.title,kind:w.kind,childCount:0}:void 0,onConfirm:ls,isDeleting:g}),k&&e.jsx(gs,{visible:!!k,itemTitle:k.itemTitle,onUndo:k.onUndo,onDismiss:S})]})}export{ka as WorkItemDetailPage};
//# sourceMappingURL=WorkItemDetailPage-B2Xp00SY.js.map
