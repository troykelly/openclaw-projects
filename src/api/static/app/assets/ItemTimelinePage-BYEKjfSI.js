import{e as M,j as e,L as E}from"./index-CqOBwho-.js";import{u as L}from"./use-timeline-ByHPg3Ml.js";import{k as S}from"./work-item-utils-RZsWa1qH.js";import{S as v,C as P,d as W,e as X,b as B}from"./card-BIAwUTkY.js";import{E as H}from"./error-state-BzCKKpAl.js";import{c as A,B as R}from"./button-DeHx6FLI.js";import{S as V,a as Y}from"./scroll-area-CO0mOEzY.js";import{C as U}from"./chevron-right-Dt5r7trh.js";import"./api-client-CDvRtWmo.js";import"./index-CjnDbpRw.js";const $=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],F=A("chart-column",$);function ae(){const{id:C}=M(),D=C??"",{data:k,isLoading:T,error:y,refetch:z}=L(D);if(T)return e.jsxs("div",{"data-testid":"page-item-timeline",className:"p-6",children:[e.jsx(v,{width:150,height:24,className:"mb-4"}),e.jsx(v,{width:"100%",height:400})]});if(y)return e.jsx("div",{"data-testid":"page-item-timeline",className:"p-6",children:e.jsx(H,{type:"generic",title:"Failed to load timeline",description:y instanceof Error?y.message:"Unknown error",onRetry:()=>z()})});const o=k?.items??[],I=k?.dependencies??[],f=o.flatMap(t=>[t.not_before,t.not_after]).filter(t=>t!==null).map(t=>new Date(t).getTime()),b=Date.now();let l=f.length>0?Math.min(...f):b,g=f.length>0?Math.max(...f):b+720*60*60*1e3;const _=g-l||1;l-=_*.05,g+=_*.05;const m=900,p=40,a=220,u=o.length*p+60;function c(t){return a+(t-l)/(g-l)*(m-a-20)}const w={};return o.forEach((t,s)=>{w[t.id]={y:s*p+30}}),e.jsxs("div",{"data-testid":"page-item-timeline",className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsx(R,{variant:"ghost",size:"sm",asChild:!0,children:e.jsxs(E,{to:"/work-items",children:[e.jsx(U,{className:"mr-1 size-4 rotate-180"}),"Back to Work Items"]})})}),e.jsxs(P,{children:[e.jsx(W,{children:e.jsxs(X,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"size-5"}),"Timeline / Gantt Chart"]})}),e.jsxs(B,{children:[e.jsxs(V,{className:"w-full",children:[e.jsxs("svg",{width:m,height:u,className:"font-sans text-xs",children:[e.jsx("rect",{x:a,y:0,width:m-a,height:u,className:"fill-muted/30"}),[.25,.5,.75,1].map(t=>{const s=a+t*(m-a-20),r=l+t*(g-l),i=new Date(r).toLocaleDateString();return e.jsxs("g",{children:[e.jsx("line",{x1:s,y1:0,x2:s,y2:u,className:"stroke-border",strokeDasharray:"4,4"}),e.jsx("text",{x:s,y:u-8,textAnchor:"middle",className:"fill-muted-foreground text-[10px]",children:i})]},t)}),o.map((t,s)=>{const r=s*p+30,i=t.level*16,d=t.not_before!==null,j=t.not_after!==null;let n=a+10,h=60;d&&j?(n=c(new Date(t.not_before).getTime()),h=Math.max(8,c(new Date(t.not_after).getTime())-n)):d?n=c(new Date(t.not_before).getTime()):j&&(n=c(new Date(t.not_after).getTime())-60);const N=S[t.kind]||"bg-gray-500",x=t.status==="done"||t.status==="closed";return e.jsxs("g",{children:[e.jsx("rect",{x:0,y:r-15,width:m,height:p,className:s%2===0?"fill-transparent":"fill-muted/20"}),e.jsx("text",{x:8+i,y:r+5,className:"fill-foreground text-xs font-medium",children:t.title.length>24?t.title.slice(0,22)+"...":t.title}),e.jsx("rect",{x:n,y:r-10,width:h,height:24,rx:4,className:`${N} ${x?"opacity-40":"opacity-80"}`}),e.jsx("text",{x:n+6,y:r+5,className:"fill-white text-[10px] font-medium",children:t.kind.charAt(0).toUpperCase()})]},t.id)}),I.map(t=>{const s=w[t.from_id],r=w[t.to_id];if(!s||!r)return null;const i=o.find(x=>x.id===t.from_id),d=o.find(x=>x.id===t.to_id);if(!i||!d)return null;const j=s.y,n=r.y;let h=a+40,N=a+40;return d.not_after&&(N=c(new Date(d.not_after).getTime())),i.not_before&&(h=c(new Date(i.not_before).getTime())),e.jsx("line",{x1:N+4,y1:n,x2:h-4,y2:j,className:"stroke-destructive",strokeWidth:1.5,markerEnd:"url(#arrowhead)"},t.id)}),e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"8",refX:"6",refY:"4",orient:"auto",children:e.jsx("path",{d:"M0,0 L8,4 L0,8 Z",className:"fill-destructive"})})})]}),e.jsx(Y,{orientation:"horizontal"})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap items-center gap-4 text-sm text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Legend:"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"size-3 rounded bg-blue-500"})," Project"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"size-3 rounded bg-violet-500"})," Initiative"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"size-3 rounded bg-emerald-500"})," Epic"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"size-3 rounded bg-gray-500"})," Issue"]})]})]})]})]})}export{ae as ItemTimelinePage};
//# sourceMappingURL=ItemTimelinePage-BYEKjfSI.js.map
