import{e as R,a as $,r as n,j as e,R as q}from"./index-Dmu1Cmf3.js";import{a as w}from"./api-client-CDvRtWmo.js";import{g as V}from"./work-item-utils-RZsWa1qH.js";import{S as p,f as H,C as z,b as S}from"./card-BWtpZjNX.js";import{E as U}from"./error-state-CCoNnbdR.js";import{E as b}from"./empty-state-Cr_6DAnC.js";import{c as G,B as c}from"./button-B4tyHn7n.js";import{I as J}from"./input-D2fjPNS6.js";import{T as K}from"./textarea-Brqak-GW.js";import{B as Q}from"./badge-BFA1Pi_I.js";import{S as W}from"./separator-C6hHh4bC.js";import{A as D,T as X,a as Y,b as y,c as C}from"./tabs-CP7p3l1E.js";import{D as B,a as L,b as F,c as I,d as P,e as _}from"./dialog-DPKlQCu7.js";import{a as Z,P as T}from"./use-contacts-BKJTet7w.js";import{M as E}from"./mail-Bh_6JRWm.js";import{P as ee,T as te}from"./index-CqAfc_78.js";import{L as A}from"./link-2-D5cDWkwv.js";import{C as se}from"./users-DVF8IM-O.js";import"./bell-DMA7QWwP.js";import"./search-CGjsCXTe.js";import"./index-DT505RDd.js";import"./index-CicDskkn.js";import"./index-BdkY-9YW.js";const ae=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ie=G("message-square",ae);function Te(){const{contactId:a}=R(),l=$(),[x,r]=n.useState(!1),[u,d]=n.useState(!1),[h,m]=n.useState(!1),{data:t,isLoading:f,isError:o,error:i,refetch:j}=Z(a??""),k=n.useCallback(()=>{l("/contacts")},[l]),O=n.useCallback(async s=>{if(a){d(!0);try{await w.patch(`/api/contacts/${a}`,s),r(!1),j()}catch(v){console.error("Failed to update contact:",v)}finally{d(!1)}}},[a,j]),M=n.useCallback(async()=>{if(a)try{await w.delete(`/api/contacts/${a}`),l("/contacts")}catch(s){console.error("Failed to delete contact:",s)}},[a,l]);if(f)return e.jsxs("div",{"data-testid":"page-contact-detail",className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[e.jsx(p,{width:36,height:36,variant:"circular"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{width:200,height:24}),e.jsx(p,{width:150,height:16,className:"mt-2"})]})]}),e.jsx(p,{width:"100%",height:48,className:"mb-4"}),e.jsx(H,{lines:5})]});if(o||!t)return e.jsxs("div",{"data-testid":"page-contact-detail",className:"p-6",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:k,className:"mb-4",children:[e.jsx(D,{className:"mr-2 size-4"}),"Back to Contacts"]}),e.jsx(U,{type:o?"generic":"not-found",title:o?"Failed to load contact":"Contact not found",description:o&&i instanceof Error?i.message:"The contact you are looking for does not exist or has been removed.",onRetry:o?()=>j():void 0})]});const N=t.endpoints.find(s=>s.type==="email")?.value,g=t.endpoints.find(s=>s.type==="phone")?.value;return e.jsxs("div",{"data-testid":"page-contact-detail",className:"p-6 h-full flex flex-col",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:k,className:"mb-4 w-fit","data-testid":"back-button",children:[e.jsx(D,{className:"mr-2 size-4"}),"Back to Contacts"]}),e.jsxs("div",{className:"mb-6 flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex size-16 shrink-0 items-center justify-center rounded-full bg-primary/10 text-xl font-medium text-primary",children:V(t.display_name)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:t.display_name}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-3 text-sm text-muted-foreground",children:[N&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(E,{className:"size-3"}),e.jsx("a",{href:`mailto:${N}`,className:"hover:underline",children:N})]}),g&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"size-3"}),e.jsx("a",{href:`tel:${g}`,className:"hover:underline",children:g})]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>r(!0),"data-testid":"edit-contact-button",children:[e.jsx(ee,{className:"mr-1 size-3"}),"Edit"]}),e.jsxs(c,{variant:"outline",size:"sm",className:"text-destructive hover:text-destructive",onClick:()=>m(!0),"data-testid":"delete-contact-button",children:[e.jsx(te,{className:"mr-1 size-3"}),"Delete"]})]})]}),e.jsx(W,{className:"mb-6"}),e.jsxs(X,{defaultValue:"endpoints",className:"flex-1",children:[e.jsxs(Y,{"data-testid":"contact-tabs",children:[e.jsxs(y,{value:"endpoints",className:"gap-1",children:[e.jsx(A,{className:"size-3"}),"Endpoints"]}),e.jsxs(y,{value:"notes",className:"gap-1",children:[e.jsx(ie,{className:"size-3"}),"Notes"]}),e.jsxs(y,{value:"activity",className:"gap-1",children:[e.jsx(se,{className:"size-3"}),"Activity"]})]}),e.jsx(C,{value:"endpoints",className:"mt-4",children:t.endpoints.length>0?e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-3",children:t.endpoints.map((s,v)=>e.jsx(z,{"data-testid":"endpoint-card",children:e.jsxs(S,{className:"p-4 flex items-center gap-3",children:[e.jsxs("div",{className:"flex size-10 items-center justify-center rounded-full bg-muted",children:[s.type==="email"&&e.jsx(E,{className:"size-5 text-muted-foreground"}),s.type==="phone"&&e.jsx(T,{className:"size-5 text-muted-foreground"}),s.type!=="email"&&s.type!=="phone"&&e.jsx(A,{className:"size-5 text-muted-foreground"})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(Q,{variant:"outline",className:"text-xs mb-1",children:s.type}),e.jsx("p",{className:"text-sm text-foreground truncate",children:s.value})]})]})},v))}):e.jsx(b,{variant:"contacts",title:"No endpoints",description:"This contact has no communication endpoints configured."})}),e.jsx(C,{value:"notes",className:"mt-4",children:t.notes?e.jsx(z,{children:e.jsx(S,{className:"p-6",children:e.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap","data-testid":"contact-notes",children:t.notes})})}):e.jsx(b,{variant:"documents",title:"No notes",description:"No notes have been added for this contact.",onAction:()=>r(!0),actionLabel:"Add Notes"})}),e.jsx(C,{value:"activity",className:"mt-4",children:e.jsx(b,{variant:"calendar",title:"No activity yet",description:"Activity related to this contact will appear here."})})]}),e.jsx(ne,{open:x,onOpenChange:r,contact:t,isSubmitting:u,onSubmit:O}),e.jsx(B,{open:h,onOpenChange:m,children:e.jsxs(L,{className:"sm:max-w-sm","data-testid":"delete-confirm-dialog",children:[e.jsxs(F,{children:[e.jsx(I,{children:"Delete Contact"}),e.jsxs(P,{children:['Are you sure you want to delete "',t.display_name,'"? This action cannot be undone.']})]}),e.jsxs(_,{children:[e.jsx(c,{variant:"outline",onClick:()=>m(!1),children:"Cancel"}),e.jsx(c,{variant:"destructive",onClick:M,"data-testid":"confirm-delete-button",children:"Delete"})]})]})})]})}function ne({open:a,onOpenChange:l,contact:x,isSubmitting:r,onSubmit:u}){const[d,h]=n.useState(""),[m,t]=n.useState("");q.useEffect(()=>{a&&(h(x.display_name),t(x.notes??""))},[a,x]);const f=i=>{i.preventDefault(),u({displayName:d.trim(),notes:m.trim()||void 0})},o=d.trim().length>0;return e.jsx(B,{open:a,onOpenChange:l,children:e.jsxs(L,{className:"sm:max-w-md","data-testid":"contact-edit-dialog",children:[e.jsxs(F,{children:[e.jsx(I,{children:"Edit Contact"}),e.jsx(P,{children:"Update the contact details below."})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"edit-contact-name",className:"text-sm font-medium",children:["Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(J,{id:"edit-contact-name",value:d,onChange:i=>h(i.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"edit-contact-notes",className:"text-sm font-medium",children:"Notes"}),e.jsx(K,{id:"edit-contact-notes",value:m,onChange:i=>t(i.target.value),rows:3})]}),e.jsxs(_,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(c,{type:"submit",disabled:!o||r,children:"Save Changes"})]})]})]})})}export{Te as ContactDetailPage};
//# sourceMappingURL=ContactDetailPage-DHkGQh7r.js.map
