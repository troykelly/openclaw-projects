import{r as W,j as t,L as R}from"./index-8lelR6qN.js";import{a as U}from"./use-timeline-B1wcH3mw.js";import{d as z}from"./work-item-utils-RZsWa1qH.js";import{S as N,C as I,b as O}from"./card-iotqpvc8.js";import{E as X}from"./error-state-DLctD4sJ.js";import{E as Y}from"./empty-state-DE2qD6F6.js";import{B as D}from"./button-CCcTHsAD.js";import{S as Q,a as J}from"./scroll-area-Cm_wDnln.js";import"./useQuery-C5fTQTrO.js";import"./api-client-CDvRtWmo.js";import"./bell-DnBa4S1K.js";import"./mail-BvTIWAWD.js";import"./calendar-c0kNGWNj.js";import"./users-BTXwO7qa.js";import"./folder-open-CX6VBEV4.js";import"./search-Bq9T0uel.js";import"./index-D1CsxaJp.js";import"./index-BECoGD9f.js";import"./index-BdQq_4o_.js";const V={day:{pixelsPerDay:60,label:"Day"},week:{pixelsPerDay:12,label:"Week"},month:{pixelsPerDay:3,label:"Month"},quarter:{pixelsPerDay:1,label:"Quarter"}};function ye(){const[n,$]=W.useState("week"),[u,P]=W.useState([]),{data:M,isLoading:Z,error:w,refetch:F}=U(u.length>0?u:void 0),L=e=>{P(s=>s.includes(e)?s.filter(d=>d!==e):[...s,e])},q=()=>{const e=["quarter","month","week","day"],s=e.indexOf(n);s<e.length-1&&$(e[s+1])},A=()=>{const e=["quarter","month","week","day"],s=e.indexOf(n);s>0&&$(e[s-1])};if(Z)return t.jsxs("div",{"data-testid":"page-global-timeline",className:"p-6",children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsx(N,{width:200,height:32}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(N,{width:100,height:36}),t.jsx(N,{width:100,height:36})]})]}),t.jsx(N,{width:"100%",height:400})]});if(w)return t.jsx("div",{"data-testid":"page-global-timeline",className:"p-6",children:t.jsx(X,{type:"generic",title:"Failed to load timeline",description:w instanceof Error?w.message:"Unknown error",onRetry:()=>F()})});const i=M?.items??[],B=M?.dependencies??[];if(i.length===0)return t.jsxs("div",{"data-testid":"page-global-timeline",className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Timeline"}),t.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Gantt view of all work items"})]}),t.jsx(I,{children:t.jsx(O,{className:"p-8",children:t.jsx(Y,{variant:"no-data",title:"No scheduled items",description:"Add dates to your work items to see them on the timeline."})})})]});const g=i.flatMap(e=>[e.not_before,e.not_after]).filter(e=>e!==null).map(e=>new Date(e).getTime()),r=Date.now();let o=g.length>0?Math.min(...g):r,c=g.length>0?Math.max(...g):r+720*60*60*1e3;const C=c-o||1;o-=C*.05,c+=C*.05;const S=V[n],m=1440*60*1e3,G=Math.ceil((c-o)/m),v=Math.max(800,G*S.pixelsPerDay),f=36,a=240,k=Math.max(200,i.length*f+60);function l(e){return a+(e-o)/(c-o)*(v-a-20)}const j={};i.forEach((e,s)=>{j[e.id]={y:s*f+40}});const H={done:"opacity-60",in_progress:"",blocked:"opacity-80 stroke-red-500 stroke-2",open:"opacity-40"},K=n==="day"?m:n==="week"?7*m:n==="month"?30*m:90*m,T=[];for(let e=o;e<=c;e+=K)T.push({x:l(e),label:new Date(e).toLocaleDateString()});return t.jsxs("div",{"data-testid":"page-global-timeline",className:"p-6 h-full flex flex-col",children:[t.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-semibold text-foreground",children:"Timeline"}),t.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[i.length," item",i.length!==1?"s":""," with scheduled dates"]})]}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"flex gap-1",children:["project","initiative","epic","issue"].map(e=>t.jsx(D,{variant:u.length===0||u.includes(e)?"secondary":"outline",size:"sm",onClick:()=>L(e),className:"text-xs",children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(D,{variant:"outline",size:"sm",onClick:q,disabled:n==="day",children:"Zoom In"}),t.jsx(D,{variant:"outline",size:"sm",onClick:A,disabled:n==="quarter",children:"Zoom Out"}),t.jsxs("span",{className:"ml-2 text-sm text-muted-foreground self-center",children:[S.label," view"]})]})]})]}),t.jsx(I,{className:"flex-1 overflow-hidden",children:t.jsx(O,{className:"p-0 h-full",children:t.jsxs(Q,{className:"h-full",children:[t.jsxs("div",{className:"flex",style:{minWidth:`${v}px`},children:[t.jsxs("div",{className:"sticky left-0 z-10 bg-background border-r",style:{width:`${a}px`,minWidth:`${a}px`},children:[t.jsx("div",{className:"h-10 border-b bg-muted/30 px-3 flex items-center",children:t.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Work Item"})}),i.map(e=>t.jsxs("div",{className:"h-9 border-b px-3 flex items-center gap-2 hover:bg-muted/50 transition-colors",style:{paddingLeft:`${12+(e.level||0)*16}px`},children:[t.jsx("span",{className:`size-2 rounded-full ${z[e.kind]||"bg-gray-400"}`}),t.jsx(R,{to:`/work-items/${e.id}`,className:"text-sm truncate hover:text-primary hover:underline",title:e.title,children:e.title})]},e.id))]}),t.jsx("div",{className:"flex-1",children:t.jsxs("svg",{width:v-a,height:k,children:[t.jsx("g",{className:"text-[10px]",children:T.map((e,s)=>t.jsxs("g",{children:[t.jsx("line",{x1:e.x-a,y1:40,x2:e.x-a,y2:k,className:"stroke-border",strokeDasharray:"4,4"}),t.jsx("text",{x:e.x-a,y:28,textAnchor:"middle",className:"fill-muted-foreground",children:e.label})]},s))}),r>=o&&r<=c&&t.jsx("line",{x1:l(r)-a,y1:40,x2:l(r)-a,y2:k,className:"stroke-red-500",strokeWidth:2}),i.map(e=>{const s=e.not_before?new Date(e.not_before).getTime():r,d=e.not_after?new Date(e.not_after).getTime():s+7*m,x=l(s)-a,y=l(d)-a,b=j[e.id]?.y||0,h=20,p=b+(f-h)/2-4;return t.jsxs("g",{children:[t.jsx("rect",{x,y:p,width:Math.max(4,y-x),height:h,rx:4,className:`${z[e.kind]||"fill-gray-400"} ${H[e.status||"open"]||""}`}),e.actual_minutes&&e.estimate_minutes&&e.estimate_minutes>0&&t.jsx("rect",{x,y:p+h-3,width:Math.min(1,e.actual_minutes/e.estimate_minutes)*Math.max(4,y-x),height:3,rx:1,className:"fill-white/50"})]},e.id)}),B.map(e=>{const s=i.find(_=>_.id===e.from_id),d=i.find(_=>_.id===e.to_id);if(!s||!d)return null;const x=s.not_after?new Date(s.not_after).getTime():r,y=d.not_before?new Date(d.not_before).getTime():r,b=l(x)-a,h=(j[e.from_id]?.y||0)+f/2,p=l(y)-a,E=(j[e.to_id]?.y||0)+f/2;return t.jsx("g",{children:t.jsx("path",{d:`M ${b} ${h} C ${b+20} ${h}, ${p-20} ${E}, ${p} ${E}`,fill:"none",className:"stroke-muted-foreground",strokeWidth:1.5,markerEnd:"url(#arrowhead)"})},e.id)}),t.jsx("defs",{children:t.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:t.jsx("polygon",{points:"0 0, 10 3.5, 0 7",className:"fill-muted-foreground"})})})]})})]}),t.jsx(J,{orientation:"horizontal"})]})})})]})}export{ye as GlobalTimelinePage};
//# sourceMappingURL=GlobalTimelinePage-WCGsf1MA.js.map
