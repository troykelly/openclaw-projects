{"version":3,"file":"ActivityPage-aPq8MJ0Z.js","sources":["../../../../ui/hooks/queries/use-activity.ts","../../../../ui/pages/ActivityPage.tsx"],"sourcesContent":["/**\n * TanStack Query hook for the activity feed.\n *\n * Fetches recent activity items from GET /api/activity.\n */\nimport { useQuery } from '@tanstack/react-query';\nimport { apiClient } from '@/ui/lib/api-client.ts';\nimport type { ActivityResponse } from '@/ui/lib/api-types.ts';\n\n/** Query key factory for activity. */\nexport const activityKeys = {\n  all: ['activity'] as const,\n  list: (limit?: number) => [...activityKeys.all, 'list', limit] as const,\n};\n\n/**\n * Fetch the activity feed.\n *\n * @param limit - Maximum number of items (default 50)\n * @returns TanStack Query result with `ActivityResponse`\n */\nexport function useActivity(limit = 50) {\n  return useQuery({\n    queryKey: activityKeys.list(limit),\n    queryFn: ({ signal }) =>\n      apiClient.get<ActivityResponse>(`/api/activity?limit=${limit}`, { signal }),\n  });\n}\n","/**\n * Activity feed page.\n *\n * Displays a chronological feed of recent work item activity, including\n * creates, updates, status changes, and comments. Uses TanStack Query\n * for data fetching with automatic caching and refetch.\n */\nimport React from 'react';\nimport { Link } from 'react-router';\nimport { useActivity } from '@/ui/hooks/queries/use-activity';\nimport type { ActivityItem } from '@/ui/lib/api-types';\nimport {\n  Skeleton,\n  SkeletonList,\n  ErrorState,\n  EmptyState,\n} from '@/ui/components/feedback';\nimport { Button } from '@/ui/components/ui/button';\nimport { Card, CardContent } from '@/ui/components/ui/card';\nimport { ScrollArea } from '@/ui/components/ui/scroll-area';\n\n/** Map an API activity item to a display-ready format. */\nfunction mapActivityItem(item: ActivityItem) {\n  return {\n    id: item.id,\n    actorType: item.actor_email?.includes('agent')\n      ? ('agent' as const)\n      : ('human' as const),\n    actorName: item.actor_email || 'System',\n    action: (item.type === 'status_change' ? 'status_changed' : item.type) as string,\n    entityId: item.work_item_id,\n    entityTitle: item.work_item_title,\n    detail: item.description,\n    timestamp: new Date(item.created_at),\n  };\n}\n\n/** Render action verb for display. */\nfunction actionLabel(action: string): string {\n  switch (action) {\n    case 'created':\n      return 'created';\n    case 'updated':\n      return 'updated';\n    case 'status_changed':\n      return 'changed status of';\n    case 'commented':\n      return 'commented on';\n    case 'assigned':\n      return 'assigned';\n    default:\n      return action;\n  }\n}\n\nexport function ActivityPage(): React.JSX.Element {\n  const { data, isLoading, error, refetch } = useActivity(50);\n\n  if (isLoading) {\n    return (\n      <div data-testid=\"page-activity\" className=\"p-6\">\n        <div className=\"mb-6 flex items-center justify-between\">\n          <Skeleton width={200} height={32} />\n        </div>\n        <SkeletonList count={5} variant=\"row\" />\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div data-testid=\"page-activity\" className=\"p-6\">\n        <ErrorState\n          type=\"generic\"\n          title=\"Failed to load activity\"\n          description={error instanceof Error ? error.message : 'Unknown error'}\n          onRetry={() => refetch()}\n        />\n      </div>\n    );\n  }\n\n  const items = data?.items ?? [];\n\n  if (items.length === 0) {\n    return (\n      <div data-testid=\"page-activity\" className=\"p-6\">\n        <h1 className=\"text-2xl font-semibold text-foreground mb-4\">Activity Feed</h1>\n        <Card>\n          <CardContent className=\"p-8\">\n            <EmptyState\n              variant=\"no-data\"\n              title=\"No activity yet\"\n              description=\"Activity will appear here when work items are created or updated.\"\n            />\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const activityItems = items.map(mapActivityItem);\n\n  return (\n    <div data-testid=\"page-activity\" className=\"p-6 h-full flex flex-col\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-semibold text-foreground\">Activity Feed</h1>\n        <p className=\"text-sm text-muted-foreground mt-1\">\n          Recent updates across all work items\n        </p>\n      </div>\n\n      <Card className=\"flex-1\">\n        <CardContent className=\"p-0\">\n          <ScrollArea className=\"h-[calc(100vh-200px)]\">\n            <div className=\"divide-y\">\n              {activityItems.map((item) => (\n                <div\n                  key={item.id}\n                  className=\"p-4 hover:bg-muted/50 transition-colors\"\n                >\n                  <div className=\"flex items-start gap-3\">\n                    <div\n                      className={`size-8 rounded-full flex items-center justify-center shrink-0 ${\n                        item.actorType === 'agent'\n                          ? 'bg-violet-500/10 text-violet-500'\n                          : 'bg-primary/10 text-primary'\n                      }`}\n                    >\n                      <span className=\"text-xs font-medium\">\n                        {item.actorName.charAt(0).toUpperCase()}\n                      </span>\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2 mb-1\">\n                        <span className=\"text-sm font-medium text-foreground\">\n                          {item.actorName}\n                        </span>\n                        <span className=\"text-xs text-muted-foreground\">\n                          {actionLabel(item.action)}\n                        </span>\n                      </div>\n                      <Link\n                        to={`/work-items/${item.entityId}`}\n                        className=\"text-sm font-medium text-primary hover:underline\"\n                      >\n                        {item.entityTitle}\n                      </Link>\n                      {item.detail && (\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          {item.detail}\n                        </p>\n                      )}\n                      <p className=\"text-xs text-muted-foreground mt-2\">\n                        {item.timestamp.toLocaleDateString()} at{' '}\n                        {item.timestamp.toLocaleTimeString()}\n                      </p>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </ScrollArea>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n"],"names":["activityKeys","limit","useActivity","useQuery","signal","apiClient","mapActivityItem","item","actionLabel","action","ActivityPage","data","isLoading","error","refetch","jsxs","jsx","Skeleton","SkeletonList","ErrorState","items","Card","CardContent","EmptyState","activityItems","ScrollArea","Link"],"mappings":"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"}