import{b as A,d as B,r as x,R as F,j as e,L as $}from"./index-BTKavlMF.js";import{u as K}from"./useQuery-CvMXqy2m.js";import{a as j}from"./api-client-CDvRtWmo.js";import{E as U,C as _}from"./error-state-B03uaCNt.js";import{B as q}from"./button-4HlqvOJz.js";import{I as Q}from"./inline-editable-text-XoSdd9h8.js";import{L as V}from"./list-CRcOQ0I1.js";import{C as M}from"./clock-BGwPwmWQ.js";import{a as W,C as G}from"./circle-BqKqtdYv.js";import"./input-Hd3OJA0G.js";import"./textarea-D3RCZ6Tj.js";const L={all:["backlog"],list:i=>[...L.all,"list",i]};function H(i){const n=new URLSearchParams;i?.priority?.forEach(d=>n.append("priority",d)),i?.kind?.forEach(d=>n.append("kind",d));const l=n.toString()?`?${n.toString()}`:"";return K({queryKey:L.list(i),queryFn:({signal:d})=>j.get(`/api/backlog${l}`,{signal:d})})}const D=["open","blocked","closed"],J={open:{label:"To Do",bgColor:"from-blue-500/5 to-blue-500/0"},blocked:{label:"Blocked",bgColor:"from-amber-500/5 to-amber-500/0"},closed:{label:"Done",bgColor:"from-emerald-500/5 to-emerald-500/0"}},h={P0:{color:"#ef4444",bg:"bg-red-500/10 text-red-400 border-red-500/20"},P1:{color:"#f97316",bg:"bg-orange-500/10 text-orange-400 border-orange-500/20"},P2:{color:"#eab308",bg:"bg-yellow-500/10 text-yellow-400 border-yellow-500/20"},P3:{color:"#22c55e",bg:"bg-green-500/10 text-green-400 border-green-500/20"},P4:{color:"#6b7280",bg:"bg-gray-500/10 text-gray-400 border-gray-500/20"}},E={project:{label:"P",color:"bg-blue-500"},initiative:{label:"I",color:"bg-violet-500"},epic:{label:"E",color:"bg-emerald-500"},issue:{label:"T",color:"bg-gray-500"}};function ne(){A();const[i,n]=B(),[l,d]=x.useState({priority:i.getAll("priority"),kind:i.getAll("kind")}),{data:u,isLoading:y,error:p,refetch:v}=H({priority:l.priority.length>0?l.priority:void 0,kind:l.kind.length>0?l.kind:void 0}),[N,g]=x.useState([]),[m,b]=x.useState(null),[S,f]=x.useState(null);F.useEffect(()=>{u?.items&&g(u.items)},[u]);const k=x.useCallback(r=>{d(r);const s=new URLSearchParams;r.priority.forEach(a=>s.append("priority",a)),r.kind.forEach(a=>s.append("kind",a)),n(s)},[n]),C=(r,s)=>{const a=l[r],o=a.includes(s)?a.filter(t=>t!==s):[...a,s];k({...l,[r]:o})},z=(r,s)=>{b(s),r.dataTransfer.effectAllowed="move"},I=(r,s)=>{r.preventDefault(),r.dataTransfer.dropEffect="move",f(s)},O=()=>f(null),R=async(r,s)=>{if(r.preventDefault(),f(null),!m)return;const a=N.find(o=>o.id===m);if(!a||a.status===s){b(null);return}g(o=>o.map(t=>t.id===m?{...t,status:s}:t));try{await j.patch(`/api/work-items/${m}/status`,{status:s})}catch{g(o=>o.map(t=>t.id===m?{...t,status:a.status}:t))}b(null)},T=async(r,s)=>{g(a=>a.map(o=>o.id===r?{...o,title:s}:o));try{await j.patch(`/api/work-items/${r}`,{title:s})}catch{v()}};return e.jsxs("div",{"data-testid":"page-kanban",className:"h-full flex flex-col bg-gradient-to-br from-background to-muted/20",children:[e.jsxs("div",{className:"px-6 pt-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight text-foreground",children:"Kanban Board"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Drag cards to update status"})]}),e.jsx(q,{variant:"outline",size:"sm",asChild:!0,className:"border-border/50",children:e.jsxs($,{to:"/work-items",children:[e.jsx(V,{className:"mr-2 size-4"}),"List View"]})})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Priority"}),e.jsx("div",{className:"flex gap-1",children:["P0","P1","P2","P3","P4"].map(r=>e.jsx("button",{onClick:()=>C("priority",r),className:`px-2.5 py-1 text-xs font-medium rounded-md transition-all ${l.priority.includes(r)?h[r].bg+" border":"text-muted-foreground hover:text-foreground hover:bg-muted"}`,children:r},r))})]}),e.jsx("div",{className:"h-4 w-px bg-border/50"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-muted-foreground uppercase tracking-wide",children:"Type"}),e.jsx("div",{className:"flex gap-1",children:["project","initiative","epic","issue"].map(r=>e.jsxs("button",{onClick:()=>C("kind",r),className:`px-2.5 py-1 text-xs font-medium rounded-md transition-all flex items-center gap-1.5 ${l.kind.includes(r)?"bg-primary/10 text-primary border border-primary/20":"text-muted-foreground hover:text-foreground hover:bg-muted"}`,children:[e.jsx("span",{className:`size-2 rounded-sm ${E[r].color}`}),r.charAt(0).toUpperCase()+r.slice(1)]},r))})]}),(l.priority.length>0||l.kind.length>0)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-px bg-border/50"}),e.jsx("button",{onClick:()=>k({priority:[],kind:[]}),className:"text-xs text-muted-foreground hover:text-foreground transition-colors",children:"Clear all"})]})]})]}),y&&e.jsx("div",{className:"flex gap-4 flex-1 px-6 pb-6",children:D.map(r=>e.jsx("div",{className:"flex-1 rounded-xl bg-muted/30 animate-pulse min-h-[400px]"},r))}),p&&e.jsx("div",{className:"px-6",children:e.jsx(U,{type:"generic",title:"Failed to load board",description:p instanceof Error?p.message:"Unknown error",onRetry:()=>v()})}),!y&&!p&&e.jsx("div",{className:"flex gap-4 flex-1 overflow-x-auto px-6 pb-6",children:D.map(r=>{const s=N.filter(t=>t.status===r),a=J[r],o=S===r;return e.jsxs("div",{className:`flex-1 min-w-[300px] max-w-[380px] flex flex-col rounded-xl transition-all duration-200 ${o?"ring-2 ring-primary/50 ring-offset-2 ring-offset-background":""}`,onDragOver:t=>I(t,r),onDragLeave:O,onDrop:t=>R(t,r),children:[e.jsx("div",{className:`px-4 py-3 rounded-t-xl bg-gradient-to-b ${a.bgColor} border-b border-border/30`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`size-2 rounded-full ${r==="open"?"bg-blue-400":r==="blocked"?"bg-amber-400":"bg-emerald-400"}`}),e.jsx("h3",{className:"font-semibold text-sm",children:a.label})]}),e.jsx("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full bg-muted text-muted-foreground",children:s.length})]})}),e.jsxs("div",{className:"flex-1 p-2 space-y-2 overflow-y-auto bg-muted/20 rounded-b-xl",children:[s.map(t=>{const w=E[t.kind]||{label:"?",color:"bg-gray-500"},P=h[t.priority]||h.P4;return e.jsxs("div",{draggable:!0,onDragStart:c=>z(c,t.id),className:`group bg-surface border border-border/50 rounded-lg p-3 cursor-grab active:cursor-grabbing transition-all duration-150 hover:border-border hover:shadow-lg hover:shadow-black/5 hover:-translate-y-0.5 ${m===t.id?"opacity-50 scale-95":""}`,style:{borderLeftWidth:3,borderLeftColor:P.color},children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(Q,{value:t.title,onSave:c=>T(t.id,c),selectOnFocus:!0,className:"font-medium text-sm text-foreground line-clamp-2 leading-snug",validate:c=>c.trim().length>0})}),e.jsx($,{to:`/work-items/${t.id}`,className:"shrink-0 size-5 rounded flex items-center justify-center text-[10px] font-bold text-white hover:opacity-80 transition-opacity",onClick:c=>c.stopPropagation(),title:"View details",children:e.jsx("div",{className:`size-full rounded flex items-center justify-center ${w.color}`,children:w.label})})]}),e.jsxs("div",{className:"mt-2.5 flex items-center gap-2",children:[e.jsx("span",{className:`text-[10px] font-semibold px-1.5 py-0.5 rounded border ${P.bg}`,children:t.priority}),t.estimate_minutes&&e.jsxs("span",{className:"flex items-center gap-1 text-[11px] text-muted-foreground",children:[e.jsx(M,{className:"size-3"}),t.estimate_minutes>=60?`${Math.floor(t.estimate_minutes/60)}h`:`${t.estimate_minutes}m`]})]})]},t.id)}),s.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-muted-foreground",children:[e.jsx("div",{className:"size-10 rounded-full bg-muted/50 flex items-center justify-center mb-2",children:r==="open"?e.jsx(W,{className:"size-5"}):r==="blocked"?e.jsx(_,{className:"size-5"}):e.jsx(G,{className:"size-5"})}),e.jsx("span",{className:"text-sm",children:"No items"})]})]})]},r)})})]})}export{ne as KanbanPage};
//# sourceMappingURL=KanbanPage-CqTAO77V.js.map
